(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2847],{87586:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/databases",function(){return t(47084)}])},47084:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var s=t(52322),i=t(84925),n=t(97729),r=t.n(n),o=t(21498);function d(e){let a=i.Z.databases.component,t=o.l.projectName;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r(),{children:(0,s.jsx)("title",{children:t+" - Databases"})}),(0,s.jsx)(a,{env:"current",...e})]})}},84925:function(e,a,t){"use strict";t.d(a,{Z:function(){return C}});var s=t(52322),i=t(25184);let n=i.Schema.object({key:i.z.string(),value:i.z.any()});(0,i.Protofy)("features",{adminPage:"/databases"});let r=i.Schema.object((0,i.Protofy)("schema",{name:i.z.string().id().search().static(),entries:i.z.array(n).generate(()=>[])}));(0,i.Protofy)("api",{name:"databases",prefix:"/api/core/v1/"});class o extends i.ProtoModel{list(e){return e?JSON.stringify(this.data).toLowerCase().includes(e.toLowerCase())?this.read():void 0:this.read()}static _newInstance(e,a){return new o(e,a)}constructor(e,a){super(e,n,a,"Database")}}let d=i.AutoModel.createDerived("DatabaseModel",r,"databases","/api/v1/");var l=t(22958),c=t(7211),u=t(93228),b=t(70142),p=t(43850),m=t(70952),h=t(27704),f=t(79428),v=t(37288),y=t(75136),g=t(11788),w=t(2784),j=t(88167),k=t(5893),x=t(19940);let S={},A=async e=>{let a=[];if(Array.isArray(e))a=e.map(e=>e.name);else if("string"==typeof e&&"*"===e)a=["*"];else if("object"==typeof e&&null!==e&&e.data)a=[e.data.name];else throw Error("Invalid input for extractIds");await i.API.post("/api/core/v1/backup/databases",a)};var C={databases:{component:e=>{var a,t;let{workspace:i,pageState:n,initialItems:r,pageSession:o}=e,b=(0,m.t)(),p=(0,x.Tg)("databases.backup"),[h,f]=(0,w.useState)(!1),[y,g]=(0,w.useState)(""),[C,I]=(0,w.useState)(""),[P,D]=(0,w.useState)(0),T={item:{buttonCaption:"Backup",title:"Create Backup",description:"Are you sure to backup this database?"},bulk:{buttonCaption:"Backup",title:"Create Backups",description:"Are you sure to backup "+P+" databases?"},global:{buttonCaption:"Backup all databases",title:"Create Backups",description:"Are you sure to backup all databases?"}};return(0,k.G)(()=>"At this moment the user is browsing the databases list page. The databases list page allows to list the system databases. Databases are based on sqlite files, and stored under /data/databases.\n            The user can use the database management page to view system databases, or can select a specific database from the list, and view the entries for the selected database.\n            The system databases store the information in key->value system, storing JSONs as the value. \n            The databases are used to store users, groups, and as a storage for any CRUD API created for a object.\n            To backup databases, just backup /data/databases folder. To reset a database, simply delete /data/databases/*databasename*.\n            Using a special file called initialData.json at the same directory of your API, automatic crud apis will load initialData.json contents into the database when creating the database the first time. \n            Be careful editing the databases manually, the application may break. \n            "+((null==r?void 0:r.isLoaded)?"Currently the system returned the following information: "+JSON.stringify(r.data):"")),(0,s.jsxs)(c.D,{title:"Databases",workspace:i,pageSession:o,children:[(0,s.jsx)(u.a,{acceptCaption:"Create Backup",setOpen:f,open:h,onAccept:async e=>{await A(y),e(!1)},title:null===(a=T[C])||void 0===a?void 0:a.title,description:null===(t=T[C])||void 0===t?void 0:t.description,w:400,children:(0,s.jsx)(v.FA,{f:1,jc:"center",ai:"center"})}),(0,s.jsx)(l.V,{sourceUrl:"/api/core/v1/databases",initialItems:r,numColumnsForm:1,entityName:"Databases",name:"database",onSelectItem:e=>{b.push("/databases/view?database="+e.getId())},model:d,pageState:n,icons:S,extraMenuActions:[{text:e=>T[e].buttonCaption,icon:j.G,action:e=>{let a="item";"*"==e?a="global":Array.isArray(e)&&(a="bulk",D(e.length)),I(a),g(e),f(!0)},isVisible:e=>p,menus:["item","global","bulk"]}]})]})}},"databases/view":{component:e=>{var a;let{workspace:t,pageState:n,sourceUrl:r,initialItems:d,pageSession:u,extraData:m}=e,j=(0,x.Tg)("databases.update"),k=(0,x.Tg)("databases.delete"),[A,C]=(0,w.useState)(null),[I,P]=(0,w.useState)(d),[D,T]=(0,w.useState)(""),[_,N]=(0,w.useState)(1),[B,E]=(0,w.useState)(!1),[O,$]=(0,w.useState)(!1),M=(0,h.l)(),W=(0,f.j)(),z=null!==(a=Object.fromEntries(M.entries()).database)&&void 0!==a?a:"",F=async()=>{P(await i.API.fetch("/api/core/v1/databases/"+z))},L=async(e,a)=>{if(a)C(null),I.data.shift();else{let a=await i.API.get("/api/core/v1/databases/"+z+"/"+e+"/delete");(null==a?void 0:a.isLoaded)&&"deleted"==a.data.result&&(await F(),N(_+1))}},V=async(e,a)=>{let t=await i.API.post("/api/core/v1/databases/"+z+"/"+a,e);return(null==t?void 0:t.isLoaded)&&(await F(),N(_+1)),C(null),t};return(0,s.jsx)(c.D,{title:z,workspace:t,pageSession:u,children:W?(0,s.jsx)(l.V,{sourceUrl:"/api/core/v1/databases/"+z,initialItems:I,numColumnsForm:1,name:z,model:o,pageState:n,icons:S,disableViewSelector:!0,defaultView:"grid",dataTableGridProps:{itemMinWidth:500,overScanBy:1,getCard:(e,a)=>{let{_key:t,...i}=e;return(0,s.jsx)(v.FA,{px:"$3",pb:"$4",f:1,children:(0,s.jsx)(g.I,{innerContainerProps:{maxWidth:700,$md:{maxWidth:450},$sm:{minWidth:"calc(100vw - 65px)",maxWidth:"calc(100vw - 65px)"},minWidth:300,p:"$3"},onDelete:k?L:void 0,onSave:j?e=>V(e,t):void 0,json:i,name:t,isTemplate:t==A},_)})}}},_):(0,s.jsx)(b.I,{children:(0,s.jsx)(p.M,{children:(0,s.jsx)(y.$,{size:"large",color:"$color7",scale:2})})})})}}}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=87586)}),_N_E=e.O()}]);