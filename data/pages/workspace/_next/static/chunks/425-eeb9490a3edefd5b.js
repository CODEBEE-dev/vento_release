"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[425],{70425:function(e,r,l){l.d(r,{i:function(){return _}});var i=l(52322),a=l(2784),t=l(96120),n=l(36293),o=l(32878),s=l(99062),d=l(99981),c=l(33612),u=l(60166),m=l(61773),p=l(65720),v=l(70555),h=l(13742),x=l(37288),g=l(17518),f=l(94291),j=l(47401),y=l(26602),b=l(90251),$=l(79327),z=l(93075),k=l(78994),w=l(44285),C=l(75136),S=l(25184),I=l(70142),A=l(77668),L=l(59328);let P=(e,r)=>{var l,i,a;let n=null!==(l=null==e?void 0:e.name)&&void 0!==l?l:"Object",o={id:null!==(i=null==e?void 0:e.id)&&void 0!==i?i:"".concat(n.replace(/\s/g,""),"Model"),name:n,features:null!==(a=null==e?void 0:e.features)&&void 0!==a?a:{},keys:null!=r?r:{}};try{return t.Wk.load(o).getSourceCode()}catch(e){return"{}"}},F=e=>{let{children:r,...l}=e;return(0,i.jsx)(x.sL,{paddingLeft:"$4",overflow:"visible",...l,children:(0,i.jsx)(g.x,{fontSize:"$3",color:"$gray11",numberOfLines:1,style:{whiteSpace:"nowrap",overflow:"visible"},children:r})})},O=e=>{var r;let{data:l,setData:n,mode:s}=e,[d,k]=(0,a.useState)(""),w=["search","static","secret","display","textArea"],C=null!==(r=t.hn.options.map(e=>e.value))&&void 0!==r?r:[],P=["string","number","boolean","array","object","record","union","date","relation"],O=(e,r)=>{var i,a,t;return null!==(t=null==l?void 0:null===(a=l[e])||void 0===a?void 0:null===(i=a.modifiers)||void 0===i?void 0:i.some(e=>e.name===r))&&void 0!==t&&t},_=(0,a.useCallback)((e,r)=>{let i={...l},a=i[e],t={...a,type:r};switch(r){case"array":t.params=["z.any()"];break;case"union":{let e=Array.isArray(a.params)&&/z\.literal\(/.test((a.params||[]).join(","));t.params=e?a.params:[];break}default:void 0!==t.params&&delete t.params}if("date"===r){var o;let e=[...null!==(o=t.modifiers)&&void 0!==o?o:[]];e.some(e=>"datePicker"===e.name)||e.push({name:"datePicker"}),t.modifiers=e}else if(null==t?void 0:t.modifiers){let e=t.modifiers.filter(e=>"datePicker"!==e.name);t.modifiers=e.length?e:void 0}i[e]=t,n(i)},[l,n]),D=(0,a.useCallback)((e,r)=>{let i={...l},a={...i[e],params:r};i[e]=a,n(i)},[l,n]),E=e=>{let r={...l};delete r[e],n(r)},W=(e,r)=>{var i,a,t,o;let d={...l},c=null!==(a=null===(i=d[e])||void 0===i?void 0:i.modifiers)&&void 0!==a?a:[],u=c.some(e=>e.name===r);if("id"===r&&"add"===s&&!u)for(let r of Object.keys(d))r!==e&&(null===(o=d[r])||void 0===o?void 0:null===(t=o.modifiers)||void 0===t?void 0:t.some(e=>"id"===e.name))&&(d[r]={...d[r],modifiers:(d[r].modifiers||[]).filter(e=>"id"!==e.name)});d[e]={...d[e],modifiers:u?c.filter(e=>e.name!==r):[...c,{name:r}]},n(d)},M=(e,r)=>{let i=r.trim();i&&i!==e&&!l[i]&&n(Object.fromEntries(Object.entries(l).map(r=>{let[l,a]=r;return l===e?[i,a]:[l,a]})))},H=(0,a.useMemo)(()=>Object.keys(l||{}),[l]),Z={relation:e=>{var r,t,n,o,s,d,c;let[u,m]=(0,a.useState)([]),[p,v]=(0,a.useState)([]);return(0,a.useEffect)(()=>{(async()=>{var e,r;m(null===(r=(await S.API.get("/api/core/v1/objects")).data)||void 0===r?void 0:null===(e=r.items)||void 0===e?void 0:e.map(e=>e.name))})()},[]),(0,a.useEffect)(()=>{var r,i,a;let t=async e=>{var r;let l=null===(r=(await S.API.get("/api/core/v1/objects/"+e+"Model")).data)||void 0===r?void 0:r.keys;v(Object.keys(null!=l?l:{}))},n=null==l?void 0:null===(a=l[e])||void 0===a?void 0:null===(i=a.params)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.slice(1,-1);n&&t(n)},[null==l?void 0:null===(r=l[e])||void 0===r?void 0:r.params]),(0,i.jsxs)(x.FA,{px:"$2",gap:"$2",children:[(0,i.jsx)(g.x,{ml:"$2",color:"$gray11",fontSize:"$3",children:"Relation params"}),(0,i.jsxs)(x.sL,{gap:"$4",children:[(0,i.jsx)(L.E,{title:"Model name",placeholder:"Select related object",elements:u,value:null==l?void 0:null===(o=l[e])||void 0===o?void 0:null===(n=o.params)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.slice(1,-1),setValue:r=>{var i,a;return D(e,['"'.concat(r,'"'),null==l?void 0:null===(a=l[e])||void 0===a?void 0:null===(i=a.params)||void 0===i?void 0:i[1]])}}),(0,i.jsx)(L.E,{title:"Display field",placeholder:"Select the display field of the relation",elements:p,value:null==l?void 0:null===(c=l[e])||void 0===c?void 0:null===(d=c.params)||void 0===d?void 0:null===(s=d[1])||void 0===s?void 0:s.slice(1,-1),setValue:r=>{var i,a;return D(e,[null==l?void 0:null===(a=l[e])||void 0===a?void 0:null===(i=a.params)||void 0===i?void 0:i[0],'"'.concat(r,'"')])}})]})]})}},J=e=>{var r,t,S,A,L;let{k:F}=e,[D,H]=(0,a.useState)(F),J=O(F,"id"),T=O(F,"optional"),[X,R]=(0,a.useState)(!1),N=P.includes(null===(r=l[F])||void 0===r?void 0:r.type),q=()=>{D.trim()&&D!==F?M(F,D):H(F)};return(0,i.jsxs)(x.FA,{gap:"$2",borderWidth:1,borderColor:"$gray4",bc:"$gray3",p:"$2",br:"$4",onHoverIn:()=>R(!0),onHoverOut:()=>R(!1),children:[(0,i.jsxs)(x.sL,{flexDirection:"row",alignItems:"center",gap:"$4",width:"100%",children:[(0,i.jsxs)(x.sL,{flex:1,gap:"$2",children:[(0,i.jsx)(f.w,{label:"modifiers",delay:{open:500,close:0},children:(0,i.jsx)(j.zx,{circular:!0,animation:"bouncy",size:"$3",animateOnly:["rotate"],rotateX:d==F?"0deg":"180deg",icon:c.K,backgroundColor:"transparent",alignSelf:"center",onPress:()=>k(d==F?"":F)})}),(0,i.jsx)(y.II,{value:D,placeholder:"key name",disabled:"add"!==s,onChangeText:e=>{(/^[A-Za-z_][A-Za-z0-9_]*$/.test(e)||""===e)&&H(e)},onBlur:q,backgroundColor:"add"==s?"$gray1":"transparent",onSubmitEditing:q,borderColor:"$gray5",flex:1,borderWidth:"add"==s?1:0,hoverStyle:{backgroundColor:"$gray3"}})]}),(0,i.jsx)(x.sL,{width:120,jc:"center",children:(0,i.jsxs)(b.J2,{children:[(0,i.jsx)(b.J2.Trigger,{disabled:!N,children:(0,i.jsx)(j.zx,{variant:"outline",width:120,opacity:N?1:.5,disabled:!N,borderWidth:1,borderColor:"$gray5",hoverStyle:{backgroundColor:"$gray2"},backgroundColor:N?"$gray1":"transparent",justifyContent:"space-between",iconAfter:N?u._:o.E,children:(null===(t=l[F])||void 0===t?void 0:t.type)||"string"})}),(0,i.jsx)(b.J2.Content,{maxHeight:240,padding:"$2",gap:"$1",bc:"$gray1",borderColor:"$gray5",borderWidth:1,overflowY:"scroll",children:P.map(e=>{var r,a;return(0,i.jsx)(j.zx,{onPress:()=>{_(F,e),k("")},backgroundColor:(null===(r=l[F])||void 0===r?void 0:r.type)===e?"$color2":"transparent",width:"100%",justifyContent:"flex-start",iconAfter:(null===(a=l[F])||void 0===a?void 0:a.type)===e?(0,i.jsx)(I.I,{children:(0,i.jsx)(m.J,{size:14,color:"$color10"})}):null,children:e},e)})})]})}),(0,i.jsxs)(I.I,{children:[(0,i.jsx)(j.zx,{circular:!0,icon:J||!T?p.H:v.S,disabled:J,color:T?"$gray7":"$color10",scaleIcon:1.2,backgroundColor:"transparent",onPress:()=>W(F,"optional")}),(0,i.jsx)(j.zx,{circular:!0,backgroundColor:"add"!==s?"transparent":J?"$color6":"$gray2",disabled:"add"!==s,opacity:J?1:.5,onPress:()=>W(F,"id"),children:J||"add"===s?"ID":""})]}),(0,i.jsx)(j.zx,{size:"$3",backgroundColor:"transparent",circular:!0,icon:(0,i.jsx)(h.V,{size:16,color:"$red10"}),opacity:X?1:0,onPress:()=>E(F)})]}),Z[l[F].type]?Z[l[F].type](F):(0,i.jsx)(i.Fragment,{}),d==F&&(0,i.jsxs)(x.FA,{p:"$4",borderTopColor:"$gray6",borderTopWidth:1,gap:"$4",children:[(null===(S=l[F])||void 0===S?void 0:S.type)==="union"&&(0,i.jsxs)(x.FA,{gap:"$3",children:[(0,i.jsx)(g.x,{ml:"$2",color:"$gray11",fontSize:"$3",children:"union options"}),(0,i.jsx)(V,{k:F,data:l,setData:n,mode:s})]}),(0,i.jsxs)(x.FA,{children:[(0,i.jsx)(g.x,{ml:"$2",color:"$gray11",fontSize:"$3",children:"modifiers"}),(0,i.jsxs)(x.sL,{flexWrap:"wrap",gap:"$2",width:"100%",children:[w.map(e=>{var r,a;let t=null===(a=l[F])||void 0===a?void 0:null===(r=a.modifiers)||void 0===r?void 0:r.some(r=>r.name===e);return(0,i.jsx)(I.I,{children:(0,i.jsxs)(x.sL,{width:"130px",alignItems:"center",gap:"$2",flexDirection:"row",children:[(0,i.jsx)($.XZ,{checked:t,onCheckedChange:()=>W(F,e),backgroundColor:"$gray1",borderColor:"$gray6",children:(0,i.jsx)($.XZ.Indicator,{children:(0,i.jsx)(m.J,{color:"$color9"})})}),(0,i.jsx)(z.__,{children:e})]})},e)}),(null!==(L=null===(A=l[F])||void 0===A?void 0:A.modifiers)&&void 0!==L?L:[]).filter(e=>!w.includes(e.name)&&(null==C?void 0:C.some(r=>r===e.name))&&!["optional","id"].includes(e.name)).map(e=>(0,i.jsx)(f.w,{placement:"bottom-start",label:"Only editable in code view",delay:{open:500,close:0},restMs:0,children:(0,i.jsxs)(x.sL,{width:"130px",alignItems:"center",gap:"$2",flexDirection:"row",children:[(0,i.jsx)($.XZ,{checked:!0,disabled:!0,backgroundColor:"$gray1",borderColor:"transparent",children:(0,i.jsx)($.XZ.Indicator,{children:(0,i.jsx)(o.E,{color:"$color10"})})}),(0,i.jsx)(z.__,{children:e.name})]},e.name)},e.name))]})]})]})]},F)},V=e=>{var r;let{k:l,data:t,setData:n,mode:o}=e,s=e=>{let r;if(!e||!e.length)return[];let l=e.join(","),i=/z\.literal\((['"])(.*?)\1\)/g,a=[];for(;null!==(r=i.exec(l));)a.push(r[2]);return a},d=e=>{let r=e.map(e=>"z.literal(".concat(JSON.stringify(e),")")).join(", ");return["[".concat(r,"]")]},c=(0,a.useMemo)(()=>{var e;return s(null==t?void 0:null===(e=t[l])||void 0===e?void 0:e.params)},[null==t?void 0:null===(r=t[l])||void 0===r?void 0:r.params,t]),u=e=>{let r={...t},i=r[l]||{};r[l]={...i,params:d(e)},n(r)},m=c.length<2;return(0,i.jsxs)(x.FA,{gap:"$2",children:[(0,i.jsx)(I.I,{children:(0,i.jsx)(A.C,{values:c,setValues:e=>{("add"===o||"edit"===o)&&u(e)},placeholder:"Add options (comma, enter or newline)"})}),m&&(0,i.jsx)(g.x,{ml:"$2",color:"$red9",fontSize:"$2",children:"At least 2 options are required for a union type key."})]})};return(0,i.jsxs)(x.FA,{gap:"$4",flex:1,children:[H.length>0&&(0,i.jsxs)(x.sL,{flexDirection:"row",gap:"$4",paddingHorizontal:"$2",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(x.sL,{flex:1,children:(0,i.jsx)(F,{paddingLeft:"$10",children:"field name"})}),(0,i.jsx)(x.sL,{width:120,children:(0,i.jsx)(F,{paddingLeft:"$5",children:"type"})}),(0,i.jsx)(F,{width:40,mr:"$3",paddingLeft:"$0",children:"required"}),(0,i.jsx)(F,{width:40,paddingLeft:"$3",children:"ID"}),(0,i.jsx)(F,{width:40,children:" "})]}),(0,i.jsx)(x.FA,{gap:"$4",children:H.map(e=>(0,i.jsx)(J,{k:e},e))}),(0,i.jsx)(()=>{let[e,r]=(0,a.useState)(""),[t,o]=(0,a.useState)("string"),[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),p=(0,a.useCallback)(()=>{let i=e.trim();if(!i||!/^[A-Za-z_][A-Za-z0-9_]*$/.test(i)||l[i])return;let a={...l};if(u&&"add"===s)for(let e of Object.keys(a)){var p;let r=(null===(p=a[e])||void 0===p?void 0:p.modifiers)||[];r.some(e=>"id"===e.name)&&(a[e]={...a[e],modifiers:r.filter(e=>"id"!==e.name)})}let v=[...d?[{name:"optional"}]:[],...u?[{name:"id"}]:[]];a[i]={type:t,params:[],...v.length?{modifiers:v}:{}},n(a),r(""),o("string"),c(!1),m(!1)},[e,t,d,u,l,s,n]);return(0,i.jsxs)(x.sL,{alignItems:"center",gap:"$4",width:"100%",children:[(0,i.jsx)(y.II,{flex:1,placeholder:"key name",value:e,onChangeText:r,onSubmitEditing:p}),(0,i.jsx)(I.I,{children:(0,i.jsx)(j.zx,{disabled:!e,backgroundColor:e?"$color6":"$gray6",onPress:p,children:"Add"})})]})},{})]})},_=e=>{let{path:r,value:l,setValue:t,mode:c,formData:u,enableKeysTitle:m=!1}=e,p=null!=u?u:{},v=(0,a.useRef)(P(p,l)),[h,f]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),b=(0,a.useRef)({...p,keys:null!=l?l:{}}),$="view"===c||"preview"===c,[A,L]=(0,a.useState)(!1),F=async()=>{var e,r;let l=v.current;if($)return;f(!0);let i=null==l?void 0:l.trim();if(!i){y(null),b.current={...p,keys:{}},t({}),f(!1);return}let{isError:a,data:n}=await S.API.post("/api/core/v1/objects/parseKeys",{code:i,name:null!==(e=null==p?void 0:p.name)&&void 0!==e?e:"Temp"});if(a)y("Could not parse the schema.");else{y(null);let e=null!==(r=null==n?void 0:n.keys)&&void 0!==r?r:{};b.current={...p,keys:e},t(e)}f(!1)};return(0,a.useEffect)(()=>{A||(v.current=P(p,l))},[l,A]),(0,i.jsxs)(x.FA,{flex:1,gap:"$4",children:[(0,i.jsxs)(x.sL,{flexDirection:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(I.I,{children:(0,i.jsx)(z.__,{fontWeight:"bold",children:m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.a,{mr:"$2",color:"var(--color9)",size:"$1",strokeWidth:1}),"keys",(0,i.jsx)(k.n,{ml:"$1",color:"$color8",children:"*"})]})})}),(0,i.jsxs)(w.t,{size:"$3",type:"single",value:A?"code":"form",onValueChange:async e=>{"form"===e&&await F(),L("code"===e)},children:[(0,i.jsxs)(w.t.Item,{value:"form","aria-label":"Form View",children:[" ",(0,i.jsx)(d.J,{})," "]}),(0,i.jsxs)(w.t.Item,{value:"code","aria-label":"Code View",children:[" ",(0,i.jsx)(o.E,{})]})]})]}),(0,i.jsxs)(x.FA,{minHeight:"220px",gap:"$2",display:A&&!h?"flex":"none",children:[(0,i.jsx)(n.Monaco,{language:"typescript",sourceCode:v.current,onChange:e=>{v.current=null!=e?e:""},onSave:F,onBlur:F,options:{minimap:{enabled:!1},formatOnPaste:!0,readOnly:$}}),j?(0,i.jsx)(g.x,{color:"$red9",fontSize:"$3",children:j}):null]}),(0,i.jsx)(x.FA,{minHeight:"220px",gap:"$2",display:A||h?"none":"flex",children:(0,i.jsx)(O,{data:l,setData:t,mode:c})}),(0,i.jsx)(x.FA,{alignItems:"center",jc:"center",display:h?"flex":"none",minHeight:"220px",children:(0,i.jsx)(I.I,{children:(0,i.jsx)(C.$,{size:"large",color:"$color8",alignSelf:"center"})})})]})}},96120:function(e,r,l){l.d(r,{Wk:function(){return s},hn:function(){return a}});var i=l(25184);let a=i.z.union([i.z.literal("id"),i.z.literal("search"),i.z.literal("filter"),i.z.literal("generate"),i.z.literal("display"),i.z.literal("optional"),i.z.literal("email"),i.z.literal("color"),i.z.literal("file"),i.z.literal("datePicker"),i.z.literal("textArea"),i.z.literal("label"),i.z.literal("hint"),i.z.literal("static"),i.z.literal("min"),i.z.literal("max"),i.z.literal("secret"),i.z.literal("onCreate"),i.z.literal("onUpdate"),i.z.literal("onRead"),i.z.literal("onDelete"),i.z.literal("onList"),i.z.literal("name"),i.z.literal("picker"),i.z.literal("location")]),t=i.z.object({id:i.z.string().search().id().generate(e=>e.name.charAt(0).toUpperCase()+e.name.slice(1)+"Model").hidden(),name:i.z.string().search().static(),features:i.z.any().generate({},!0).hidden(),keys:i.z.record(i.z.string().optional(),i.z.object({type:i.z.union([i.z.literal("string"),i.z.literal("number"),i.z.literal("boolean"),i.z.literal("array"),i.z.literal("object"),i.z.literal("record"),i.z.literal("union"),i.z.literal("date"),i.z.literal("relation")]),params:i.z.array(i.z.string()).optional(),modifiers:i.z.array(i.z.object({name:a,params:i.z.array(i.z.string()).optional()}).name("name")).optional()}).name("name")).generate({}).size(2)}),n=i.z.object({...t.shape}),o=e=>({...e,keys:Object.keys(e.keys?e.keys:{}).reduce((r,l)=>{var i=l.replace(/\s/g,"");return{...r,[i]:{type:"string",...e.keys[l]}}},{})});class s extends i.ProtoModel{getDefaultSchemaFilePath(){return s.getDefaultSchemaFilePath(this.data.name,this.data.id)}static load(e,r){return this._newInstance(e,r)}getSourceCode(){let e=this.data;return"{"+Object.keys(e.keys).reduce((r,l,i)=>{let a=e.keys[l];if("date"==a.type&&(!a.modifiers||!a.modifiers.find(e=>"datePicker"==e.name))){var t;a.modifiers=[...null!==(t=null==a?void 0:a.modifiers)&&void 0!==t?t:[],{name:"datePicker",params:[]}]}let n=a.modifiers?a.modifiers.reduce((e,r)=>e+"."+r.name+"("+(r.params&&r.params.length?r.params.join(","):"")+")",""):"";return r+"\n	"+l+": z."+a.type+"("+(a.params&&a.params.length?a.params.join(","):"")+")"+n+","},"").slice(0,-1)+"\n}"}static getDefaultSchemaFilePath(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],"/data/objects/"+e+".ts"}create(e){let r=o(null!=e?e:this.getData());return super.create(r)}update(e,r){let l=o(null!=r?r:e.data);return super.update(e,l)}static _newInstance(e,r){return new s(e,r)}constructor(e,r){super(e,n,r,"Object")}}}}]);