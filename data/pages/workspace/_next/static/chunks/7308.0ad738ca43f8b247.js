"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7308],{87308:function(e,d,n){n.r(d),n.d(d,{UIFLOWID:function(){return s},VisualUiFlows:function(){return u}});var t=n(52322),l=n(2784),i=n(98133),a=n(93943),r=n(49716),o=n(34737);let s="flows-ui",c=(0,i.e)(s),u=e=>{let d=(e,d,n)=>Object.keys(d).reduce((e,t)=>{var l,i,r=d[t],o="prop-".concat(t);let s=null!==(i=null==n?void 0:null===(l=n.kinds)||void 0===l?void 0:l[t])&&void 0!==i?i:(0,a.GT)(r);var c={key:t,value:r,kind:s};return"children"==t&&(o="child-1",c=r),{...e,[o]:c}},{name:e});return(0,t.jsx)(c,{...e,flowId:s,enableCommunicationInterface:function(n){let{edges:t,nodeData:i,nodes:s,setEdges:c,setNodesData:u,deleteNodes:v,setNodes:f,createNode:p,setNodeData:h,_customComponents:k,onSaveNodes:m,flowId:w,data:b}=n;if((0,o.NT)()){let{lastEvent:d}=(0,o.jt)(e.contextAtom);(0,l.useEffect)(()=>{if(d)switch(d.action){case"add-nodes":case"delete-node":break;case"edit-node":{var e;let n=d.field,t=d.value,l=d.nodeId;e="prop"==d.type?{["prop-"+n]:{...i[l]["prop-"+n],value:t,key:n,kind:(0,a.GT)(t)}}:{"child-1":t},u({...i,[l]:{...i[l],...e}});break}default:throw Error("useVisualUi(...): Unhandled event type")}},[d])}else(0,l.useEffect)(()=>{let e=b[w+"/ui"];if(e){var n=e.nodeId;switch(e.action){case"delete-node":var l,o=null!==(l=e.deletedNodes)&&void 0!==l?l:[];let{updatedEdges:m,newNodeData:w}=v(o,e.parent,n,t,i);c(m),u(w),f(e=>e.filter(e=>!o.includes(e.id)));break;case"add-nodes":let b=e.parentData;var s=e.newNodesData;let I=s.map(e=>p([0,0],"JsxElement",e.id,e.data,!0,{},{})).flat();f(e=>e.concat(I)),u(null==s?void 0:s.reduce((e,n)=>{let t=n.childrens.reduce((e,d,n)=>({...e,["child-"+(n+1)]:""}),{});return{...e,[n.id]:{...d(n.name,n.props,n.data),...t}}},{...i,[b.id]:{...(0,r.MR)(i[b.id],b.childrenPos+1,"")}})),c(s.reduce((e,d)=>{var n,t,l,i=(null!==(l=null===(t=s.find(e=>e.childrens.includes(d.id)))||void 0===t?void 0:null===(n=t.childrens)||void 0===n?void 0:n.findIndex(e=>e==d.id))&&void 0!==l?l:b.childrenPos)+1;return(0,r.lm)(e,d.id,d.parent,i)},t));break;case"edit-node":let E=e.field,P=e.value;k="prop"==e.type?{["prop-"+E]:{...i[n]["prop-"+E],value:P,key:E,kind:(0,a.GT)(P)}}:{"child-1":P};var k,s={...i,[n]:{...i[n],...k}};u(s);break;case"move-node":if(e.isSameParent){let d=e.parent,n=e.childrenIndexes,l=Math.min(...n),a={...i[d]};h(d,(0,r.ro)(a,n,l)),c((0,r.lh)(t,d,l,n));return}{let d=e.oldParentId,l=e.oldPos+1,a=i[d],{data:o,deletedElementData:s}=(0,r.ap)(a,l),v=e.newParentId,f=i[v];if(!f)return;let p=Object.keys(f).filter(e=>e.startsWith("child-")).length,h=-1==e.newPos?p+1:e.newPos+1,k=(0,r.MR)(f,h,s);u({...i,[d]:o,[v]:k}),c((0,r.cV)(t,n,d,l,v,h))}}}},[b[w+"/ui"]]),(0,l.useEffect)(()=>{var e;(null===(e=b.savenodes)||void 0===e?void 0:e.value)&&m()},[b.savenodes])}})}}}]);