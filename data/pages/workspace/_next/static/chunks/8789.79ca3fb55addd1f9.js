"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8789],{18789:function(e,t,s){s.r(t),s.d(t,{default:function(){return eN}});var a=s(52322),r=s(2784),n=s(955),o=s(33051),l=s(79249),i=s(18537),c=s(37614),d=s(12294),h=s(47832),u=s(92490),x=s(92532),p=s(15729),g=s(19034),m=s.n(g);let y=["gpt-4","gpt-4-0613","gpt-4-1106-preview","gpt-4-turbo","gpt-3.5-turbo","gpt-3.5-turbo-16k","dall-e-3"],f=(0,d.Ue)((e,t)=>({chats:[],chatHistory:localStorage.getItem("chatHistory")?JSON.parse(localStorage.getItem("chatHistory")):{},addChat:(s,a)=>{e((0,p.Uy)(e=>{void 0!==a?e.chats[a]=s:e.chats.push(s)})),"assistant"===s.role&&s.content&&t().saveChats()},editChatMessage:(t,s)=>{e((0,p.Uy)(e=>{e.chats[s]&&(e.chats[s].content=t)}))},addNewChat:()=>{e((0,p.Uy)(e=>{e.chats=[]}))},saveChats:()=>{var s,a;let{settings:r}=v.getState(),n=r.apiUrl.split("/").pop();if(!n)return;let o=null===(s=t().chats[0])||void 0===s?void 0:s.id;if(!o)return;let l={id:o,createdAt:new Date().toISOString(),chats:t().chats,title:(null===(a=t().chats[0])||void 0===a?void 0:a.content)||"Untitled",isTitleEdited:!1};localStorage.setItem(o,JSON.stringify(l));let i=t().chatHistory,c=i[n]||[],d={...i,[n]:c.includes(o)?c:[...c,o]};localStorage.setItem("chatHistory",JSON.stringify(d)),e((0,p.Uy)(e=>{e.chatHistory=d}))},viewSelectedChat:t=>{e((0,p.Uy)(e=>{var s;let a=localStorage.getItem(t);a&&(e.chats=(null===(s=JSON.parse(a))||void 0===s?void 0:s.chats)||[])}))},resetChatAt:t=>{e((0,p.Uy)(e=>{e.chats[t]&&(e.chats[t].content="")}))},handleDeleteChats:t=>{let{settings:s}=v.getState(),a=s.apiUrl.split("/").pop();a&&e((0,p.Uy)(e=>{let s={...e.chatHistory};s[a]&&(s[a]=s[a].filter(e=>e!==t),0===s[a].length&&delete s[a]),e.chatHistory=s,localStorage.removeItem(t),localStorage.setItem("chatHistory",JSON.stringify(s))}))},editChatsTitle:(t,s)=>{e((0,p.Uy)(e=>{let a=localStorage.getItem(t);if(a){let e=JSON.parse(a);e.title=s,e.isTitleEdited=!0,localStorage.setItem(t,JSON.stringify(e))}}))},clearAllChats:()=>{e((0,p.Uy)(e=>{Object.values(e.chatHistory).forEach(e=>{e.forEach(e=>{localStorage.removeItem(e)})}),e.chatHistory={},e.chats=[],localStorage.removeItem("chatHistory")}))}})),j=(0,d.Ue)()((0,h.tJ)(e=>({token:localStorage.getItem("token")||"",apikey:localStorage.getItem("apikey")||"",user:{name:"Your name?",email:"",avatar:"/images/avatar.png"},setToken:t=>{e((0,p.Uy)(e=>{e.token=t}))},setUser:t=>{e((0,p.Uy)(e=>{e.user=t}))},setApiKey:t=>{e((0,p.Uy)(e=>{e.apikey=t})),localStorage.setItem("apikey",t)}}),{name:"auth"})),v=(0,u.F)()((0,h.tJ)(e=>({settings:{sendChatHistory:!0,systemMessage:"",useSystemMessageForAllChats:!1,selectedModal:"gpt-4-turbo",dalleImageSize:{"dall-e-3":"1024x1024"},apiUrl:""},modalsList:y,isSystemMessageModalVisible:!1,isModalVisible:!1,setSystemMessage:t=>{e((0,p.Uy)(e=>{e.settings.systemMessage=t.message,e.settings.useSystemMessageForAllChats=t.useForAllChats}))},setSystemMessageModalVisible:t=>{e((0,p.Uy)(e=>{e.isSystemMessageModalVisible=t}))},setSendChatHistory:t=>{e((0,p.Uy)(e=>{e.settings.sendChatHistory=t}))},setModal:t=>{e((0,p.Uy)(e=>{e.settings.selectedModal=t}))},setModalVisible:t=>{e((0,p.Uy)(e=>{e.isModalVisible=t}))},setModalsList:t=>{e((0,p.Uy)(e=>{e.modalsList=t}))},setDalleImageSize:(t,s)=>{e((0,p.Uy)(e=>{e.settings.dalleImageSize[s]=t}))},setApiUrl:t=>{e((0,p.Uy)(e=>{e.settings.apiUrl=t}))}}),{name:"settings",version:1,partialize:e=>({settings:e.settings}),migrate:(e,t)=>(0===t&&(e.dalleImageSize={"dall-e-3":"1024x1024"}),e)}),x.X),b=["Januray","February","March","April","May","June","July","August","September","October","November","December"],S=["Today","Previous 7 Days","Previous 30 Days","This month"].concat(b),C=e=>{let{settings:t}=v.getState(),s={},a=(t.apiUrl||"").split("/").pop();return a&&e.chatHistory[a]&&e.chatHistory[a].forEach(e=>{let t=localStorage.getItem(e);if(!t)return;let{title:a,id:r,createdAt:n}=JSON.parse(t),o=m()(n,"YYYY-MM-DD"),l=m()(),i=o.toDate().getMonth(),c={title:a,id:r,month:b[i],month_id:i};o.isSame(l,"day")?(s.Today||(s.Today=[]),s.Today.push(c)):l.subtract(7,"days").isBefore(o)?(s["Previous 7 Days"]||(s["Previous 7 Days"]=[]),s["Previous 7 Days"].push(c)):l.subtract(30,"days").isBefore(o)?(s["Previous 30 Days"]||(s["Previous 30 Days"]=[]),s["Previous 30 Days"].push(c)):(s[b[i]]||(s[b[i]]=[]),s[b[i]].push(c))}),s},w=e=>e.chats.length>0,$=e=>t=>{var s;return(null===(s=t.chats[0])||void 0===s?void 0:s.id)===e};var I=s(37288),P=s(47401),N=s(65457),k=s(29804),A=s(81622),U=s(43266),z=s(17518),M=s(52737),E=s(21705),O=s(99131),F=s(69517),T=s(26602);function H(e){let{chat:t,onPress:s=()=>{}}=e,n=f(e=>e.viewSelectedChat),l=f($(t.id)),[i,d]=f(e=>[e.handleDeleteChats,e.editChatsTitle]),[h,u]=(0,r.useState)(t.title),[x,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),y=l&&g;return(0,r.useEffect)(()=>{m(!1)},[l]),(0,a.jsxs)(I.sL,{onHoverIn:()=>p(!0),onHoverOut:()=>p(!1),bc:l?"$bgContent":"transparent",boc:"$color6",p:"$2",br:"$4",ai:"center",mb:"$1",cursor:"pointer",hoverStyle:{bc:"$bgContent"},children:[!y&&(0,a.jsxs)(I.sL,{h:"36px",f:1,ml:"$2",gap:"$2",ai:"center",overflow:"hidden",onPress:()=>{n(t.id),s()},children:[(0,a.jsxs)(I.sL,{children:[" ",(0,a.jsx)(M.Z,{size:18})," "]}),(0,a.jsx)(z.x,{numberOfLines:1,fos:14,fow:"400",children:h||t.title})]}),y&&(0,a.jsx)(T.II,{bc:"transparent",bw:0,h:"$2",width:"100%",borderColor:"transparent",focusStyle:{borderColor:"transparent",outlineColor:"$colorTransparent"},hoverStyle:{borderColor:"transparent"},mr:"2px",value:h,onChangeText:u,autoFocus:!0}),(l&&!g||x)&&(0,a.jsxs)(I.sL,{children:[(0,a.jsx)(F.z,{Icon:E.Z,onPress:()=>m(!0)}),(0,a.jsx)(F.z,{Icon:O.Z,onPress:()=>i(t.id)})]}),l&&g&&(0,a.jsxs)(I.sL,{children:[(0,a.jsx)(F.z,{IconColor:"var(--green9)",Icon:c.Z,onPress:()=>{var e;return e=t.id,void(""!==h.trim()&&(m(!1),u(h),d(e,h)))}}),(0,a.jsx)(F.z,{IconColor:"var(--red9)",Icon:o.Z,onPress:()=>m(!1)})]})]})}function Z(e){let{onPressChat:t=()=>{}}=e,s=f(C);return(0,a.jsxs)(I.FA,{className:"my-4 px-2 h-full text-gray-800 dark:text-[#ECECF1]",children:[Object.keys(s).length>0&&Object.keys(s).sort((e,t)=>S.indexOf(e)-S.indexOf(t)).map(e=>(0,a.jsxs)(I.FA,{children:[(0,a.jsx)(z.x,{my:8,pl:8,color:"$color9",children:e}),s[e].map((e,s)=>(0,a.jsx)(H,{chat:e,onPress:t},"".concat(e.id,"-").concat(s)))]},e)),0===Object.keys(s).length&&(0,a.jsx)(I.FA,{ai:"center",jc:"center",h:"100%",children:(0,a.jsx)(z.x,{children:"No chats yet"})})]})}function L(e){let{active:t,setActive:s}=e,r=f(e=>e.addNewChat),[d,h,u]=v(e=>[e.settings.selectedModal,e.modalsList,e.setModal]);j(e=>e.user.name);let x=h.reduce((e,t)=>{let s=t.split("-")[0]+"-"+t.split("-")[1];return{...e,[s]:[...e[s]||[],t]}},{});return(0,a.jsx)(I.FA,{overflow:"hidden",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:30,backgroundColor:t?"$colorTransparent":"transparent",opacity:t?1:0,pointerEvents:t?"auto":"none",animation:"quick",enterStyle:{opacity:0},exitStyle:{opacity:0},transition:"opacity 0.5s",children:(0,a.jsxs)(I.FA,{bc:"$bgPanel",p:"$3",w:"400px",maw:"80vw",h:"100%",overflow:"hidden",elevation:"$2",gap:"$2",shadowColor:"$shadowColor",children:[(0,a.jsxs)(I.sL,{jc:"space-between",ai:"center",children:[(0,a.jsx)(P.zx,{bc:"$bgContent",hoverStyle:{bc:"$bgContent",filter:"brightness(1.2)"},icon:n.Z,onPress:()=>{r(),s(!1)},children:"New Chat"}),(0,a.jsx)(P.zx,{hoverStyle:{bg:"$color8"},circular:!0,chromeless:!0,scaleIcon:1.3,icon:o.Z,onPress:()=>s(!1)})]}),(0,a.jsx)(N.p,{children:(0,a.jsx)(Z,{onPressChat:()=>s(!1)})}),(0,a.jsxs)(k.Ph,{value:d,onValueChange:e=>u(e),disablePreventBodyScroll:!0,children:[(0,a.jsx)(k.Ph.Trigger,{iconAfter:l.Z,bc:"$bgContent",hoverStyle:{bc:"$bgContent",filter:"brightness(1.2)"},children:(0,a.jsx)(k.Ph.Value,{placeholder:"Select model..."})}),(0,a.jsx)(A.Tr,{when:"sm",platform:"touch",children:(0,a.jsxs)(U.yo,{modal:!0,dismissOnSnapToBottom:!0,animationConfig:{type:"spring",damping:20,mass:1.2,stiffness:250},children:[(0,a.jsx)(U.yo.Frame,{children:(0,a.jsx)(U.yo.ScrollView,{children:(0,a.jsx)(A.Tr.Contents,{})})}),(0,a.jsx)(U.yo.Overlay,{animation:"lazy",enterStyle:{opacity:0},exitStyle:{opacity:0}})]})}),(0,a.jsxs)(k.Ph.Content,{zIndex:999999,children:[(0,a.jsx)(k.Ph.ScrollUpButton,{ai:"center",jc:"center",position:"relative",width:"100%",height:"$3",children:(0,a.jsx)(I.FA,{zIndex:10,children:(0,a.jsx)(i.Z,{size:20})})}),(0,a.jsx)(k.Ph.Viewport,{children:Object.keys(x).map(e=>(0,a.jsxs)(k.Ph.Group,{children:[(0,a.jsx)(k.Ph.Label,{o:.6,children:e.toUpperCase()}),x[e].map((e,t)=>(0,a.jsxs)(k.Ph.Item,{index:t,value:e,pl:"$8",children:[(0,a.jsx)(k.Ph.ItemText,{children:e}),(0,a.jsx)(k.Ph.ItemIndicator,{marginLeft:"auto",children:(0,a.jsx)(c.Z,{size:16})})]},e))]},e))}),(0,a.jsx)(k.Ph.ScrollDownButton,{ai:"center",jc:"center",position:"relative",width:"100%",height:"$3",children:(0,a.jsx)(I.FA,{zIndex:10,children:(0,a.jsx)(l.Z,{size:20})})})]})]})]})})}function D(e){let{visible:t=!0}=e;return(0,a.jsx)("div",{className:"flex flex-col items-center justify-end ".concat(t?"block":"hidden"," h-full py-4"),children:(0,a.jsx)("div",{className:"max-w-[900px] w-full px-4 md:px-0 mx-auto"})})}var J=s(57533),R=s(6364);function V(e,t,s){return{role:e,content:t,id:(0,R.Z)(),type:s}}var _=s(70142);function B(){let[e,t]=(0,r.useState)(""),s=(0,r.useRef)(null),n=f(e=>e.addChat),o=v(e=>e.settings.selectedModal);async function l(){e.trim()&&(n(V("user",e.trim(),"text")),n(V("assistant","",o.startsWith("dall-e")?"image_url":"text")),t(""))}return(0,a.jsxs)(I.sL,{ai:"center",jc:"space-between",gap:"$2",bc:"$bgPanel",p:"$2",br:"$10",children:[(0,a.jsx)(I.FA,{flex:1,children:(0,a.jsx)(T.II,{bc:"transparent",ref:s,value:e,placeholder:"Send a message",borderColor:"transparent",focusStyle:{borderColor:"transparent",outlineColor:"$colorTransparent"},hoverStyle:{borderColor:"transparent"},autoFocus:!0,onChangeText:t,onSubmitEditing:l})}),(0,a.jsx)(_.I,{children:(0,a.jsx)(P.zx,{icon:J.Z,circular:!0,onPress:l,backgroundColor:e?"var(--color5)":"transparent",color:e?"var(--color8)":"var(--gray11)"})})]})}var q=s(38002),W=s(69962),Y=s(72779),K=s.n(Y),G=s(37794),X=s(41456),Q=s(7954);function ee(){let[e,t]=(0,r.useState)(!1);return{copy:e=>{navigator.clipboard.writeText(e),t(!0),setTimeout(()=>{t(!1)},2e3)},copied:e}}async function et(e,t,s,a,r,n){try{var o;let s=v.getState().settings.apiUrl,l=await fetch(s,{method:"POST",signal:a,headers:{"content-type":"application/json",accept:"text/event-stream",Authorization:"Bearer ".concat(localStorage.getItem("apikey"))},body:JSON.stringify({model:v.getState().settings.selectedModal,temperature:.7,stream:!0,messages:e,metadata:t})});if(200!==l.status)throw console.error(l),Error("Error fetching results");let i=null===(o=l.body)||void 0===o?void 0:o.getReader(),c=!1;for(;;){let{done:e,value:t}=await i.read();if(e){c||r(""),n();break}new TextDecoder("utf-8").decode(t,{stream:!0}).split("\n").filter(e=>""!==e).forEach(e=>{if("data: [DONE]"===e.trim()||!e.startsWith("data: "))return;e=e.replace("data: ","");let t=JSON.parse(e);if(t.choices){if("stop"===t.choices[0].finish_reason)return;c=!0,r(t.choices[0].delta.content)}if(t.error)throw Error(t.error.message)})}}catch(e){if(console.error(e),e instanceof DOMException||e instanceof Error)throw Error(e.message)}}async function es(e,t,s){let a=v.getState().settings.selectedModal,r=await fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"content-type":"application/json",accept:"text/event-stream",Authorization:"Bearer ".concat(localStorage.getItem("apikey"))},body:JSON.stringify({model:a,prompt:e,n:s,size:v.getState().settings.dalleImageSize[a]})});return await r.json()}var ea=s(94225),er=s(56429),en=s(25184),eo=s(42377),el=s(2074);function ei(e){let{children:t,language:s}=e,{copy:r,copied:n}=ee();return(0,a.jsxs)("div",{className:"mycode relative",children:[(0,a.jsx)("div",{className:" absolute right-0 m-2 z-10",children:n?(0,a.jsx)("span",{className:"dark:text-teal-200 text-white text-xl",children:(0,a.jsx)(c.Z,{})}):(0,a.jsx)("button",{className:"edit md:ml-8 text-white dark:text-teal-200 text-xl",onClick:()=>r(t),children:(0,a.jsx)(X.Z,{})})}),(0,a.jsx)(eo.Z,{PreTag:"div",children:t,language:s,style:el.Z,className:" border-2 dark:border-teal-500 relative"})]})}s(78518);var ec=s(5893),ed=s(752);function eh(e){var t;let{index:s,chat:n}=e,[o]=(0,ed.KO)(ec.XD),{copy:l,copied:i}=ee(),[d,h]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),{result:m,error:y,isStreamCompleted:j,cursorRef:b}=function(e){let{index:t,chat:s,prompt:a}=e,n=(0,r.useRef)(s.content),o=(0,r.useRef)(null),[l,i]=(0,r.useState)(s.content),[c,d]=(0,r.useState)(""),[h,u]=(0,r.useState)(!1),x=f(e=>e.chats[t-1].content),[p,g]=f(e=>[e.chats,e.addChat]),[m,y,j,b]=v(e=>[e.settings.sendChatHistory,e.settings.selectedModal,e.settings.systemMessage,e.settings.useSystemMessageForAllChats]),S=(0,r.useRef)(p);S.current=p;let C=(0,ea.y1)(()=>{o.current&&o.current.scrollIntoView(!0)},50);return(0,r.useEffect)(()=>{function e(e){n.current+=e,i(t=>t+e),C()}function r(){""!==n.current.trim()&&g(V("assistant",n.current,s.type),t),u(!0)}if(s.content||h)return;let o=!0,l=new AbortController,c=l.signal;return i(""),n.current="",u(!1),d(""),(async()=>{try{let s=m?S.current.slice(0,t).filter(e=>"text"===e.type).map(e=>({role:e.role,content:e.content})):[{role:S.current[t-1].role,content:S.current[t-1].content}];b&&j&&(s=[{role:"system",content:j},...s]),await et(s,{context:a},y,c,e,r)}catch(e){(e instanceof Error||"string"==typeof e)&&o&&function(e){let a="string"==typeof e?e:e.message;d(a),n.current="Error processing the request: "+a,i(n.current),u(!0),g(V("assistant",n.current,s.type),t)}(e)}})(),()=>{l.abort(),o=!1}},[x,g,t,C,s.content,s.id,s.type,m,y,j,b]),{query:x,result:l,error:c,isStreamCompleted:h,cursorRef:o}}({index:s,chat:n,prompt:o.reduce((e,t)=>e+t.generate(),"")+"\n    reply directly to the user, acting as the assistant.\n  "}),S=(null!=m?m:"").trim()||(null!==(t=n.content)&&void 0!==t?t:""),C=S,w=null;if(S)try{let e=JSON.parse(S);e&&"object"==typeof e&&("string"==typeof e.response&&(C=e.response),Array.isArray(e.approvals)&&e.approvals.length>0&&(w=e.approvals[0]))}catch(e){}if(j&&!S.trim())return null;if(!w)return(0,a.jsx)(I.FA,{jc:"flex-start",children:j||S||y?(0,a.jsxs)(I.FA,{children:[(0,a.jsx)(er.UG,{children:C||S,components:{code(e){let{children:t,className:s,node:r,...n}=e,o=/language-(\w+)/.exec(s||"");return o?(0,a.jsx)(ei,{language:o[1],children:String(t).replace(/\n$/,"")}):(0,a.jsx)("code",{...n,className:null==s?void 0:s.concat("language"),children:t})}}}),!j&&!n.content&&(0,a.jsx)("span",{className:"ml-1 blink bg-gray-500 dark:bg-gray-200 h-4 w-1 inline-block",ref:b}),(0,a.jsx)(I.sL,{children:i?(0,a.jsx)(F.z,{Icon:c.Z,onPress:()=>l(C||S)}):(0,a.jsx)(F.z,{Icon:X.Z,onPress:()=>l(C||S)})})]}):(0,a.jsx)(I.FA,{py:"$3",px:"$4",jc:"center",children:(0,a.jsx)(Q.Z,{color:"gray",size:8,speedMultiplier:.5})})});{let e=w.boardId,t=w.action,s=w.approvalId||w.id,r=w.message||(t?'The action "'.concat(t,'" requests approval.'):"This action requests approval."),n=async()=>{try{var a;if(p||d||(g(!0),!e||!t||!s))return;let r=(null===(a=w.urls)||void 0===a?void 0:a.accept)||"/api/core/v1/boards/".concat(encodeURIComponent(e),"/actions/").concat(encodeURIComponent(t),"/approvals/").concat(encodeURIComponent(s),"/accept");await en.API.post(r,{}),h(!0),x(!1)}catch(e){console.error("Approval accept error",e)}finally{g(!1)}},o=async a=>{try{var r;if(p||d||(g(!0),!e||!t||!s))return;let a=(null===(r=w.urls)||void 0===r?void 0:r.reject)||"/api/core/v1/boards/".concat(encodeURIComponent(e),"/actions/").concat(encodeURIComponent(t),"/approvals/").concat(encodeURIComponent(s),"/reject");await en.API.post(a,{}),h(!0),x(!0)}catch(e){console.error("Approval cancel error",e)}finally{g(!1)}};return(0,a.jsxs)(I.FA,{gap:"$3",py:"$3",children:[(0,a.jsx)(z.x,{o:.6,fow:"600",children:d?u?"Request rejected":"Request applied":r}),!d&&(0,a.jsxs)(I.sL,{gap:"$2",children:[(0,a.jsx)(P.zx,{themeInverse:!0,bc:"$bgPanel",size:"$3",onPress:n,disabled:p,children:"Accept"}),(0,a.jsx)(P.zx,{bc:"$bgPanel",size:"$3",onPress:o,disabled:p,children:"Cancel"})]})]})}}function eu(e){let{src:t,children:s,className:r}=e,n=K()("rounded",r),o=j(e=>e.user.avatar);return(0,a.jsxs)("div",{className:K()("avatar rounded relative"),children:[(0,a.jsx)("img",{src:t||o,alt:"avatar",className:n}),s]})}function ex(e){let{src:t}=e;return(0,a.jsx)("div",{className:" flex items-center flex-grow m-1",children:(0,a.jsx)("img",{src:t,alt:"bot_response_image",className:" h-auto w-full object-cover"})})}function ep(){return(0,a.jsx)("div",{className:"flex items-center justify-center h-full  bg-gray-300 rounded w-full dark:bg-gray-700 animate-pulse",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-gray-200 dark:text-gray-600","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 18",children:(0,a.jsx)("path",{d:"M18 0H2a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2Zm-5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm4.376 10.481A1 1 0 0 1 16 15H4a1 1 0 0 1-.895-1.447l3.5-7A1 1 0 0 1 7.468 6a.965.965 0 0 1 .9.5l2.775 4.757 1.546-1.887a1 1 0 0 1 1.618.1l2.541 4a1 1 0 0 1 .028 1.011Z"})})})}var eg=s(11478);function em(e){let{index:t,chat:s}=e,{loading:o,error:l,image:i}=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"512x512",[a,n]=(0,r.useState)(t.content),[o,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(null),[d,h]=f(t=>[t.chats[e-1].content,t.addChat]),u=(0,r.useCallback)(x,[d,s,h,e]);async function x(){l(!0),await es(d,s,1).then(t=>{n(t.data[0].url),h(V("assistant",t.data[0].url,"image_url"),e)}).catch(e=>{c(e.message)}).finally(()=>{l(!1)})}return(0,r.useEffect)(()=>{t.content||u()},[u,t.content]),{image:a,loading:o,error:i,refetchImages:function(){x()}}}(t,s),[c,d]=(0,r.useState)(!1),h=async()=>{d(!0)};return(0,a.jsxs)("div",{className:"flex items-start w-full",children:[(0,a.jsx)("div",{className:"mr-4  rounded-md flex items-center flex-shrink-0",children:(0,a.jsx)(eu,{className:" h-11 w-11",src:"/images/bot.webp"})}),(0,a.jsxs)("div",{className:" image border-4 border-teal-700 rounded flex-grow",children:[o&&(0,a.jsx)("div",{className:" h-[300px] w-full",children:(0,a.jsx)(ep,{})}),l&&(0,a.jsx)("p",{children:l}),(0,a.jsx)("div",{className:" flex items-center flex-wrap",children:!o&&(0,a.jsx)(ex,{src:i},i)})]}),(0,a.jsx)("div",{className:" text-xl dark:text-gray-200  text-gray-500",children:c?(0,a.jsx)("span",{className:"dark:text-gray-200 text-gray-500 text-xl",children:(0,a.jsx)(n.Z,{})}):(0,a.jsx)("button",{className:"edit md:ml-8 text-gray-500 dark:text-gray-200 text-xl",onClick:h,children:(0,a.jsx)(eg.Z,{})})})]})}let ey={hidden:{scale:.8,opacity:0},visible:{scale:1,opacity:1}};function ef(e){let{index:t,chat:s}=e;return(0,a.jsx)("div",{className:K()("gap-3 px-3 md:px-0"),children:(0,a.jsx)(G.E.div,{variants:ey,initial:"hidden",animate:"visible",style:{maxWidth:"900px"},children:s.type&&"image_url"===s.type?(0,a.jsx)(em,{index:t,chat:s}):(0,a.jsx)(eh,{index:t,chat:s})})})}var ej=s(91506),ev=s(54243);function eb(e){let{chat:t,chatIndex:s}=e,[n,o]=(0,r.useState)(!1),[l,i]=(0,r.useState)(t.content),[c,d]=(0,r.useState)(!1),h=(0,r.useRef)(null),[u,x]=f(e=>[e.editChatMessage,e.resetChatAt]);return(0,r.useEffect)(()=>{n&&h.current&&(h.current.style.height=h.current.scrollHeight+"px")},[n]),(0,a.jsx)(I.FA,{p:"$3",gap:"$2",ai:"flex-end",children:(0,a.jsx)(I.sL,{jc:"flex-end",ai:"center",gap:"$2",width:"100%",children:n?(0,a.jsxs)(I.FA,{backgroundColor:"$bgPanel",flex:1,width:"100%",p:"$4",ai:"flex-end",br:"$6",gap:"$3",children:[(0,a.jsx)(ev.K,{p:0,fos:"$5",backgroundColor:"transparent",spellCheck:!1,ref:h,value:l,onChangeText:e=>{i(e);let t=h.current;t&&(t.style.height="auto",t.style.height="".concat(t.scrollHeight,"px"))},autoFocus:!0,multiline:!0,rows:1,borderWidth:0,focusStyle:{outlineWidth:0},w:"100%",minHeight:0,h:"auto"}),n&&(0,a.jsxs)(I.sL,{gap:"$2",children:[(0,a.jsx)(P.zx,{fow:"500",w:"$8",size:"$3",bc:"$gray6",hoverStyle:{bc:"$gray2"},onPress:()=>o(!1),children:"Cancel"}),(0,a.jsx)(P.zx,{fow:"500",w:"$8",size:"$3",themeInverse:!0,bc:"$gray6",hoverStyle:{bc:"$gray4"},onPress:function(){u(l,s),x(s+1),o(!1)},children:"Save"})]})]}):(0,a.jsxs)(I.FA,{maxWidth:"100%",gap:"$2",ai:"flex-end",onHoverIn:()=>d(!0),onHoverOut:()=>d(!1),children:[(0,a.jsx)(I.FA,{bg:"$bgPanel",br:"$6",p:"10px",children:(0,a.jsxs)(z.x,{fos:"$5",children:[" ",t.content]})}),(0,a.jsx)(F.z,{alignSelf:"flex-end",o:c?1:0,Icon:ej.Z,onPress:()=>o(e=>!e)})]})})})}var eS=s(70155);function eC(){let e=f(e=>e.chats),t=f(e=>e.addChat),s=(0,r.useRef)(null);(0,eS.uF)((e,s)=>{try{let e=JSON.parse(s.message).payload.message;t(V("assistant",e,"text"))}catch(e){console.error(e)}},{path:"chat/notifications/#"});let n=()=>{s.current&&s.current.scrollIntoView({behavior:"smooth"})};return(0,r.useEffect)(()=>{n()},[e]),(0,a.jsxs)(I.FA,{f:1,overflow:"hidden",children:[e.map((e,t)=>"assistant"===e.role?(0,a.jsx)(ef,{index:t,chat:e},e.id):(0,a.jsx)(eb,{chat:e,chatIndex:t},e.id)),(0,a.jsx)("div",{ref:s})]})}var ew=s(16399),e$=s(22522),eI=s(94291);let eP=e=>{"light"===e&&document.documentElement.classList.contains("dark")?document.documentElement.classList.remove("dark"):"dark"!==e||document.documentElement.classList.contains("dark")||document.documentElement.classList.add("dark")};var eN=function(e){let{apiUrl:t}=e,[s,n]=(0,r.useState)(!1),o=f(w),l=f(e=>{var t;return null===(t=e.chats[0])||void 0===t?void 0:t.id}),[i,c]=(0,r.useState)("Chat"),d=f(e=>e.addNewChat),{resolvedTheme:h}=(0,ew.P)(),u=v(e=>e.setApiUrl);return(0,r.useEffect)(()=>{eP(h)},[h]),(0,r.useEffect)(()=>{t&&u(t)},[t]),(0,r.useEffect)(()=>{try{if(!l){c("Chat");return}let e=localStorage.getItem(l);if(!e){c("Chat");return}let{title:t}=JSON.parse(e);c(t||"Chat")}catch(e){c("Chat")}},[l]),(0,a.jsxs)(e$.Kq,{backgroundColor:"light"===h?"":"#212121",f:1,className:"h-screen flex flex-col",children:[(0,a.jsx)(L,{active:s,setActive:n}),(0,a.jsxs)(I.FA,{flex:1,bc:"$bgContent",children:[(0,a.jsxs)(I.sL,{w:"100%",jc:"space-between",ai:"center",bbc:"$color6",bbw:2,bc:"$bgContent",p:"$1",children:[(0,a.jsx)(eI.w,{label:"Chat History",children:(0,a.jsx)(P.zx,{circular:!0,icon:q.Z,scaleIcon:1.3,chromeless:!0,onPress:()=>n(!0)})}),(0,a.jsx)(z.x,{col:"$color",children:i}),(0,a.jsx)(eI.w,{label:"Start New Chat",children:(0,a.jsx)(P.zx,{circular:!0,icon:W.Z,scaleIcon:1.3,chromeless:!0,onPress:d})})]}),(0,a.jsx)(N.p,{p:"$2",pb:"$8",children:o?(0,a.jsx)(eC,{}):(0,a.jsx)(D,{})}),(0,a.jsx)(I.FA,{h:"$5"}),(0,a.jsx)(I.FA,{pos:"absolute",bottom:"$2",w:"100%",px:"$2",children:(0,a.jsx)(B,{})})]})]})}}}]);