"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6471],{26471:function(e,t,r){r.r(t),r.d(t,{SequenceView:function(){return x}});var i=r(52322),d=r(2784),l=r(78822),n=r(37288),o=r(17518),a=r(12397),s=r(94756),c=r(25184),p=r(36265);let g=e=>{let{model:t,item:r,index:d,onSelectItem:l,getCard:a}=e,c=t.load(r),p=t.getObjectFields().filter(e=>{let r=t.getObjectSchema().getFieldDefinition(e);return"ZodString"==r.typeName&&!r.id});return(0,i.jsx)(s._l,{draggableId:c.getId(),isDragDisabled:!c.canTransition(),index:d,children:e=>(0,i.jsx)("div",{ref:e.innerRef,...e.draggableProps,...e.dragHandleProps,style:{userSelect:"none",margin:"0 0 8px 0",...e.draggableProps.style},children:a?a(r,d):(0,i.jsxs)(n.FA,{onPress:()=>l(c),p:"$3",br:"$4",bc:"$backgroundStrong",boc:"$gray4",bw:"$0.5",hoverStyle:{elevation:5,scale:1.01},pressStyle:{elevation:.01},animation:"bouncy",transition:"all 0.2s",gap:"$2",children:[(0,i.jsx)(o.x,{fos:"$3",fontStyle:"italic",color:"$color9",children:c.getId()}),p.map(e=>(0,i.jsxs)(n.FA,{mb:"$4",fos:"$4",children:[(0,i.jsxs)(o.x,{color:"$color8",fontWeight:"600",fontSize:"$3",children:[e,": "]}),(0,i.jsx)(o.x,{fontWeight:"400",fontSize:"$3",children:c.get(e)})]},e))]})})},c.getId())},x=e=>{var t,r,x;let{items:f,onStageChange:u=()=>{},onSelectItem:b=()=>{},model:h,getCard:$,onDragEnd:m=()=>{},getStageBottom:I,getDroppableStageStyle:j=(e,t)=>({}),getStageContainerProps:v=e=>({}),sort:S=(e,t)=>!0,...y}=e,[w,F]=(0,d.useState)({}),{query:k}=(0,p.N)({}),D=new URLSearchParams(k).toString(),P=Object.keys(w).reduce((e,t)=>e.concat(w[t]),[]),q=(null!==(x=f.data.items)&&void 0!==x?x:[]).sort((e,t)=>{let r=P.indexOf(e[h.getIdField()]),i=P.indexOf(t[h.getIdField()]);return -1===r&&-1===i?0:-1===r?1:-1===i?-1:r-i}).sort(S),A=h.getSequeceField(),N=h.getObjectSchema().getFieldDefinition(A),C=null===(r=({...N,...null==N?void 0:null===(t=N.innerType)||void 0===t?void 0:t._def}).options)||void 0===r?void 0:r.map(e=>e.value),O=e=>null==q?void 0:q.filter(t=>t[h.getSequeceField()]===e),_=(e,t,r)=>{let i=e.reduce((e,t)=>{let r=t[A];return e[r]||(e[r]=[]),e[r].push(t[h.getIdField()]),e},{});F(i),c.API.post("/api/core/v1/sequences/"+h.getModelName()+"?"+D,i),u(h.load(t),{positionsByColumn:i}),m({error:!1,sourceData:t,destinationData:r,updatedItems:e,message:"Item moved",positionsByColumn:i})},E=["orange","yellow","green","blue","purple","pink","red"],z=e=>E[e%E.length],L=async()=>{let e=h.getModelName(),t=await c.API.get("/api/core/v1/sequences/"+e+"?"+D);!t.isError&&t.data&&F(t.data)};return(0,d.useEffect)(()=>{L()},[D]),(0,i.jsx)(s.Z5,{onDragEnd:e=>{let{source:t,destination:r}=e;if(!r||r.droppableId===t.droppableId&&r.index===t.index)return;let i=[...q],d=i.filter(e=>e[A]===t.droppableId),[l]=d.splice(t.index,1),n=h.load(l),o={...l,[A]:r.droppableId};if(!n.canTransition(o))return m({error:!0,message:"Invalid transition",sourceData:l,destinationData:o});if(l[A]=o[A],t.droppableId===r.droppableId)d.splice(r.index,0,l),_(i.filter(e=>e[A]!==t.droppableId).concat(d),l,o);else{let e=i.filter(e=>e[A]===r.droppableId),n=i.findIndex(e=>e[h.getIdField()]===l[h.getIdField()]);i.splice(n,1),e.splice(r.index,0,l),_(i.filter(e=>e[A]!==t.droppableId&&e[A]!==r.droppableId).concat(d,e),l,o)}},children:(0,i.jsx)(n.sL,{gap:"$2",padding:"$4",f:1,overflow:"scroll",...y,children:C?C.map((e,t)=>(0,i.jsxs)(n.FA,{theme:z(t),bc:"$background",br:"$4",bw:"$0.5",p:"$2",pt:"$2.5",borderColor:"$gray4",...v(e),children:[(0,i.jsxs)(n.sL,{gap:"$2",mb:"$2",ac:"center",jc:"flex-start",p:"2px",children:[(0,i.jsx)(l.A,{text:e,textProps:{fow:"600"},gap:"$2",ai:"center",px:"$2",children:(0,i.jsx)(a.C,{size:10,bc:"$color8"})}),(0,i.jsx)(o.x,{fos:"$3",color:"$gray8",children:O(e).length})]}),(0,i.jsx)(s.bK,{droppableId:e,children:t=>(0,i.jsxs)("div",{ref:t.innerRef,...t.droppableProps,style:{width:"250px",minWidth:"250px",minHeight:"300px",padding:"2px",height:"100%",overflowY:"auto",...j(e,t)},children:[O(e).map((e,t)=>(0,i.jsx)(g,{model:h,item:e,index:t,onSelectItem:b,getCard:$},e.id)),t.placeholder]})}),I&&I(e,O(e))]},e)):(0,i.jsx)(o.x,{textAlign:"center",f:1,mt:"$10",fow:"400",color:"$color10",children:"No sequence stages defined. Check if the sequence defined has stages or options."})})})}}}]);