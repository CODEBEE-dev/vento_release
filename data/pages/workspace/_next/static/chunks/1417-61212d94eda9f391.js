"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1417],{71727:function(e,l,n){n.d(l,{u:function(){return N},lM:function(){return L}});var i=n(52322),t=n(2784),o=n(37288),a=n(75136),r=n(17518),d=n(25184),s=n(93228),c=n(14503),u=n(47401),h=n(22522),v=n(52015),p=n(21603),x=n(85706),g=n(3885),m=n(16399),j=n(27704),f=n(96325),y=n.n(f);let w={"elk.algorithm":"layered","elk.layered.considerModelOrder.strategy":"NODES_AND_EDGES","elk.hierarchyHandling":"SEPARATE_CHILDREN","elk.layered.crossingMinimization.forceNodeModelOrder":!0,"elk.layered.crossingMinimization.strategy":"LAYER_SWEEP","elk.layered.spacing.nodeNodeBetweenLayers":"150","elk.spacing.nodeNode":"100"},$=function(e){var l,n,i,t,o;arguments.length>1&&void 0!==arguments[1]&&arguments[1];let a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return{layoutOptions:(null===(l=e.children)||void 0===l?void 0:l.length)?w:{},id:e.id,width:null!==(t=null===(n=e.measured)||void 0===n?void 0:n.width)&&void 0!==t?t:e.width,height:null!==(o=null===(i=e.measured)||void 0===i?void 0:i.height)&&void 0!==o?o:e.height,children:e.children?e.children.map((e,l)=>$(e,l,a,r)):[]}},b=(e,l,n,i)=>{var t,o,a,r=i;let d=(Object.keys(l).forEach(e=>{l[e]._devicePositioning&&(t={id:e,...l[e]})}),t);if(e.id!=(null==d?void 0:d.id)){let l=(o=e.id,n.filter(e=>e.source==o)[0]);r=null===(a=d._devicePositioning.filter(e=>{if(e)return e.includes(null==l?void 0:l.targetHandle.split("element-")[1])})[0])||void 0===a?void 0:a.split("-")[1]}return r},I=(e,l,n,i,t)=>{let o=l.filter(l=>b(l,n,i,e)==e).map(e=>$(e,0,i,n));return{id:"root",layoutOptions:{...w,"elk.direction":"l"==e?"LEFT":"RIGHT"},children:o,edges:i.filter(e=>o.find(l=>l.id==e.source)&&o.find(l=>l.id==e.target)&&t.find(l=>l&&l.id==e.source)&&t.find(l=>l&&l.id==e.target)).sort((e,l)=>{let n=e.targetHandle.split("_"),i=l.targetHandle.split("_"),t=n[n.length-1],o=i[i.length-1];return t.startsWith("block")&&o.startsWith("block")&&e.target==l.target?parseInt(t.substr(5),10)-parseInt(o.substr(5),10):0}).map((e,l)=>({id:e.id,sources:[e.source],targets:[e.target]}))}},A=async(e,l,n,i)=>{let t=new(y()),o=(e=>{let n=[],i=(e,t)=>{let o={...e,position:e.position?{...e.position}:void 0,data:{...e.data}};if(delete o.children,t&&(o.parentId=t),n.push(o),e.children&&e.children.length){let n=l.find(l=>l.source==e.children[0].id);if(n){let i=JSON.parse(JSON.stringify(n));i.source=e.id,i.sourceHandle=e.id+"-output",l.push(i)}e.children.forEach(l=>i(l,e.id))}};return e.forEach(e=>i(e,null)),n})(e),a=I("l",e,i,l,o),r=I("r",e,i,l,o);try{await t.layout(a),await t.layout(r)}catch(e){console.error("Error in layout: ",e)}var d={};let s=(e,l,i)=>e.forEach(e=>{let t=o.find(l=>l.id==e.id);if(t){d[t.id]={layouted:!0,outputPos:i};let o=e.x-l,a=e.y;t.position={x:t.id==n.id?0:o,y:t.id==n.id?0:a},e.children&&e.children.length&&(t.data.height=e.height,t.data.width=e.width)}e&&e.children&&s(e.children,l,i)}),c=r.children.reduce((e,l)=>Math.max(l.x+l.width-150,e),0);return s(r.children,c,"right"),s(a.children,-150,"left"),{nodes:o,edges:l,metadata:d}};var C=n(57441),P=n(60892),z=n(70142);let S=e=>{let{...l}=e;return(0,i.jsx)(z.I,{tint:l.tint,children:(0,i.jsx)(u.zx,{backgroundColor:"transparent",hoverStyle:{backgroundColor:"$color4"},color:"$color8",size:"$3",circular:!0,scaleIcon:1.5,...l})})},E=e=>{var l,n;let{definition:a,onSave:d,onCancel:s}=e,{resolvedTheme:c}=(0,m.P)(),u=(0,j.l)(),f="/workspace/deviceDefinitions",y=Object.fromEntries(u.entries()),w=null==a?void 0:a.sdk,$=null==a?void 0:a.board,b=(0,t.useRef)(null==a?void 0:null===(l=a.config)||void 0===l?void 0:l.components);return(0,i.jsxs)(o.FA,{f:1,children:[(0,i.jsxs)(h.Kq,{style:{flexDirection:"row"},w:"100%",gap:"$2",jc:"space-between",ai:"center",px:"$3",py:"$2",children:[(0,i.jsx)(r.x,{fow:"600",children:null==a?void 0:a.name}),(0,i.jsxs)(o.sL,{children:[(0,i.jsx)(S,{tint:"green",onPress:()=>d({...a,config:{...null==a?void 0:a.config,components:b.current}}),icon:P.v}),(0,i.jsx)(S,{tint:"red",onPress:s,icon:C.X})]})]}),(0,i.jsx)(o.FA,{f:1,minWidth:"100%",className:"device-config-flow",children:(0,i.jsx)(v.Z,{style:{width:"100%"},disableDots:!1,hideBaseComponents:!0,disableStart:!0,autoFitView:!0,getFirstNode:e=>e.find(e=>"ArrayLiteralExpression"==e.type),layout:A,customComponents:(0,g.B)(f,y),customSnippets:(0,p.j)(f,y),bridgeNode:!1,setSourceCode:e=>{e.current=e},sourceCode:null!==(n=b.current)&&void 0!==n?n:"",themeMode:c,config:{masks:(0,g.W)(f,y),layers:[],menu:(0,x.N)(f,y)},bgColor:"transparent",dataNotify:e=>{e.notifyId},onEdit:e=>b.current=e,positions:[],disableSideBar:!0,display:!0,flowId:"flows-editor",metadata:{board:$,sdk:w}},"flow")})]})};var F=n(75773);let k={loading:!1,error:void 0,mode:"none",title:"Edit",definition:null,yamlPath:void 0},N=e=>{let{target:l,open:n,onClose:u,onSaved:h}=e,v=(0,c.Py)(),[p,x]=(0,t.useState)(k);(0,t.useEffect)(()=>{if(!n||!l){x(k);return}switch(l.type){case"device":g(l.deviceName);break;case"definition":m(l.definitionName);break;case"yaml-esphome":j(l.yamlPath,l.yamlTitle);break;default:x(k)}},[n,l]);let g=async e=>{if(!e||"undefined"===e){x({...k,error:"Invalid device name"});return}x({...k,loading:!0,title:"Loading ".concat(e,"...")});try{let l=await d.API.get("/api/core/v1/devices/".concat(encodeURIComponent(e)));if(l.isError||!l.data){x({...k,error:'Device "'.concat(e,'" not found')});return}let n=l.data,i=n.deviceDefinition;if(i){await m(i);return}let t=n.config||"data/devices/".concat(e,"/config.yaml");x({loading:!1,error:void 0,mode:"yaml-esphome",title:"Edit config: ".concat(e),definition:null,yamlPath:t})}catch(e){x({...k,error:"Error loading device"})}},m=async e=>{if(!e||"undefined"===e){x({...k,error:"Invalid definition name"});return}x({...k,loading:!0,title:"Loading ".concat(e,"...")});try{let l=await d.API.get("/api/core/v1/devicedefinitions/".concat(encodeURIComponent(e)));if(l.isError||!l.data){x({...k,error:'Template "'.concat(e,'" not found')});return}let n=l.data;"esphome-yaml"===n.sdk?x({loading:!1,error:void 0,mode:"yaml-esphome",title:"Edit template: ".concat(e," (YAML)"),definition:null,yamlPath:"data/deviceDefinitions/".concat(e,"/config.yaml")}):x({loading:!1,error:void 0,mode:"visual",title:"Edit template: ".concat(e),definition:n,yamlPath:void 0})}catch(e){x({...k,error:"Error loading template"})}},j=(e,l)=>{var n;if(!e||"undefined"===e){x({...k,error:"Invalid YAML path"});return}let i=l||(null===(n=e.split("/").pop())||void 0===n?void 0:n.replace(".yaml",""))||"Config";x({loading:!1,error:void 0,mode:"yaml-esphome",title:"Edit: ".concat(i),definition:null,yamlPath:e})},f=async e=>{if(!(null==e?void 0:e.name)){x(e=>({...e,error:"Template data is invalid"}));return}x(e=>({...e,loading:!0,error:void 0}));let l=await d.API.post("/api/core/v1/devicedefinitions/".concat(encodeURIComponent(e.name)),e);if(null==l?void 0:l.isError){x(e=>{var n;return{...e,loading:!1,error:(null==l?void 0:null===(n=l.error)||void 0===n?void 0:n.message)||"Unable to save template"}});return}v.show("Template updated",{message:e.name}),null==h||h(e.name),u()},y=()=>{x(k),u()};return(0,i.jsx)(s.a,{open:n,setOpen:e=>{e||y()},title:p.title,description:"",hideAccept:!0,onOpenChange:e=>{e||y()},children:(0,i.jsx)(o.FA,{width:"min(1200px, 90vw)",height:"80vh",padding:"$2",gap:"$3",children:p.loading?(0,i.jsxs)(o.sL,{alignItems:"center",justifyContent:"center",flex:1,gap:"$2",children:[(0,i.jsx)(a.$,{size:"small"}),(0,i.jsx)(r.x,{color:"$gray10",children:"Loadingâ€¦"})]}):p.error?(0,i.jsx)(o.FA,{alignItems:"center",justifyContent:"center",flex:1,children:(0,i.jsx)(r.x,{color:"$red9",children:p.error})}):"yaml-esphome"===p.mode&&p.yamlPath?(0,i.jsx)(o.FA,{flex:1,width:"100%",children:(0,i.jsx)(F.Z,{path:p.yamlPath,name:p.title})}):"visual"===p.mode&&p.definition?(0,i.jsx)(E,{definition:p.definition,onSave:f,onCancel:y}):(0,i.jsx)(o.FA,{alignItems:"center",justifyContent:"center",flex:1,children:(0,i.jsx)(r.x,{color:"$gray11",children:"Nothing to edit."})})})})},L=e=>{let[l,n]=(0,t.useState)({open:!1,target:null}),i=e=>{e&&"undefined"!==e&&n({open:!0,target:{type:"definition",definitionName:e}})},o=()=>{n({open:!1,target:null})},a={open:l.open,onClose:o,onSaved:null==e?void 0:e.onSaved,target:l.target};return{openDevice:e=>{e&&"undefined"!==e&&n({open:!0,target:{type:"device",deviceName:e}})},openDefinition:i,openYaml:(e,l)=>{e&&"undefined"!==e&&n({open:!0,target:{type:"yaml-esphome",yamlPath:e,yamlTitle:l}})},closeEditor:o,openTemplate:i,openEditor:i,isOpen:l.open,target:l.target,editorProps:a}}},80609:function(e,l,n){n.d(l,{C:function(){return P}});var i=n(52322),t=n(2784),o=n(37288),a=n(17518),r=n(47401),d=n(54243),s=n(14503),c=n(26602),u=n(2037),h=n(29804),v=n(93228),p=n(70142),x=n(68604),g=n(13742),m=n(60892),j=n(57441),f=n(60166),y=n(61773),w=n(89702),$=n(25184);let b=e=>{if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(e){return""}},I=e=>{try{return JSON.parse(JSON.stringify(null!=e?e:[]))}catch(l){return e}},A=e=>{let{label:l,value:n,onChange:s,placeholder:c}=e,[u,h]=(0,t.useState)(b(n)),[p,x]=(0,t.useState)(null),[g,m]=(0,t.useState)(!1),[f,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{f||h(b(n))},[n,f]);let $=e=>{var l,n,i;let t="string"==typeof e?e:null!==(n=null==e?void 0:null===(l=e.target)||void 0===l?void 0:l.value)&&void 0!==n?n:"";if(h(t),""===t.trim()){x(null);return}try{JSON.parse(t),x(null)}catch(e){x(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Invalid JSON")}},I=()=>{if(""===u.trim()){s(void 0),x(null);return}try{let e=JSON.parse(u);s(e),x(null)}catch(l){var e;x(null!==(e=null==l?void 0:l.message)&&void 0!==e?e:"Invalid JSON")}};return(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(a.x,{size:"$2",color:"$color10",children:l}),(0,i.jsx)(r.zx,{size:"$1",icon:w.U,onPress:()=>m(!0)})]}),(0,i.jsx)(d.K,{value:u,onChange:$,onChangeText:$,onFocus:()=>y(!0),onBlur:()=>{I(),y(!1)},minHeight:100,fontFamily:"monospace",placeholder:c}),p?(0,i.jsx)(a.x,{size:"$2",color:"$red10",children:p}):null,(0,i.jsx)(v.a,{open:g,setOpen:e=>{e||I(),m(!!e)},hideAccept:!0,width:"100vw",height:"100vh",p:"$0",children:(0,i.jsxs)(o.FA,{gap:"$2",padding:"$4",height:"100%",width:"100%",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(a.x,{fow:"700",children:l}),(0,i.jsx)(r.zx,{size:"$2",icon:j.X,onPress:()=>{I(),m(!1)}})]}),(0,i.jsxs)(o.FA,{flex:1,width:"100%",children:[(0,i.jsx)(d.K,{value:u,onChange:$,onChangeText:$,onFocus:()=>y(!0),onBlur:()=>{I(),y(!1)},fontFamily:"monospace",minHeight:"100%",flex:1,placeholder:c}),p?(0,i.jsx)(a.x,{size:"$2",color:"$red10",children:p}):null]})]})})]})},C=e=>{let{title:l,children:n,defaultOpen:d=!0}=e,[s,c]=(0,t.useState)(d);return(0,i.jsxs)(o.FA,{gap:"$2",width:"100%",children:[(0,i.jsxs)(r.zx,{unstyled:!0,padding:"$2",borderRadius:"$3",onPress:()=>c(e=>!e),backgroundColor:"$color2",hoverStyle:{backgroundColor:"$color3"},justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,i.jsx)(a.x,{fow:"700",children:l}),(0,i.jsx)(f._,{size:16,style:{transform:[{rotate:s?"0deg":"-90deg"}]}})]}),s?(0,i.jsx)(o.FA,{gap:"$2",children:n}):null]})},P=e=>{let{open:l,onClose:n,deviceName:d,subsystems:w,onSaved:b}=e,P=(0,s.Py)(),[z,S]=(0,t.useState)(I(null!=w?w:[])),[E,F]=(0,t.useState)(!1),[k,N]=(0,t.useState)(null),[L,O]=(0,t.useTransition)();(0,t.useEffect)(()=>{l&&(S(I(null!=w?w:[])),N(null))},[l,w]);let T=(e,l,n)=>{O(()=>{S(i=>{var t;let o=[...null!=i?i:[]],a=null!==(t=o[e])&&void 0!==t?t:{monitors:[],actions:[]};return o[e]={...a,[l]:n},o})})},W=(e,l,n,i)=>{O(()=>{S(t=>{var o,a,r;let d=[...null!=t?t:[]],s=null!==(o=d[e])&&void 0!==o?o:{monitors:[],actions:[]},c=[...null!==(a=s.monitors)&&void 0!==a?a:[]];return c[l]={...null!==(r=c[l])&&void 0!==r?r:{},[n]:i},d[e]={...s,monitors:c},d})})},_=(e,l,n,i)=>{O(()=>{S(t=>{var o,a,r;let d=[...null!=t?t:[]],s=null!==(o=d[e])&&void 0!==o?o:{monitors:[],actions:[]},c=[...null!==(a=s.actions)&&void 0!==a?a:[]];return c[l]={...null!==(r=c[l])&&void 0!==r?r:{},[n]:i},d[e]={...s,actions:c},d})})},R=e=>O(()=>S(l=>(null!=l?l:[]).filter((l,n)=>n!==e))),J=e=>O(()=>S(l=>{var n,i;let t=[...null!=l?l:[]],o=null!==(n=t[e])&&void 0!==n?n:{monitors:[],actions:[]},a=[...null!==(i=o.monitors)&&void 0!==i?i:[],{name:"",label:"",endpoint:"",units:"",connectionType:"mqtt"}];return t[e]={...o,monitors:a},t})),M=(e,l)=>O(()=>S(n=>{var i,t;let o=[...null!=n?n:[]],a=null!==(i=o[e])&&void 0!==i?i:{monitors:[],actions:[]},r=(null!==(t=a.monitors)&&void 0!==t?t:[]).filter((e,n)=>n!==l);return o[e]={...a,monitors:r},o})),D=e=>O(()=>S(l=>{var n,i;let t=[...null!=l?l:[]],o=null!==(n=t[e])&&void 0!==n?n:{monitors:[],actions:[]},a=[...null!==(i=o.actions)&&void 0!==i?i:[],{name:"",label:"",endpoint:"",connectionType:"mqtt",payload:{type:"str",value:""}}];return t[e]={...o,actions:a},t})),U=(e,l)=>O(()=>S(n=>{var i,t;let o=[...null!=n?n:[]],a=null!==(i=o[e])&&void 0!==i?i:{monitors:[],actions:[]},r=(null!==(t=a.actions)&&void 0!==t?t:[]).filter((e,n)=>n!==l);return o[e]={...a,actions:r},o})),V=e=>{var l;if(Array.isArray(e))return"select";let n=(null!==(l=null==e?void 0:e.type)&&void 0!==l?l:"").toString();return["slider","json-schema","select","str","string","int","integer","float","number","json"].includes(n)?n:(null==e||e.value,"str")},H=(e,l,n)=>{O(()=>{S(i=>{var t,o,a;let r;let d=[...null!=i?i:[]],s=null!==(t=d[e])&&void 0!==t?t:{monitors:[],actions:[]},c=[...null!==(o=s.actions)&&void 0!==o?o:[]];switch(n){case"select":r=[{label:"Option 1",value:"option1"}];break;case"slider":r={type:"slider",min_value:0,max_value:100,step:1,initial_value:0,unit:""};break;case"json-schema":r={type:"json-schema",schema:{}};break;case"int":case"integer":r={type:"int",value:0};break;case"float":case"number":r={type:"float",value:0};break;case"json":r={type:"json",value:{}};break;default:r={type:n,value:""}}return c[l]={...null!==(a=c[l])&&void 0!==a?a:{},payload:r},d[e]={...s,actions:c},d})})},B=async()=>{var e,l,i,t,o,a;if(!d){N("No device name provided");return}F(!0),N(null);try{let a=await $.API.get("/api/core/v1/devices/".concat(d)),r=null!==(e=null==a?void 0:a.data)&&void 0!==e?e:a;if(!r||(null==a?void 0:a.isError))throw Error(null!==(l=null==a?void 0:a.error)&&void 0!==l?l:"Unable to load device");let s={...r,subsystem:z},c=!1;try{let e=(null===$.API||void 0===$.API?void 0:$.API.post)?await $.API.post("/api/core/v1/devices/".concat(encodeURIComponent(d)),s):void 0;if(!e||(null==e?void 0:e.isError)){if(null==e?void 0:e.isError)throw Error(null!==(i=null==e?void 0:e.error)&&void 0!==i?i:"Failed to save subsystems")}else c=!0}catch(e){console.warn("Subsystems save via API.post failed, retrying with fetch",e)}if(!c){let e="/api/core/v1/devices/".concat(encodeURIComponent(d)),l=async l=>{let n;let i=await fetch(e,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"}),t=await i.text().catch(()=>"");try{n=t?JSON.parse(t):void 0}catch(e){}if(!i.ok||(null==n?void 0:n.error)||(null==n?void 0:n.isError)){var o;let e=null!==(o=null==n?void 0:n.error)&&void 0!==o?o:t||"Failed to save subsystems (".concat(i.status,")");throw Error(e)}};try{await l("PUT")}catch(e){if((null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("(404)"))||(null==e?void 0:null===(o=e.message)||void 0===o?void 0:o.includes("(405)")))await l("POST");else throw e}}P.show("Device subsystems updated",{duration:2e3}),null==b||b(z),n()}catch(l){let e=null!==(a=null==l?void 0:l.message)&&void 0!==a?a:"Failed to save subsystems";N(e),P.show(e,{duration:3e3})}finally{F(!1)}};return l?(0,i.jsx)(v.a,{open:l,setOpen:e=>{e||n()},hideAccept:!0,width:"95vw",height:"85vh",p:"$0",children:(0,i.jsxs)(o.FA,{padding:"$4",gap:"$3",height:"100%",overflow:"hidden",width:"100%",maxWidth:"100%",alignSelf:"stretch",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:1,backgroundColor:"$background",paddingBottom:"$2",children:[(0,i.jsx)(a.x,{fow:"700",children:"Edit subsystems"}),(0,i.jsxs)(o.sL,{gap:"$2",children:[(0,i.jsx)(r.zx,{size:"$2",icon:j.X,disabled:E,onPress:()=>n(),children:"Close"}),(0,i.jsx)(r.zx,{size:"$2",icon:m.v,disabled:E,onPress:B,children:E?"Saving...":"Save"})]})]}),k?(0,i.jsx)(a.x,{color:"$red10",size:"$2",children:k}):null,(0,i.jsxs)(o.FA,{gap:"$3",width:"100%",maxWidth:"100%",overflow:"auto",flex:1,children:[null==z?void 0:z.map((e,l)=>{var n,t,d,s,v,m;return(0,i.jsx)(p.I,{width:"100%",children:(0,i.jsxs)(o.FA,{gap:"$3",padding:"$3",width:"100%",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(a.x,{fow:"600",children:(null==e?void 0:e.name)||"Subsystem ".concat(l+1)}),(0,i.jsx)(r.zx,{size:"$2",icon:g.V,onPress:()=>R(l),theme:"red",disabled:E,children:"Remove subsystem"})]}),(0,i.jsxs)(C,{title:"Subsystem info",children:[(0,i.jsxs)(o.sL,{gap:"$3",flexWrap:"wrap",children:[(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:220,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Name"}),(0,i.jsx)(c.II,{placeholder:"Name",value:null!==(d=null==e?void 0:e.name)&&void 0!==d?d:"",onChange:e=>T(l,"name",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:220,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Type"}),(0,i.jsx)(c.II,{placeholder:"Type",value:null!==(s=null==e?void 0:e.type)&&void 0!==s?s:"",onChange:e=>T(l,"type",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:220,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Label"}),(0,i.jsx)(c.II,{placeholder:"Label",value:null!==(v=null==e?void 0:e.label)&&void 0!==v?v:"",onChange:e=>T(l,"label",e.target.value)})]})]}),(0,i.jsx)(A,{label:"Config (JSON)",value:null!==(m=null==e?void 0:e.config)&&void 0!==m?m:{},onChange:e=>T(l,"config",null!=e?e:{}),placeholder:'{"example":true}'})]}),(0,i.jsx)(C,{title:"Monitors",children:(0,i.jsxs)(o.FA,{gap:"$2",width:"100%",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(a.x,{fow:"600",children:"Monitors"}),(0,i.jsx)(r.zx,{size:"$2",icon:x.v,onPress:()=>J(l),disabled:E,children:"Add monitor"})]}),null==e?void 0:null===(n=e.monitors)||void 0===n?void 0:n.map((e,n)=>{var t,d,s,h,v;return(0,i.jsx)(p.I,{width:"100%",children:(0,i.jsx)(C,{title:(null==e?void 0:e.label)||(null==e?void 0:e.name)||"Monitor ".concat(n+1),children:(0,i.jsxs)(o.FA,{gap:"$2",padding:"$2",width:"100%",children:[(0,i.jsx)(o.sL,{justifyContent:"flex-end",alignItems:"center",children:(0,i.jsx)(r.zx,{size:"$2",icon:g.V,theme:"red",onPress:()=>M(l,n),disabled:E,children:"Remove"})}),(0,i.jsxs)(o.sL,{gap:"$2",flexWrap:"wrap",width:"100%",children:[(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:200,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Name"}),(0,i.jsx)(c.II,{placeholder:"Name",value:null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",onChange:e=>W(l,n,"name",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:200,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Label"}),(0,i.jsx)(c.II,{placeholder:"Label",value:null!==(d=null==e?void 0:e.label)&&void 0!==d?d:"",onChange:e=>W(l,n,"label",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",flex:1,minWidth:240,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Endpoint"}),(0,i.jsx)(c.II,{placeholder:"Endpoint",value:null!==(s=null==e?void 0:e.endpoint)&&void 0!==s?s:"",onChange:e=>W(l,n,"endpoint",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:120,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Units"}),(0,i.jsx)(c.II,{placeholder:"Units",value:null!==(h=null==e?void 0:e.units)&&void 0!==h?h:"",onChange:e=>W(l,n,"units",e.target.value)})]}),(0,i.jsxs)(o.sL,{alignItems:"center",gap:"$2",children:[(0,i.jsx)(a.x,{size:"$2",children:"Ephemeral"}),(0,i.jsx)(u.rs,{checked:!!(null==e?void 0:e.ephemeral),onCheckedChange:e=>W(l,n,"ephemeral",!!e),children:(0,i.jsx)(u.rs.Thumb,{})})]})]}),(0,i.jsx)(A,{label:"Props (JSON)",value:null!==(v=null==e?void 0:e.props)&&void 0!==v?v:{},onChange:e=>W(l,n,"props",null!=e?e:{}),placeholder:'{"color":"#fff"}'})]})})},"sub-".concat(l,"-mon-").concat(n))})]})}),(0,i.jsx)(C,{title:"Actions",children:(0,i.jsxs)(o.FA,{gap:"$2",width:"100%",children:[(0,i.jsxs)(o.sL,{justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(a.x,{fow:"600",children:"Actions"}),(0,i.jsx)(r.zx,{size:"$2",icon:x.v,onPress:()=>D(l),disabled:E,children:"Add action"})]}),null==e?void 0:null===(t=e.actions)||void 0===t?void 0:t.map((e,n)=>{var t,d,s,u,v,m,j,w,$;return(0,i.jsx)(p.I,{width:"100%",children:(0,i.jsx)(C,{title:(null==e?void 0:e.label)||(null==e?void 0:e.name)||"Action ".concat(n+1),children:(0,i.jsxs)(o.FA,{gap:"$2",padding:"$2",width:"100%",children:[(0,i.jsx)(o.sL,{justifyContent:"flex-end",alignItems:"center",children:(0,i.jsx)(r.zx,{size:"$2",icon:g.V,theme:"red",onPress:()=>U(l,n),disabled:E,children:"Remove"})}),(0,i.jsxs)(o.sL,{gap:"$2",flexWrap:"wrap",width:"100%",children:[(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:200,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Name"}),(0,i.jsx)(c.II,{placeholder:"Name",value:null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",onChange:e=>_(l,n,"name",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:200,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Label"}),(0,i.jsx)(c.II,{placeholder:"Label",value:null!==(d=null==e?void 0:e.label)&&void 0!==d?d:"",onChange:e=>_(l,n,"label",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",flex:1,minWidth:240,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Description"}),(0,i.jsx)(c.II,{placeholder:"Description",value:null!==(s=null==e?void 0:e.description)&&void 0!==s?s:"",onChange:e=>_(l,n,"description",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",flex:1,minWidth:240,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Endpoint"}),(0,i.jsx)(c.II,{placeholder:"Endpoint",value:null!==(u=null==e?void 0:e.endpoint)&&void 0!==u?u:"",onChange:e=>_(l,n,"endpoint",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:160,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Connection type"}),(0,i.jsx)(c.II,{placeholder:"Connection type",value:null!==(v=null==e?void 0:e.connectionType)&&void 0!==v?v:"",onChange:e=>_(l,n,"connectionType",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:140,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Mode"}),(0,i.jsx)(c.II,{placeholder:"Mode",value:null!==(m=null==e?void 0:e.mode)&&void 0!==m?m:"",onChange:e=>_(l,n,"mode",e.target.value)})]}),(0,i.jsxs)(o.FA,{gap:"$1",width:"100%",maxWidth:160,children:[(0,i.jsx)(a.x,{size:"$2",textAlign:"center",children:"Reply timeout (ms)"}),(0,i.jsx)(c.II,{placeholder:"Reply timeout (ms)",value:null!==(j=null==e?void 0:e.replyTimeoutMs)&&void 0!==j?j:"",onChange:e=>_(l,n,"replyTimeoutMs",e.target.value)})]})]}),(0,i.jsxs)(o.FA,{gap:"$2",width:"100%",children:[(0,i.jsx)(a.x,{fow:"600",children:"Payload"}),(0,i.jsxs)(o.sL,{gap:"$2",flexWrap:"wrap",alignItems:"center",children:[(0,i.jsx)(a.x,{size:"$2",children:"Type"}),(0,i.jsxs)(h.Ph,{value:V(null==e?void 0:e.payload),onValueChange:e=>H(l,n,e),disablePreventBodyScroll:!0,children:[(0,i.jsx)(h.Ph.Trigger,{iconAfter:f._,width:180,children:(0,i.jsx)(h.Ph.Value,{placeholder:"Type"})}),(0,i.jsx)(h.Ph.Content,{zIndex:1e6,children:(0,i.jsx)(h.Ph.Viewport,{children:(0,i.jsx)(h.Ph.Group,{children:["str","int","float","number","json","select","slider","json-schema"].map(e=>(0,i.jsxs)(h.Ph.Item,{value:e,children:[(0,i.jsx)(h.Ph.ItemText,{children:e}),(0,i.jsx)(h.Ph.ItemIndicator,{marginLeft:"auto",children:(0,i.jsx)(y.J,{size:16})})]},e))})})})]})]}),(()=>{var t,a,d,s,u,h,v,p,m,j,f,y;let w=V(null==e?void 0:e.payload);if("select"===w){let t=Array.isArray(null==e?void 0:e.payload)?e.payload:[];return(0,i.jsxs)(o.FA,{gap:"$2",children:[t.map((e,a)=>{var d,s;return(0,i.jsxs)(o.sL,{gap:"$2",alignItems:"center",children:[(0,i.jsx)(c.II,{placeholder:"Label",value:null!==(d=null==e?void 0:e.label)&&void 0!==d?d:"",onChange:e=>{_(l,n,"payload",t.map((l,n)=>n===a?{...l,label:e.target.value}:l))}}),(0,i.jsx)(c.II,{placeholder:"Value",value:null!==(s=null==e?void 0:e.value)&&void 0!==s?s:"",onChange:e=>{_(l,n,"payload",t.map((l,n)=>n===a?{...l,value:e.target.value}:l))}}),(0,i.jsx)(r.zx,{size:"$2",icon:g.V,theme:"red",onPress:()=>{_(l,n,"payload",t.filter((e,l)=>l!==a))},children:"Remove"})]},"opt-".concat(a))}),(0,i.jsx)(r.zx,{size:"$2",icon:x.v,onPress:()=>_(l,n,"payload",[...t,{label:"Option",value:""}]),children:"Add option"})]})}if("slider"===w){let t=null!==(a=null==e?void 0:e.payload)&&void 0!==a?a:{},r=(i,t)=>{var o;_(l,n,"payload",{...null!==(o=null==e?void 0:e.payload)&&void 0!==o?o:{},[i]:t,type:"slider"})};return(0,i.jsxs)(o.sL,{gap:"$2",flexWrap:"wrap",children:[(0,i.jsx)(c.II,{placeholder:"Min",value:null!==(d=t.min_value)&&void 0!==d?d:"",onChange:e=>r("min_value",e.target.value)}),(0,i.jsx)(c.II,{placeholder:"Max",value:null!==(s=t.max_value)&&void 0!==s?s:"",onChange:e=>r("max_value",e.target.value)}),(0,i.jsx)(c.II,{placeholder:"Step",value:null!==(u=t.step)&&void 0!==u?u:"",onChange:e=>r("step",e.target.value)}),(0,i.jsx)(c.II,{placeholder:"Initial",value:null!==(h=t.initial_value)&&void 0!==h?h:"",onChange:e=>r("initial_value",e.target.value)}),(0,i.jsx)(c.II,{placeholder:"Unit",value:null!==(v=t.unit)&&void 0!==v?v:"",onChange:e=>r("unit",e.target.value)})]})}if("json-schema"===w){let t=null!==(m=null==e?void 0:null===(p=e.payload)||void 0===p?void 0:p.schema)&&void 0!==m?m:{};return(0,i.jsx)(A,{label:"Schema (JSON)",value:t,onChange:e=>_(l,n,"payload",{type:"json-schema",schema:null!=e?e:{}}),placeholder:'{"type":"object","properties":{}}'})}return"json"===w?(0,i.jsx)(A,{label:"Value (JSON)",value:null!==(f=null==e?void 0:null===(j=e.payload)||void 0===j?void 0:j.value)&&void 0!==f?f:{},onChange:i=>{var t;return _(l,n,"payload",{...null!==(t=null==e?void 0:e.payload)&&void 0!==t?t:{},type:"json",value:null!=i?i:{}})},placeholder:'{"key":"value"}'}):(0,i.jsx)(o.sL,{gap:"$2",flexWrap:"wrap",children:(0,i.jsx)(c.II,{placeholder:"Value",value:null!==(y=null==e?void 0:null===(t=e.payload)||void 0===t?void 0:t.value)&&void 0!==y?y:"",onChange:i=>{var t;return _(l,n,"payload",{...null!==(t=null==e?void 0:e.payload)&&void 0!==t?t:{},type:w,value:i.target.value})},flex:1})})})()]}),(0,i.jsx)(A,{label:"Props (JSON)",value:null!==(w=null==e?void 0:e.props)&&void 0!==w?w:{},onChange:e=>_(l,n,"props",null!=e?e:{}),placeholder:'{"theme":"green","color":"$green10"}'}),(0,i.jsx)(A,{label:"Card props (JSON)",value:null!==($=null==e?void 0:e.cardProps)&&void 0!==$?$:{},onChange:e=>_(l,n,"cardProps",null!=e?e:{}),placeholder:'{"icon":"power","color":"$green10"}'})]})})},"sub-".concat(l,"-act-").concat(n))})]})})]})},"sub-".concat(l))}),(0,i.jsx)(r.zx,{icon:x.v,onPress:()=>O(()=>S(e=>{var l;return[...null!=e?e:[],{name:"subsystem_".concat((null!==(l=null==e?void 0:e.length)&&void 0!==l?l:0)+1),type:"",monitors:[],actions:[]}]})),disabled:E,children:"Add subsystem"})]})]})}):null}},38017:function(e,l,n){n.d(l,{w:function(){return a}});var i=n(52322),t=n(47401),o=n(17518);let a=n(2784).forwardRef((e,l)=>{let{textColor:n,fontFamily:a,...r}=e;return(0,i.jsx)(t.zx,{ref:l,borderRadius:"$10",size:"$3",elevate:!0,space:"$3",...r,children:(0,i.jsx)(o.x,{color:n,fontFamily:a,display:"flex",alignItems:"center",children:r.children})})});l.Z=a}}]);