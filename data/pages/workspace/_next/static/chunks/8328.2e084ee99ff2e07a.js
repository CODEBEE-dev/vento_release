"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8328],{58328:function(e,t,n){n.r(t),n.d(t,{ContentEditable:function(){return e$},default:function(){return eU},newVisualUiContext:function(){return q.iz},useVisualUi:function(){return q.jt},useVisualUiAtom:function(){return q.ZB},useVisualUiComms:function(){return q.fH}});var o=n(52322),i=n(2784),r=n(27704),l=n(79428),s=n(8293),a=n(7771),d=n(18299),c=n(28316),u=n(23579),p=n(13742),h=n(17864),x=n(73750),f=n(41051),g=n(10281),m=n(39006),v=n(37288),y=n(16399);let C={dark:{nodeBackgroundColor:"#252526",interactiveHoverColor:"#2C446A",interactiveHoverColorDarken:"#2C446A",interactiveColor:"#4772b3",inputBackgroundColor:"#404040",secondaryBackground:"#191919",borderColor:"grey",blockPort:"grey",flowPort:"grey",dataPort:"grey",textColor:"#CCCCCC",dataOutputColor:"grey",nodeBorderColor:"grey",edgeColor:"grey",titleColor:"black",separatorColor:"#424242"},light:{edgeColor:"#888",nodeBackgroundColor:"#fdfdfd",inputBackgroundColor:"white",secondaryBackground:"#E7E7E7",textColor:"#19191A",interactiveColor:"#009AFB",interactiveHoverColor:"#CEE7FE",interactiveHoverColorDarken:"#2773BC",borderColor:"#888",dataOutputColor:"black",blockPort:"#fefefe",flowPort:"#fefefe",dataPort:"#fefefe",nodeBorderColor:"#aaa",disableTextColor:"#acacac",separatorColor:"#D4D4D4",titleColor:"#222"}},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{resolvedTheme:n}=(0,y.P)(),o={...C[n]};try{return o[e]}catch(e){return t}};var E=n(46988),j=n(6364),k=n(90251),w=n(61773);let S=e=>{let{name:t,icon:n,selected:r=!1,...l}=e,[s,a]=(0,i.useState)(!1),d=s?b("interactiveColor"):b("textColor");return(0,o.jsxs)("div",{onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),...l,style:{cursor:"pointer",justifyContent:"space-between",width:"100%",display:"flex",alignItems:"center",flex:1,alignSelf:"flex-start",padding:"12px",...l.style},children:[(0,o.jsx)("div",{style:{color:d},children:t}),(0,o.jsxs)("div",{children:[n?(0,i.createElement)(n,{color:d,size:16,paddingTop:"2px"}):null,r?(0,o.jsx)(w.J,{size:16,style:{marginLeft:"10px"},color:d}):null]})]})},J=e=>{let{trigger:t,content:n,onOpenChange:i,...r}=e;return(0,o.jsxs)(k.J2,{allowFlip:!0,onOpenChange:i,...r,children:[(0,o.jsx)(k.J2.Trigger,{children:t}),n?(0,o.jsx)(k.J2.Content,{width:"250px",padding:"$2",paddingRight:"$0",br:"$0",bw:"1px",display:"flex",shadowRadius:"$4",shadowColor:"black",boc:"gray",shadowOpacity:.6,bc:b("nodeBackgroundColor"),maxHeight:"350px",overflow:"scroll",overflowX:"hidden",children:n}):null]})},N=(0,i.forwardRef)((e,t)=>{let{icon:n,iconSize:r=20,selected:l=!1,dynamicIcon:s,...a}=e,[d,c]=(0,i.useState)(!1);return(0,o.jsx)("div",{ref:t,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...a,style:{cursor:"pointer",padding:"6px",borderRadius:"2px",backgroundColor:l?b("textColor"):"",...a.style},children:s?(0,o.jsx)(E.J,{name:s,color:l?b("nodeBackgroundColor"):d?b("interactiveColor"):b("textColor"),size:r}):(0,i.createElement)(n,{size:r,color:d?b("interactiveColor"):b("textColor")})})}),I=e=>{var t;let{render:n,onEnableEvents:r,metadata:l}=e,{id:a}=(0,s.Zo)(),{actions:y,query:C,isActive:E}=(0,s.jE)((e,t)=>({isActive:t.getEvent("selected").contains(a)})),{isHover:k,dom:w,name:I,moveable:P,deletable:O,connectors:{drag:T},parent:z,childs:D,nodeAndSiblings:A,nodeId:K,unknown:L,setProp:B,custom:R,props:F,node:M}=(0,s.Zo)(e=>{var t,n,o;return{custom:e.data.custom,unknown:null!==(o=e.data.custom.unknown)&&void 0!==o&&o,nodeId:e.id,isHover:e.events.hovered,dom:e.dom,node:e,name:e.data.custom.displayName||e.data.displayName,moveable:C.node(e.id).isDraggable(),deletable:C.node(e.id).isDeletable()&&C.node(e.id).isDraggable(),parent:e.data.parent,props:e.data.props,childs:e.data.nodes,nodeAndSiblings:(null===(t=e.data)||void 0===t?void 0:t.parent)?C.node(null===(n=e.data)||void 0===n?void 0:n.parent).childNodes():void 0}}),V=L?"#EF9364":"#2680EB",H="1px solid gray",_=(0,i.useRef)(),$=async()=>{let e=C.getNodes(),t=[],n={},o=(i,r)=>{let l=e[i];if(l){let e=(0,j.Z)();n[i]=e;let s={id:e,_duplicatedId:i,_duplicatedParent:l.data.parent,rules:{...l.rules},data:{...l.data,nodes:[],parent:r},events:l.events};return t.push(s),l.data&&l.data.nodes&&l.data.nodes.forEach(t=>{o(t,e)}),e}};for(let e of(o(a,z),y.setOptions(e=>e.awaitTopic=!0),t)){let t=e._duplicatedParent?C.node(e._duplicatedParent).childNodes():void 0;await y.add([e],e.data.parent,t.indexOf(e._duplicatedId)+1)}y.setOptions(e=>e.awaitTopic=!1)};(0,i.useEffect)(()=>{w&&(E?w.style.boxShadow="inset 0px 0px 0px 2px "+V:k?w.style.boxShadow="inset 0px 0px 0px 1px "+V:w.style.boxShadow="")},[w,E,k]);let U=(0,i.useCallback)(e=>{let t;let{top:n,left:o,bottom:i}=e?e.getBoundingClientRect():{top:0,left:0,bottom:0},r=o<5?5:o;var l=document.body,s=document.documentElement,a=Math.max(l.scrollHeight,l.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);return n>120?t=n-60:a-i>70&&i>60?t=i+10:a-i<120&&i>120?(t=i-55,r=5):t=-2e4,{top:t+"px",left:r+"px"}},[]),W=(0,i.useCallback)(()=>{let{current:e}=_;if(!e)return;let{top:t,left:n}=U(w);e.style.top=t,e.style.left=n},[w,U]);(0,i.useEffect)(()=>{var e,t;return null===(t=document)||void 0===t||null===(e=t.querySelector(".craftjs-renderer"))||void 0===e||e.addEventListener("scroll",W),()=>{var e,t;null===(t=document)||void 0===t||null===(e=t.querySelector(".craftjs-renderer"))||void 0===e||e.removeEventListener("scroll",W)}},[W]);let Z=e=>(0,o.jsx)("div",{style:{height:50,borderLeft:H}});return(0,o.jsxs)(o.Fragment,{children:[E?c.createPortal((0,o.jsxs)("div",{id:"my-renderedNode",ref:_,style:{left:U(w).left,top:U(w).top,zIndex:1e31,position:"fixed",backgroundColor:b("nodeBackgroundColor"),border:H,padding:"6px",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center",height:50,pointerEvents:"auto",gap:"6px"},children:[(0,o.jsxs)("div",{style:{fontSize:14,color:b("textColor"),padding:"10px 20px"},children:[I,L?" (Unknown)":""]}),(0,o.jsx)(Z,{}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"row",flex:1,gap:"6px",alignItems:"center"},children:[P?(0,o.jsx)(N,{ref:T,style:{cursor:"grab"},title:"Move",icon:f.A}):null,a!==d.QS&&"ROOT"!=z?(0,o.jsx)(N,{title:"Select parent",onMouseDown:e=>{y.selectNode(z),e.stopPropagation()},icon:x.a}):null,D.length?(0,o.jsx)(N,{title:"Select first child",icon:u.K,onMouseDown:e=>{y.selectNode(D[0]),e.stopPropagation()}}):null,(null==A?void 0:A.length)>1?(0,o.jsx)(N,{title:"Select next sibling",icon:h.J,onMouseDown:e=>{let t=(A.indexOf(K)+1)%A.length,n=A[t];y.selectNode(n),e.stopPropagation()}}):null,(0,o.jsx)(Z,{}),R.shortcuts?(0,o.jsxs)(v.sL,{ai:"center",gap:"6px",children:[R.shortcuts.map((e,t)=>{var n;let i=null!=e&&!!e.selected&&e.selected(F);return(0,o.jsx)(J,{onOpenChange:r,trigger:(0,o.jsx)(N,{onClick:e.action?()=>e.action({setProp:B,dom:w}):null,selected:i,dynamicIcon:e.icon(F)}),content:e.menu?null===(n=e.menu)||void 0===n?void 0:n.map(e=>(0,o.jsx)(S,{onClick:t=>{t.stopPropagation(),e.action({setProp:B,dom:w,metadata:l,props:F})},selected:null!=e&&!!e.selected&&e.selected(F),name:e.name})):null},t)}),(0,o.jsx)(Z,{})]}):null,(0,o.jsx)(J,{onOpenChange:r,trigger:(0,o.jsx)(N,{title:"Options",id:"render-node-options-btn",icon:g.h}),content:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(S,{onClick:e=>{e.stopPropagation(),$()},icon:m.C,name:"Duplicate"}),null===(t=R.options)||void 0===t?void 0:t.map(e=>(0,o.jsx)(S,{onClick:t=>{t.stopPropagation(),r(!1),e.action({setProp:B,dom:w,metadata:l,props:F})},name:e.name})),O?(0,o.jsx)(S,{id:"render-node-delete-btn",onClick:e=>{e.stopPropagation(),y.delete(a)},icon:p.V,name:"Delete"}):null]})})]})]}),document.querySelector(".page-container")):null,n]})};var P=n(17518),O=n(4265),T=n.n(O);let z=e=>{var t;let{connectors:{connect:n},setProp:i,id:r}=(0,s.Zo)(e=>({selected:e.events.selected,custom:e.data.custom})),{actions:l}=(0,s.jE)();return(0,o.jsx)("div",{ref:n,style:{minHeight:"30px",padding:"10px"},children:(0,o.jsx)(P.x,{color:"$gray8",children:null!==(t=e.codeBlock)&&void 0!==t?t:"Unknown"})})};z.craft={props:{},related:{settings:()=>(0,o.jsx)("div",{})}};let D=e=>(0,o.jsx)(o.Fragment,{children:e.children});D.craft={props:{},related:{settings:()=>(0,o.jsx)("div",{})}};let A=e=>{var t;let{connectors:{connect:n},setProp:i}=(0,s.Zo)(e=>({selected:e.events.selected,custom:e.data.custom}));return(0,o.jsx)("div",{ref:n,style:{minHeight:"30px"},children:null!==(t=e.children)&&void 0!==t?t:"Unknown"})};A.craft={props:{},related:{settings:()=>(0,o.jsx)("div",{})}};var K={craft:{Root:D,Unknown:A,ReactCode:z}},L=n(97729),B=n.n(L),R=n(45054),F=n(85067),M=n.n(F),V=n(20477);class H{static parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new H(new V.Project({useInMemoryFileSystem:!0,manipulationSettings:{indentationText:V.IndentationText.Tab},compilerOptions:{target:V.ScriptTarget.Latest,scriptKind:V.ScriptKind.TSX,languageVariant:V.LanguageVariant.JSX}}).createSourceFile("_temp2.tsx",e,{overwrite:!0}),t)}data(e,t){e&&this.identifyElements(e);let n=this.getContent(null==t?void 0:t.getMainContent),o=this.toCraftNodes(n);return this.addCustomProps(o)}getContent(e){if(e&&"function"==typeof e)try{let t=e({ast:this.ast,SyntaxKind:V.SyntaxKind});if(t)return t}catch(e){console.error("Error getting main content from source",e)}return this.getFirstDescendant("JsxElement")}getFirstDescendant(e){var t,n;let o=V.SyntaxKind[e];return e?null===(t=this.ast)||void 0===t?void 0:t.getFirstDescendantByKind(o):null===(n=this.ast)||void 0===n?void 0:n.getFirstDescendant()}getAllJsxElements(e){let t=this.getAllJsxChildren(e);return[e,...t]}getAttributes(e){let t=this.isKind(e,"JsxElement"),n=this.isKind(e,"JsxSelfClosingElement"),o=this.isKind(e,"JsxExpression");if(!e||!t&&!n&&!o)throw"Not valid node to get attributes";return t?this.getJsxElementAttributes(e):n?this.getJsxSelfClosingElementAttributes(e):o?[]:void 0}getJsxAttribute(e,t){if(!e||!this.isKind(e,"JsxElement")&&!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxElement or JsxSelfClosingElement, can't get the specified attribute";let n=this.getAttributes(e).find(e=>e.getNameNode().getText()==t);if(!n)throw"Can't get attribute ".concat(t);return n}getAttributeKey(e){if(!e||!this.isKind(e,"JsxAttribute"))throw"Can't get attribute key, the node provided isn't a JsxAttribute";return e.getNameNode().getText()}getAttributeValue(e){if(!e||!this.isKind(e,"JsxAttribute"))throw"Can't get attribute value, the node provided isn't a JsxAttribute";return e.getInitializer()}getJsxElementAttributes(e){if(!e||!this.isKind(e,"JsxElement"))throw"Error node provided is not a JsxElement, can't get its attributes";return e.getOpeningElement().getAttributes()}getJsxSelfClosingElementAttributes(e){if(!e||!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxSelfClosingElement, can't get its attributes";return e.getAttributes()}getJsxElementName(e){let t=this.isKind(e,"JsxElement"),n=this.isKind(e,"JsxSelfClosingElement"),o=this.isKind(e,"JsxExpression");if(!e||!t&&!n&&!o)throw"Not valid node to get Name";return t?this.getJsxElementIdentifier(e):n?this.getJsxSelfClosingElementIdentifier(e):o?{name:"ReactCode"}:void 0}getJsxElementIdentifier(e){if(!e||!this.isKind(e,"JsxElement"))throw"Error node provided is not a JsxElement, can't get its Identifier";let t=e.getOpeningElement().getTagNameNode(),n=t.getText();return{node:t,name:n}}getJsxSelfClosingElementIdentifier(e){if(!e||!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxSelfClosingElement, can't get its Identifier";let t=e.getTagNameNode(),n=t.getText();return{node:t,name:n}}getJsxChildren(e){if(this.isKind(e,"JsxSelfClosingElement"))throw"Can't obtain children from JsxSelfClosingElement";if(!e||!this.isKind(e,"JsxElement"))throw"Can't obtain node children";return e.getChildrenOfKind(V.SyntaxKind.SyntaxList)[0].getChildren()}getJsxTextOfJsxElement(e){if(this.isKind(e,"JsxExpression")||this.isKind(e,"JsxSelfClosingElement"))return;let t=this.getJsxChildren(e);if(t.length&&this.isKind(t[0],"JsxText"))return t[0]}getJsxChildrenFirstLevel(e){if(!(this.isKind(e,"JsxSelfClosingElement")||this.isKind(e,"JsxExpression")))return this.getJsxChildren(e).filter(e=>this.isKind(e,"JsxElement")||this.isKind(e,"JsxSelfClosingElement")||this.isKind(e,"JsxExpression"))}getAllJsxChildren(e){var t;let n;try{(n=this.getJsxChildrenFirstLevel(e)).forEach(e=>{n=[...n,...this.getAllJsxChildren(e)]})}catch(e){}return null!==(t=null==n?void 0:n.sort((e,t)=>e.getPos()-t.getPos()))&&void 0!==t?t:[]}isKind(e,t){return t==e.getKindName()}getNodeData(e){let t=this.getJsxElementName(e).name,n=this.getAttributes(e),o={},i={_nodeType:e.getKindName()};n.forEach(e=>{let t=this.getAttributeKey(e),n=this.getAttributeValue(e),{value:r,nodeKind:l,contextId:s}=this.nodeValueFactory(n);r&&t&&(o={...o,[t]:r}),l&&t&&(i={...i,[t]:l}),s&&t&&(i={...i,context:{...null==i?void 0:i.context,[t]:s}})});let r=this.getJsxTextOfJsxElement(e);if(r&&r.getText()){var l;o={...o,children:null===(l=r.getText())||void 0===l?void 0:l.trim()},i={...i,children:"StringLiteral"}}return"ReactCode"==t&&(o={...o,codeBlock:e.getText()}),{type:{resolvedName:t},isCanvas:!0,props:o,displayName:t,custom:i,hidden:!1,nodes:[],linkedNodes:{}}}flatten(e,t,n){var o;if(!e||!this.isKind(e,"JsxElement")&&!this.isKind(e,"JsxSelfClosingElement")&&!this.isKind(e,"JsxExpression"))return;let i=null!==(o=this.getIdentifier(e))&&void 0!==o?o:this.getIdFromSourceCode(e),r=this.getNodeData(e),l=[],s=this.getJsxChildrenFirstLevel(e);for(let e=0;e<(null==s?void 0:s.length);e++){let n=s[e];l.push(this.flatten(n,t,i))}let a={...r,nodes:l,parent:n};return t[i]=a,i}getNodes(e){if(!e||!this.isKind(e,"JsxElement"))throw"Can't getNodes from the give node that has no kind of type JsxElement";let t={};if(this.flatten(e,t,"ROOT"),!e||!this.isKind(e,"JsxElement"))throw"Can't getNodes from the give node that has no kind of type JsxElement";return t}toCraftNodes(e){var t;let n={type:{resolvedName:"Root"},isCanvas:!0,props:{"data-cy":"root-container"},displayName:"Root",custom:{},hidden:!1,nodes:[],linkedNodes:{}},o=this.getNodes(e),i=null===(t=Object.keys(o))||void 0===t?void 0:t.find(e=>"ROOT"==o[e].parent),r={};return i?(n={...n,nodes:[...n.nodes,i]},r={...o,ROOT:n}):r={ROOT:n},r}addCustomProps(e){let t=this.getImportDeclarations(),n={};return Object.keys(e).forEach(o=>{let i=e[o],r=this.getDisplayNameInNamedImports(i.displayName,t),l={...i,custom:{...i.custom,...r}};n={...n,[o]:l}}),n}getImportDeclarations(){let e=this.ast.getImportDeclarations(),t=[];return e.forEach(e=>{var n,o;let i=e.getNamedImports().length?e.getNamedImports():void 0,r=null==i?void 0:i.map(e=>{var t;return{name:e.getName(),alias:null===(t=e.getAliasNode())||void 0===t?void 0:t.getText()}}),l=null===(n=e.getDefaultImport())||void 0===n?void 0:n.getText(),s=null===(o=e.getModuleSpecifier())||void 0===o?void 0:o.getText();t=[...t,{namedImports:r,defaultImport:l,moduleSpecifier:s}]}),t}getDisplayNameInNamedImports(e,t){for(let n=0;n<(null==t?void 0:t.length);n++){let o=t[n],i=null==o?void 0:o.namedImports,r=null==o?void 0:o.defaultImport,l=null==o?void 0:o.moduleSpecifier;if(r===e)return{defaultImport:e,moduleSpecifier:l};if(i)for(let t=0;t<(null==i?void 0:i.length);t++){let n=i[t],o=null==n?void 0:n.name,r=null==n?void 0:n.alias;if(r===e||o===e)return{namedImportName:o,namedImportAlias:r,moduleSpecifier:l}}}return{}}identifyElements(e){let t=this.getAllJsxElements(this.getContent());for(let n=0;n<t.length;n++){let o,i="";t=this.getAllJsxElements(this.getContent());let r=this.getAttributes(t[n]);try{this.getJsxAttribute(t[n],"_nodeId")}catch(o){i+=' _nodeId="'.concat(e?e():this.getSameIdAsFlows(t[n]),'" ')}o=r.length?r[0].getStart():this.getJsxElementName(t[n]).node.getEnd(),this.ast.insertText(o,e=>e.write(i))}return this}getIdentifier(e){try{let t=this.getJsxAttribute(e,"_nodeId"),n=this.getAttributeValue(t);return this.nodeValueFactory(n).value}catch(e){console.error("Could not find node identifier")}}unidentifyElements(){let e=this.getAllJsxElements(this.getContent());for(let t=0;t<e.length;t++){e=this.getAllJsxElements(this.getContent());try{let n=this.getJsxAttribute(e[t],"_nodeId");this.ast.removeText(n.getStart(),n.getEnd())}catch(e){}}return this}getJsxElementByIdentifier(e,t){let n=this.getAllJsxElements(e).find(e=>this.getIdentifier(e)==t);if(!n)throw'Could not find element specified with uuid "'.concat(t,'" in the provided node');return n}convertJsxExpressionToJsxElement(){let e=()=>{let e=this.getContent();return this.getAllJsxElements(e).filter(e=>"JsxExpression"==e.getKindName())},t=n=>{n.length&&(this.ast.replaceText([n[0].getPos(),n[0].getEnd()],""),t(e()))};return t(e()),this}reactElementFactory(e,t){let n;let o=e.displayName;if("ReactCode"===o){let t=e.props.codeBlock;n="".concat(t)}else{let i,r="";if(Object.keys(e.props).filter(e=>!["_nodeId"].includes(e)).forEach(t=>{let n=e.props[t];if("StringLiteral"==e.custom[t]&&"children"!=t&&(n='"'.concat(n,'"')),"children"==t){i=n;return}void 0===n?r+=" ".concat(t):r+=" ".concat(t,"=").concat(n)}),"JsxSelfClosingElement"===e.custom._nodeType){let e=i?' children="'.concat(i,'"'):"";n="<"+"".concat(o)+r+e+"/>"}else n="<"+"".concat(o)+r+">"+"".concat(null!=i?i:"")+t+"</"+"".concat(o)+">"}return n}nodeValueFactory(e){let t;var n,o,i,r,l,s,a,d,c,u=null==e?void 0:e.getKindName();if("StringLiteral"===u)t=null==e?void 0:e.getLiteralValue();else{let p=null==e?void 0:e.getExpression(),h=null==p?void 0:p.getKindName();switch(h){case"StringLiteral":case"NumericLiteral":case"TrueKeyword":case"FalseKeyword":t=p.getLiteralValue(),u=h;break;case"ObjectLiteralExpression":t=p.getProperties().reduce((e,t)=>{var n,o,i=t.getName();try{n=null===(o=t.getInitializer())||void 0===o?void 0:o.getLiteralValue()}catch(e){n=t.getInitializer().getText()}return{...e,[i]:n}},{}),u=h;break;case"Identifier":if((null===(o=this.metadata)||void 0===o?void 0:o.context)&&(null===(i=this.metadata)||void 0===i?void 0:i.context[p.getText()])!=void 0){t=null===(r=this.metadata)||void 0===r?void 0:r.context[p.getText()],n=p.getText();break}case"PropertyAccessExpression":let x=p.getName?null==p?void 0:p.getName():null,f=p.getExpression?null==p?void 0:null===(l=p.getExpression())||void 0===l?void 0:l.getText():null;if(x&&f&&(null===(s=this.metadata)||void 0===s?void 0:s.context)&&(null===(a=this.metadata)||void 0===a?void 0:a.context[f])&&(null===(d=this.metadata)||void 0===d?void 0:d.context[f][x])!=void 0){t=null===(c=this.metadata)||void 0===c?void 0:c.context[f][x],n=p.getText();break}default:t=null==e?void 0:e.getText()}}return{value:t,nodeKind:u,contextId:n}}getIdFromSourceCode(e){try{return e.getKindName()+"_"+e._compilerNode.pos+"_"+e._compilerNode.end}catch(t){return e}}constructor(e,t){this.ast=e,this.metadata=t}}var _=n(64509),$=n(22522);class U extends i.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){if(this.state.hasError){var e;return(0,o.jsx)($.Kq,{style:{height:"100vh",justifyContent:"center",alignItems:"center"},children:(0,o.jsxs)(v.FA,{width:"80%",maxWidth:"600px",alignItems:"center",children:[(0,o.jsx)(P.x,{children:"Can not render Visual UI frame due the following error:"}),(0,o.jsx)(P.x,{color:"red",marginTop:"10px",children:null===(e=this.state.error)||void 0===e?void 0:e.message})]})})}return this.props.children}constructor(e){super(e),this.state={hasError:!1}}}var W=n(33922),Z=n(75136),q=n(34737);let X={mobile:{marginTop:50,width:"360px",height:"740px"},tablet:{marginTop:50,width:"820px",height:"1680px"},desktop:{width:"100%",height:"100%"}};var Q=n(91709),G=(0,_.Ic)(e=>{var t,n,r;let{frame:l="desktop",topics:a,currentPageContent:d,resolveComponentsDir:c,onReady:u=()=>{},metadata:p={},contextAtom:h=null,codeRef:x,settings:f}=e,g=(0,i.useRef)(),[m,v]=(0,i.useState)(!0),[y,C]=(0,i.useState)({}),[b,E]=(0,i.useState)({}),[j,k]=(0,i.useState)(),{publish:w,data:S}=a,{actions:J,query:N,connectors:I}=(0,s.jE)((e,t)=>{if(t.getOptions().awaitTopic)return;let o=JSON.parse(t.serialize()),i=M().diff(y,o);k(null===(a=e.events.selected)||void 0===a?void 0:a.keys().next().value);let r=(null==i?void 0:i.length)>0,l=M().diff(b,o);if(!t.getOptions().skipTopic&&(null==l?void 0:l.length)&&JSON.stringify(l)!=n){var s={};if(l.filter(e=>"N"==e.kind).length>0&&l.find(e=>"A"==e.kind)){let e=l.find(e=>"N"==e.kind),t="props"==e.path[1],n=e.path[0];if(t)s={action:"edit-node",nodeId:n,value:e.rhs,type:"prop",field:e.path[2]};else{let e=l.find(e=>"A"==e.kind),t=e.path[0];var a,d,c=l.find(e=>"N"==e.kind&&e.rhs.parent==t),u=null===(d=o[t].nodes)||void 0===d?void 0:d.findIndex(e=>e==c.path[0]);let n={id:t,childrenPos:u,nodeId:e.item.rhs,name:o[t].displayName},i=l.filter(e=>"N"==e.kind).map(e=>{var t,n=e.path[0];return{id:n,name:o[n].displayName,parent:e.rhs.parent,props:e.rhs.props,data:e.rhs.custom,childrens:null===(t=e.rhs)||void 0===t?void 0:t.nodes}});s={action:"add-nodes",parentData:n,newNodesData:i},(0,W.h4)(s,w),Object.keys(p.context).find(e=>i.find(t=>t.props[e]))&&setTimeout(()=>{O()},500)}}else if(l.find(e=>"D"==e.kind))s={action:"delete-node",deletedNodes:l.filter(e=>"D"==e.kind).map(e=>e.path[0]),parent:l.find(e=>"A"==e.kind).path[0]},(0,W.h4)(s,w);else if(l.find(e=>"E"==e.kind)){let e=l.find(e=>"E"==e.kind&&"parent"==e.path[1]),t=l.find(e=>"E"==e.kind&&"children"==e.path[2]),n=l.find(e=>"E"==e.kind&&"props"==e.path[1]),o=l.find(e=>"E"==e.kind&&"nodes"==e.path[1]);if(t||n){let e=t?"children":"prop";var h,x="children"==e?t:n;s={action:"edit-node",nodeId:x.path[0],value:(e=>{let t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""})(x.rhs),type:e,field:x.path[2],debounce:"children"==e}}else if(e){let t=e.path[0],n=e.rhs,o=e.lhs,i=b[o].nodes.findIndex(e=>e==t),r=l.find(e=>"E"==e.kind&&e.path[0]==n&&e.rhs==t);s={action:"move-node",isSameParent:!1,nodeId:t,oldParentId:o,newParentId:n,newPos:null!==(h=null==r?void 0:r.path[2])&&void 0!==h?h:-1,oldPos:i}}else{let e=o.path[0],t=l.sort((e,t)=>e.path[2]-t.path[2]).map(e=>e.rhs),n=b[e].nodes;s={action:"move-node",isSameParent:!0,parent:e,childrenIndexes:(0,W.dq)(n,t)}}(0,W.h4)(s,w)}n=JSON.stringify(l),E(o)}return{hasChanges:r,currentEditorNodes:o,enabled:e.options.enabled}}),P=async e=>{let t=H.parse(e,p).data(void 0,{getMainContent:null==f?void 0:f.getMainContent});C(t);let n=Object.keys(null!==(i=null==N?void 0:null===(o=N.getOptions())||void 0===o?void 0:o.resolver)&&void 0!==i?i:{});try{var o,i,r={};Object.keys(t).forEach(e=>{if(!n.includes(t[e].displayName)){let n={...t[e],custom:{...t[e].custom,unknown:!0},type:{...t[e].type,resolvedName:"Unknown"}};r[e]=n}}),J.deserialize({...t,...r})}catch(e){throw"Error loading editor nodes"}},O=()=>{let e=JSON.parse(N.serialize()),t=Object.keys(e).filter(t=>{var n,o;return(null===(n=e[t].custom)||void 0===n?void 0:n.context)&&Object.keys(null===(o=e[t].custom)||void 0===o?void 0:o.context).length>0});0!=t.length&&(J.setOptions(e=>e.skipTopic=!0),t.forEach(t=>{var n,o,i=null!==(o=null===(n=e[t].custom)||void 0===n?void 0:n.context)&&void 0!==o?o:{};Object.keys(i).forEach(e=>{J.setProp(t,t=>{let n=(0,W.eO)(p.context,i[e]);return t[e]=n})})}),E(JSON.parse(N.serialize())))};return(0,i.useEffect)(()=>{j&&w("zoomToNode",{id:j})},[j]),(0,q.fH)({actions:J,query:N},{resolveComponentsDir:c,appendNewNodeToTree:(e,t,n,o,i)=>(e[t]=n,e[o].nodes.splice(i,0,t),e)},E,S["flow/editor"],{atom:h,ui:p.context}),(0,i.useEffect)(()=>{J.setOptions(e=>e.skipTopic=!1)},[b]),(0,R.Z)(["z","Z","s","S","c","C","Delete","Backspace"],e=>{var t,n;if((null===(n=g.current)||void 0===n?void 0:null===(t=n.getBoundingClientRect())||void 0===t?void 0:t.height)>0){if(("z"==e.key||"Z"==e.key)&&(e.ctrlKey||e.metaKey)&&e.shiftKey){try{J.history.redo()}catch(e){console.error("can not redone action")}return}if(("z"==e.key||"Z"==e.key)&&(e.ctrlKey||e.metaKey)){try{J.history.undo()}catch(e){console.error("can not undone action")}return}}}),(0,i.useEffect)(()=>{let e=async t=>{try{await P(d)}catch(n){t<10?(setTimeout(()=>e(t+1),5e3),v(!0)):console.error("Max retry reached! Error deserializing editor nodes (CraftJS nodes). Error: ".concat(n)),console.error("Error deserializing editor nodes (CraftJS nodes). Error: ".concat(n))}};d&&(v(!1),e(0))},[d]),(0,Q.rf)(()=>{O()},[p.context]),(0,o.jsxs)("div",{style:{backgroundColor:"rgb(50, 50, 50)",overflow:"hidden",flex:1,display:"flex",flexDirection:"column"},children:[(0,o.jsxs)(B(),{children:[(0,o.jsx)("title",{children:"Platform UI"}),(0,o.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/public/logo.png"})]}),m?(0,o.jsx)($.Kq,{style:{height:"100vh",justifyContent:"center",alignItems:"center",zIndex:100,backgroundColor:"#f0f0f0"},children:(0,o.jsx)(Z.$,{size:"large"})}):null,(0,o.jsx)("div",{onLoad:()=>v(!1),className:"page-container",style:{width:"100%",height:"100%",justifyContent:"center",alignItems:"center",overflow:"auto",overflowX:"hidden"},children:(0,o.jsx)("div",{id:"editor",className:"craftjs-renderer",ref:e=>{g.current=e,I.select(I.hover(e,null),null)},style:{flex:1,position:"relative",overflow:"auto",display:"flex",height:null!==(r=null===(t=X[l])||void 0===t?void 0:t.height)&&void 0!==r?r:"100%"},children:(0,o.jsx)(U,{children:(0,o.jsx)("div",{id:"editor-frame-container",style:{display:"flex",flex:1},children:(0,o.jsx)(s.RQ,{})})})})})]})},{topics:["flow/editor"]}),Y=n(28965),ee=n(57441),et=n(86184);let en=e=>{let{componentName:t,connectors:n,data:r,element:l}=e,s=b("interactiveHoverColor"),a=b("nodeBackgroundColor"),d=b("textColor");return(0,o.jsxs)("div",{onMouseEnter:e=>{e.currentTarget.style.backgroundColor=s},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=a},title:t,id:"drag-element-"+t,className:"draggable-element",ref:e=>n.create(e,()=>r.dropable?l:i.createElement(r.element)),style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"grab",borderRadius:"6px",padding:"10px 0px",width:"100px",backgroundColor:a},children:[(0,o.jsx)(et.N1,{name:r.icon,color:d,size:32}),(0,o.jsx)("div",{style:{marginTop:"14px"},children:(0,o.jsx)("p",{style:{fontSize:"12px",width:"100%",color:d,padding:"5px"},children:t.length>12?t.substring(0,9)+"...":t})})]})};var eo=n(82796),ei=n(20800);let er=e=>{let{active:t,...n}=e,i=b("interactiveColor");return(0,o.jsx)(v.FA,{position:"absolute",borderBottomWidth:"$1.5",borderRadius:"$0",borderBottomColor:i,animation:"50ms",enterStyle:{opacity:0},exitStyle:{opacity:0},...n})},el=e=>{let{palettes:t,sendMessage:n}=e,[r,l]=(0,i.useState)(""),{connectors:a}=(0,s.jE)(),{resolvedTheme:d}=(0,y.P)(),c=b("interactiveColor"),[u,p]=(0,i.useState)({activeAt:null,currentTab:"atoms",intentAt:null,prevActiveAt:null}),h=e=>p({...u,intentAt:e}),x=e=>p({...u,prevActiveAt:u.activeAt,activeAt:e}),{activeAt:f,intentAt:g}=u,m=(e,t)=>{"select"===e?x(t):h(t)},v=b("nodeBackgroundColor"),C=b("textColor"),E=t.atoms,j=t.molecules,k=e=>Object.keys(e).reduce((t,n)=>{let o=e[n]?Object.keys(e[n]).filter(t=>{var o,i;return!(null===(i=e[n][t].craft)||void 0===i?void 0:null===(o=i.custom)||void 0===o?void 0:o.hidden)}).reduce((t,o)=>{var i,r,l,s,a;return{...t,[o]:{dropable:!0,element:e[n][o],icon:(r=e[n][o],a="Component",(null==r?void 0:null===(l=r.craft)||void 0===l?void 0:l.custom)&&(null==r?void 0:null===(s=r.craft)||void 0===s?void 0:s.custom.icon)&&(a=r.craft.custom.icon),a),custom:null===(i=e[n][o])||void 0===i?void 0:i.craft.custom}}},{}):{...t};return{...t,[n]:o}},{}),w=e=>r?Object.keys(e).reduce((t,n)=>{let o=e[n],i=Object.keys(o).filter(e=>e.toLocaleLowerCase().includes(r.toLocaleLowerCase())).reduce((e,t)=>({...e,[t]:o[t]}),{});var l={};return Object.keys(i).length&&(l={[n]:i}),{...t,...l}},{}):e,S=k(E),J=k(j),N=w(S),I=w(J),O=Object.keys(N).filter(e=>"craft"!=e);return(0,o.jsxs)("div",{className:"visualui-sidebar",style:{padding:"8px",display:"flex",flexDirection:"column",flex:1,backgroundColor:v},children:[(0,o.jsx)("p",{style:{padding:"18px 0px 0px 14px",fontSize:"18px",color:C,fontWeight:"400",display:"flex"},children:"Components"}),(0,o.jsxs)("div",{style:{display:"flex",margin:"18px 12px 18px 2px",position:"relative"},children:[(0,o.jsx)("input",{style:{fontFamily:"Jost-Regular",padding:"8px 8px 8px 36px",display:"flex",boxSizing:"border-box",fontSize:"14px",backgroundColor:"light"==d?"#E1E1E1":"#323232",borderRadius:"10px",borderWidth:"0px",outline:"none",color:C,flex:1},value:r,onChange:e=>l(e.target.value),placeholder:"Search..."}),(0,o.jsx)(Y.o,{color:"grey",size:20,style:{position:"absolute",top:"8px",left:"10px"}}),r?(0,o.jsx)(ee.X,{onClick:()=>l(""),color:"white",size:20,style:{position:"absolute",top:"8px",right:"10px",cursor:"pointer"}}):null]}),(0,o.jsxs)(eo.m,{defaultValue:"atoms",display:"flex",flexDirection:"column",overflow:"hidden",flex:1,children:[(0,o.jsx)(ei.M,{children:g&&(0,o.jsx)(er,{width:g.width,height:g.height,x:g.x,y:g.y})}),(0,o.jsx)(ei.M,{children:f&&(0,o.jsx)(er,{theme:"active",width:f.width,height:f.height,x:f.x,y:f.y})}),(0,o.jsxs)(eo.m.List,{disablePassBorderRadius:!0,backgroundColor:"transparent",loop:!1,gap:"$2",marginBottom:"$4",borderBottomColor:b("separatorColor"),borderBottomWidth:"$0.25",borderRadius:0,children:[(0,o.jsx)(eo.m.Tab,{unstyled:!0,value:"atoms",onInteraction:m,padding:"$3",children:(0,o.jsx)(P.x,{fontWeight:"300",color:C,style:{fontSize:"14px"},children:"Atoms"})}),(0,o.jsx)(eo.m.Tab,{unstyled:!0,value:"molecules",onInteraction:m,padding:"$3",children:(0,o.jsx)(P.x,{fontWeight:"300",color:C,style:{fontSize:"14px"},children:"Molecules"})})]}),(0,o.jsxs)("div",{className:"visualui-sidebar-list",style:{overflow:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",flex:1},children:[(0,o.jsx)(eo.m.Content,{value:"atoms",children:O.map((e,t)=>(0,o.jsxs)("div",{style:{flexDirection:"column",display:"flex",marginBottom:"25px"},children:[(0,o.jsx)("p",{style:{paddingLeft:"16px",marginBottom:"10px",fontSize:"12px",color:"gray"},children:e.toUpperCase()}),(0,o.jsx)("div",{className:"visualui-sidebar-list",style:{flex:1,display:"flex",justifyContent:"flex-start",flexWrap:"wrap",alignContent:"flex-start",gap:"8px"},children:Object.keys(N[e]).map((t,n)=>{let i=N[e][t];return(null==i?void 0:i.nonDeletable)?null:(0,o.jsx)(en,{element:(0,o.jsx)(s.W_,{is:i.element,canvas:!0}),componentName:t,connectors:a,data:i},n)})})]},t))}),(0,o.jsx)(eo.m.Content,{value:"molecules",children:Object.keys(I).map((e,n)=>(0,o.jsxs)("div",{style:{flexDirection:"column",display:"flex",marginBottom:"25px"},children:[(0,o.jsx)("p",{style:{paddingLeft:"16px",marginBottom:"10px",fontSize:"12px",color:"gray"},children:e.toUpperCase()}),(0,o.jsx)("div",{style:{flex:1,padding:"10px",display:"flex",justifyContent:"flex-start",flexWrap:"wrap",alignContent:"flex-start",gap:"16px"},children:Object.keys(I[e]).map((n,i)=>{var r,l;let s=I[e][n];return(0,o.jsx)("img",{ref:o=>a.create(o,()=>t.molecules[e][n](t.atoms)),src:null!==(l=null!==(r=s.custom[d])&&void 0!==r?r:s.custom.image)&&void 0!==l?l:"/images/molecules/no-molecule-image.png",title:n,width:300,onMouseEnter:e=>{e.currentTarget.style.boxShadow="0px 0px 0px 2px "+c},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0px 0px 8px 0px rgba(0,0,0,0.1)"},style:{objectFit:"contain",boxShadow:"0px 0px 8px 0px rgba(0,0,0,0.1)"}})})})]},n))})]})]})]})};var es=n(13296),ea=n(18827),ed=n.n(ea),ec=n(68346);let eu=e=>{let{borderLess:t,rightPanelSize:n=15,setRightPanelSize:i,rightPanelStyle:r={},rightPanelWidth:l=0,actionContent:s,rightPanelContent:a,leftPanelContent:d,centerPanelContent:c,rightPanelResizable:u=!1,rightPanelVisible:p=!0,openPanel:h,setOpenPanel:x=()=>{},height:f="100vh",onResizeDragging:g}=e;return(0,o.jsxs)("div",{style:{flex:1,display:"flex",maxWidth:"100%"},children:[d&&(0,o.jsx)("div",{id:"sidebar-panel-container",style:{flex:1,display:h?"flex":"none",position:"absolute",width:"".concat(25,"%"),zIndex:99999999},children:(0,o.jsx)(ed(),{type:"left",isOpen:!0,size:25,backdropClicked:()=>x(!1),children:d},"sidebar")}),s&&(0,o.jsx)("div",{id:"left-actions-container",style:{display:h?"none":"flex",position:"fixed",zIndex:1e20,flexDirection:"column",left:"20px",top:"calc(50vh - 80px)"},children:s}),(0,o.jsxs)(es.eh,{direction:"horizontal",style:{height:"100%",display:"flex"},autoSaveId:"vento-chat-layout",children:[(0,o.jsx)(es.s_,{defaultSize:100-n,children:(0,o.jsx)("div",{style:{display:"flex",flex:1,height:f},children:c})}),(0,o.jsx)(ec.Z,{direction:"vertical",borderLess:t,visible:p,resizable:u,onDragging:g}),(0,o.jsx)(es.s_,{defaultSize:n,maxSize:80,style:{position:p?"relative":"absolute",zIndex:p?1e5:-10,display:"flex",...r},children:(0,o.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:a})})]})]})};var ep=n(27911),eh=e=>{let{sourceCode:t,onChange:n}=e;return(0,o.jsx)(ep.ZP,{theme:"vs-dark",defaultLanguage:"javascript",value:t,onMount:n})},ex=n(68604),ef=n(78145),eg=n(15810),em=n(50042),ev=n(17876),ey=n(32878),eC=n(57909),eb=n(89560),eE=n(60892),ej=n(46475),ek=n(78520),ew=n(95154),eS=n(44015),eJ=n(47401),eN=n(44285),eI=n(67862),eP=n(17788),eO=n(60166),eT=n(33612);function ez(){let e=(0,eI._)(["\n  height: ",";\n  flex: ",";\n  color: #545454;\n"]);return ez=function(){return e},e}let eD=eP.default.div(ez(),e=>e.visible&&e.height&&"full"!==e.height?"".concat(e.height):"auto",e=>e.visible&&e.height&&"full"===e.height?"1":"unset"),eA=e=>{let{visible:t,icon:n,title:r,children:l,height:s,onChange:a}=e,d=b("separatorColor");return(0,o.jsxs)(eD,{visible:t,height:s,style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{onClick:()=>{a&&a(!t)},style:{cursor:"pointer",backgroundColor:b("secondaryBackground"),borderBottom:"1px solid "+d,alignItems:"center",padding:"10px",flexDirection:"row",display:"flex"},children:[(0,o.jsxs)("div",{style:{display:"flex",flex:1,alignItems:"center"},children:[i.createElement(n,{size:18,color:b("textColor")}),(0,o.jsx)("div",{style:{fontSize:18,marginLeft:"10px",color:b("textColor")},children:r})]}),t?(0,o.jsx)(eT.K,{size:18}):(0,o.jsx)(eO._,{size:18})]}),(0,o.jsx)(v.FA,{style:{display:t?"flex":"none",flex:1,flexDirection:"column",overflowY:"scroll"},children:l})]})},eK=e=>{let{icon:t,onPress:n,text:r,buttonProps:l={},id:s,item:a}=e,[d,c]=(0,i.useState)(!1);return(0,o.jsx)(v.sL,{id:s,onPress:n,children:(0,o.jsx)(J,{trigger:(0,o.jsx)(eJ.zx,{animation:"bouncy",chromeless:!0,paddingHorizontal:"$3",height:"40px",fontSize:"$5",borderRadius:"$2",icon:(0,i.createElement)(t,{fillOpacity:0}),hoverStyle:{backgroundColor:"transparent"},color:d&&!l.theme?b("interactiveColor"):b("textColor"),onMouseEnter:e=>c(!0),onMouseLeave:e=>c(!1),scaleIcon:1.5,textProps:{...l.textProps},...l,children:r}),onOpenChange:()=>null,content:a.menu?a.menu.map((e,t)=>(0,o.jsx)(S,{icon:e.icon,name:e.text,onClick:e.onPress},t)):null,...a.menuProps})})};var eL=e=>{let{height:t,leftItems:n,rightItems:i,...r}=e;return(0,o.jsxs)(v.sL,{jc:"space-between",ai:"center",backgroundColor:b("nodeBackgroundColor"),h:t,bbc:b("separatorColor"),bbw:"1px",paddingHorizontal:"$4",...r,children:[(0,o.jsx)(v.sL,{ai:"center",gap:"$4",children:n.map((e,t)=>(0,o.jsx)(eK,{item:e,id:e.id,onPress:e.onPress,icon:e.icon,text:e.text,buttonProps:e.buttonProps},t))}),(0,o.jsx)(v.sL,{ai:"center",gap:"$4",children:i.map((e,t)=>(0,o.jsx)(eK,{item:e,id:e.id,onPress:e.onPress,icon:e.icon,text:e.text,buttonProps:e.buttonProps},t))})]})},eB=n(34973),eR=n(21603),eF=n(85706),eM=n(3885),eV=n(25237);let eH=n.n(eV)()(()=>n.e(7308).then(n.bind(n,87308)).then(e=>e.VisualUiFlows),{loadableGenerated:{webpack:()=>[87308]}});var e_=(0,i.memo)((0,_.Ic)(function(e){var t;let n,{isActive:d=!0,sourceCode:c="",sendMessage:u,currentPage:p="",userPalettes:h={},resolveComponentsDir:x="",topics:f,metadata:g={},contextAtom:m=null,settings:E={}}=e,[j,k]=(0,q.ZB)(m),w=(0,i.useRef)(),S=(0,i.useRef)(null);(0,i.useContext)(eB.z);let J=(0,i.useRef)(""),N=(0,i.useRef)({}),P=(0,i.useRef)(),[O,T]=(0,i.useState)(!1),[z,D]=(0,i.useState)(""),[A,L]=(0,i.useState)("undefined"),[B,R]=(0,i.useState)(!1),[F,M]=(0,i.useState)(!0),[V,H]=(0,i.useState)(!1),[_,$]=(0,i.useState)("desktop"),U=O&&B,Z=Object.fromEntries((0,r.l)().entries()),X=(0,l.j)(),{resolvedTheme:Q,toggle:Y,current:ee}=(0,y.P)(),{publish:et}=f,[en,eo]=i.useState(!1),ei="preview"==A,er="50px",es="calc(100vh - "+er+")",ea=b("separatorColor");(0,i.useEffect)(()=>{let e=()=>eo(!1);return window.addEventListener("dragenter",e),()=>{window.removeEventListener("dragenter",e)}},[]);let ed={atoms:{...K,...null==h?void 0:h.atoms},molecules:{...null==h?void 0:h.molecules}},ec=ed.atoms,ep=(n=Object.keys(ec),t&&(n=n.filter(e=>"craft"!=e)),n.reduce((e,t)=>e={...e,...ec[t]},{})),eI=async()=>{D(c)},eP=async(e,t,n)=>{var o=e;if(t){let e=(0,W.b5)(o),n=e.getImportDeclarations(),i=(0,W.xo)(t.nodes,t.nodesData,x);if(i.length){let t=[...new Map(i.map(e=>[e.tagName,e])).values()].reduce((e,t)=>{var n,o,i,r,l;let s;let a=t.moduleSpecifier;return a?(null===(n=t.namedImports)||void 0===n?void 0:n.length)?s="import {"+((null===(o=t.namedImports[0])||void 0===o?void 0:o.alias)?(null===(i=t.namedImports[0])||void 0===i?void 0:i.name)+" as "+(null===(r=t.namedImports[0])||void 0===r?void 0:r.alias):null===(l=t.namedImports[0])||void 0===l?void 0:l.name)+'} from "'+a+'";\n':t.defaultImport&&(s="import "+t.defaultImport+' from "'+a+'";\n'):s="",e+s},"\n"),r=n&&n.length?n[n.length-1].getEnd():0;o=e.insertText(r,t).getText()}}u({type:"save",data:{content:o}}),J.current=o,n&&D(o)},eO=e=>{"code"==e?(O?R(!B):R(!0),L(void 0),T(!O)):"flow"==e?(A==e?R(!B):R(!0),L(e),T(!1)):"preview"==e&&(["flow-preview","preview"].includes(A)?(R(!B),L("undefined")):(R(!0),L(e)),T(!1))},eT=async()=>{await u({type:"dismiss"})||(document.location.href=document.location.href.split("?")[0])};(0,i.useEffect)(()=>{eI()},[c]);let ez=(0,o.jsx)("div",{style:{display:"flex",width:"100%",top:B?0:-1e12,position:B?"relative":"absolute",height:"100%"},children:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:es},children:[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",zIndex:999999,backgroundColor:b("nodeBackgroundColor"),borderBottom:"1px solid "+ea},children:[(0,o.jsx)(v.sL,{padding:"10px",display:O?"flex":"none",theme:"dark",marginVertical:"$1",children:(0,o.jsx)(eJ.zx,{chromeless:!0,backgroundColor:b("interactiveColor"),hoverStyle:{backgroundColor:b("interactiveHoverColor")},size:"$3",onPress:()=>{var e;return eP(null===(e=S.current)||void 0===e?void 0:e.getValue(),N.current,!0)},children:(0,o.jsx)(eE.v,{color:b("textColor"),fillOpacity:0})})}),(0,o.jsx)(v.sL,{padding:"10px",display:["flow-preview","preview"].includes(A)?"flex":"none",children:(0,o.jsxs)(eN.t,{borderWidth:"$0",theme:"dark"==Q?"dark":"light",type:"single",defaultValue:"preview",disableDeactivation:!0,children:[(0,o.jsx)(eN.t.Item,{hoverStyle:{backgroundColor:"flow-preview"==A?b("interactiveHoverColorDarken"):b("interactiveHoverColor")},focusStyle:{backgroundColor:"flow-preview"==A?b("interactiveColor"):b("inputBackgroundColor")},backgroundColor:"flow-preview"==A?b("interactiveColor"):b("inputBackgroundColor"),value:"flow-preview",onPress:()=>L("flow-preview"),children:(0,o.jsx)(em.h,{fillOpacity:0,color:"flow-preview"==A&&"dark"!=Q?b("nodeBackgroundColor"):b("textColor")})}),(0,o.jsx)(eN.t.Item,{hoverStyle:{backgroundColor:"preview"==A?b("interactiveHoverColorDarken"):b("interactiveHoverColor")},focusStyle:{backgroundColor:"preview"==A?b("interactiveColor"):b("inputBackgroundColor")},backgroundColor:"preview"==A?b("interactiveColor"):b("inputBackgroundColor"),value:"preview",onPress:()=>L("preview"),children:(0,o.jsx)(ev.j,{fillOpacity:0,color:"preview"==A&&"dark"!=Q?b("nodeBackgroundColor"):b("textColor")})})]})})]}),(0,o.jsx)("div",{style:{display:O?"flex":"none",flex:1},children:(0,o.jsx)(eh,{onChange:e=>{S.current=e},sourceCode:J.current})}),(0,o.jsxs)("div",{style:{opacity:1,marginRight:0,flex:1,display:O?"none":"flex",flexDirection:"column",backgroundColor:b("nodeBackgroundColor")},children:[(0,o.jsx)(eA,{icon:eb.z,title:"Customize",height:V?"55%":"full",visible:F,onChange:e=>M(e),children:(0,o.jsx)(eH,{disableDots:!d||ei,sourceCode:z,setSourceCode:D,customComponents:(0,eM.B)(X,Z),customSnippets:(0,eR.j)(X,Z),onSave:(e,t,n)=>eP(e,n),config:{masks:(0,eM.W)(X,Z),menu:(0,eF.N)(X,Z)},zoomOnDoubleClick:!ei,themeMode:Q,bgColor:"transparent",onEdit:(e,t)=>{J.current=e,N.current=t},theme:C[Q],nodePreview:A,metadata:g,contextAtom:m,defaultSelected:e=>Object.keys(null!=e?e:{}).find(t=>t.startsWith("JsxElement")&&"Page"==e[t].name)})}),(0,o.jsx)(eA,{icon:eC.S,title:"Layers",visible:V,onChange:e=>H(e),height:F?"55%":"full",children:(0,o.jsx)(a.S9,{})})]})]})},"auxiliarySidebar"),eD=(0,o.jsx)("div",{style:{display:"flex",flex:1,height:"100%"},children:(0,o.jsx)(el,{palettes:ed,sendMessage:u})},"sidebar"),eK=(0,o.jsx)("div",{id:"editor-layout",style:{flex:1,display:"flex",minWidth:"280px",borderRight:"2px solid "+ea},children:(0,o.jsx)(G,{metadata:g,frame:_,currentPageContent:z,codeRef:J,onSave:()=>null,resolveComponentsDir:x,contextAtom:m,settings:E.editor})});function eV(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=window.innerHeight;w.current&&(w.current.style.height=e+"px")}(0,i.useEffect)(()=>(eV(),window.addEventListener("resize",eV),()=>window.removeEventListener("resize",eV)),[]),(0,i.useEffect)(()=>{var e;let t=e=>{P.current||(e.preventDefault(),e.stopPropagation())};return null===(e=document.getElementById("editor-layout"))||void 0===e||e.addEventListener("click",t),()=>{var e;return null===(e=document.getElementById("editor-layout"))||void 0===e?void 0:e.removeEventListener("click",t)}},[]);let e_={resolver:ep,onRender:e=>{let{...t}=e;return I({...t,onEnableEvents:e=>{P.current=e},metadata:g})}},e$=(0,q.iz)(e_);return k&&k(e$),(0,o.jsx)("div",{ref:w,style:{display:"flex",flex:1,width:"100%",flexDirection:"column"},children:(0,o.jsxs)(s.ML,{...e_,enabled:!U,parentContext:e$,children:[(0,o.jsx)(eL,{height:er,leftItems:[{id:"components-to-drag-btn",icon:ex.v,buttonProps:{chromeless:!1,color:"white",backgroundColor:b("interactiveColor"),hoverStyle:{backgroundColor:b("interactiveHoverColorDarken")}},onPress:()=>eo(!0)},{icon:"light"==ee?ew.k:"dark"==ee?eS.J:ek.D,onPress:Y},{icon:ef.d,text:"Exit",onPress:eT,buttonProps:{variant:"outlined",chromeless:!1,borderWidth:"$0.5",borderColor:b("textColor"),hoverStyle:{variant:"outlined",chromeless:!1,borderWidth:"$0.5",borderColor:b("interactiveColor")}}}],rightItems:[{icon:ey.E,onPress:()=>eO("code")},{icon:eg.Z,onPress:()=>eO("flow")},{id:"save-nodes-btn",icon:eE.v,text:"Save",buttonProps:{disabled:U,opacity:U?.2:1,chromeless:!1,color:"white",backgroundColor:b("interactiveColor"),paddingHorizontal:"$4",hoverStyle:{backgroundColor:b("interactiveHoverColorDarken")}},onPress:()=>eP(J.current,N.current)},{icon:ej.X,onPress:()=>eO("preview")}]}),(0,o.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row"},children:(0,o.jsx)(eu,{openPanel:en,setOpenPanel:eo,leftPanelContent:eD,centerPanelContent:eK,borderLess:!0,height:es,rightPanelContent:ez,rightPanelResizable:!ei,rightPanelWidth:ei?0:50,rightPanelVisible:B})})]})})}));let e$=e=>{let{children:t,editable:n=!1,onChange:i=e=>{},...r}=e;return(0,o.jsx)(o.Fragment,{children:n?(0,o.jsx)(T(),{style:{border:"2px dashed var(--blue8)"},html:t,onChange:i,...r}):t})};var eU=e=>{let{userPalettes:t={},_sourceCode:n="",_resolveComponentsDir:r="@/uikit",_currentPage:l="",onSave:s=()=>null,onDismiss:a,metadata:d={},contextAtom:c,settings:u={}}=e,[p,h]=(0,i.useState)(l),x=async e=>{let t=e.type,n=e.data;switch(t){case"loadPage":h(n.pageName);break;case"save":let o=n.content;s((0,W.RZ)(o));break;case"dismiss":if(a)return a(),!0}};return(0,o.jsx)(_.US,{children:n?(0,o.jsx)(e_,{sourceCode:n,currentPage:p,userPalettes:t,sendMessage:x,resolveComponentsDir:"".concat(r,"/"),metadata:d,contextAtom:c,settings:u}):null})}},33922:function(e,t,n){let o,i,r;n.d(t,{RZ:function(){return m},b5:function(){return f},dq:function(){return x},eO:function(){return v},h4:function(){return h},xo:function(){return g}});var l=n(20477),s=n(28261),a=n.n(s),d=n(29691),c=n.n(d),u=n(34737);let p="flows-ui",h=(e,t,n)=>{e.debounce&&!(0,u.NT)()?(r=setTimeout(()=>{t(p+"/ui",e)},1e3),o&&e.nodeId==o.nodeId&&clearTimeout(i),o=e,i=r):t(p+"/ui",e),n&&n()};function x(e,t){let n=[],o={};for(let t=0;t<e.length;t++)o[e[t]]=t;for(let e=0;e<t.length;e++){let i=t[e];n.push(o[i])}return n}let f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"customCode.tsx";return new l.Project({useInMemoryFileSystem:!0,manipulationSettings:{indentationText:l.IndentationText.Tab},compilerOptions:{target:l.ScriptTarget.Latest,scriptKind:l.ScriptKind.TSX,languageVariant:l.LanguageVariant.JSX}}).createSourceFile(t,e,{overwrite:!0})},g=(e,t,n)=>{var o,i;let r=null===(o=e.filter(e=>"ImportDeclaration"==e.type))||void 0===o?void 0:o.map(e=>e.id),l=null===(i=e.filter(e=>["JsxElement","JsxSelfClosingElement"].includes(e.type)))||void 0===i?void 0:i.map(e=>e.id),s=[];r.forEach(e=>{let n=t[e],o=n.module;Object.keys(n).forEach(e=>{let t;"default"==e&&n[e]?(t={defaultImport:n.default,moduleSpecifier:o},s.push(t)):e.startsWith("import-")&&n[e]&&(t={namedImports:[{name:n[e],alias:void 0}],moduleSpecifier:o},s.push(t))})});let a=[];function d(e){for(let t of s){if(t.defaultImport===e)return!0;if(t.namedImports){for(let n of t.namedImports)if(n.name===e)return!0}}return!1}return e.forEach(e=>{l.includes(e.id)&&a.push({...e.data,tagName:t[e.id].name})}),function(){let e=[];for(let t of a){let{tagName:n,namedImports:o,defaultImport:i}=t;d(n)||o||i||e.push({defaultImport:n}),!d(n)&&(o||i)&&e.push(t)}return e}()};function m(e){let t;try{t=c().format(e,{bracketSameLine:!0,jsxBracketSameLine:!0,singleAttributePerLine:!1,printWidth:1e3,quoteProps:"consistent",jsxSingleQuote:!1,parser:"typescript",plugins:[a()]})}catch(e){console.error("Could not format text. Error: "+e)}return null!=t?t:e}let v=(e,t)=>{var n;return(null==t?void 0:t.split)?null===(n=t.split("."))||void 0===n?void 0:n.reduce((e,t)=>e?e[t]:void 0,e):t}},34737:function(e,t,n){n.d(t,{NT:function(){return p},ZB:function(){return c},fH:function(){return h},iz:function(){return d},jt:function(){return u}});var o=n(2784),i=n(752),r=n(8293),l=n(85067),s=n.n(l),a=n(33922);function d(e){return(0,r._i)(e)}function c(e){let t=null!=e?e:null;return t?(0,i.KO)(t):[null,null]}function u(e,t,n){if(e){let[r]=(0,i.KO)(e),[l,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(null),[p,h]=(0,o.useState)(null!=n?n:null);return(0,o.useEffect)(()=>{r&&r.subscribe&&r.subscribe(e=>{h(e=>{let n=t&&t(e,r);return null!=n?n:e})},()=>{})},[r]),(0,o.useEffect)(()=>{if(r.history.timeline.length<1)return;if(null===c&&null===l){d(r.query.serialize());return}let e=JSON.parse(r.query.serialize()),t=s().diff(JSON.parse(l),e);if(!(t.length<1)){if(t.find(e=>"N"==e.kind))console.log("[useVisualUi] Event: new"),u({action:"add-node"});else if(t.find(e=>"D"==e.kind))console.log("[useVisualUi] Event: delete"),u({action:"delete-node",deletedNodes:t.filter(e=>"D"==e.kind).map(e=>e.path[0]),parent:t.find(e=>"A"==e.kind).path[0]});else if(t.find(e=>"E"==e.kind)){let e=t.find(e=>"E"==e.kind&&"parent"==e.path[1]),i=t.find(e=>"E"==e.kind&&"children"==e.path[2]),r=t.find(e=>"E"==e.kind&&"props"==e.path[1]),s=t.find(e=>"E"==e.kind&&"nodes"==e.path[1]);if(i||r){console.log("[useVisualUi] Event: edit");let e=i?"children":"prop";var n,o="children"==e?i:r;u({action:"edit-node",nodeId:o.path[0],value:o.rhs,type:e,field:o.path[2]})}else if(e){console.log("[useVisualUi] Event: move (diff parent)");let o=e.path[0],i=e.rhs,r=e.lhs,s=JSON.parse(l)[r].nodes.findIndex(e=>e==o),a=t.find(e=>"E"==e.kind&&e.path[0]==i&&e.rhs==o);u({action:"move-node",isSameParent:!1,nodeId:o,oldParentId:r,newParentId:i,newPos:null!==(n=null==a?void 0:a.path[2])&&void 0!==n?n:-1,oldPos:s})}else{console.log("[useVisualUi] Event: move (same parent)");let e=s.path[0],n=t.sort((e,t)=>e.path[2]-t.path[2]).map(e=>e.rhs),o=JSON.parse(l)[e].nodes;u({action:"move-node",isSameParent:!0,parent:e,childrenIndexes:(0,a.dq)(o,n)})}}}},[r.query.serialize()]),{actions:r.actions,query:r.query,state:p,lastEvent:c}}throw Error("useVisualUi(...) must have a defined atom")}function p(){return"true"===new URLSearchParams(window.location.search).get("experimental_comms")}function h(e,t,n,i,r){let{actions:l,query:s}=e,{resolveComponentsDir:d,appendNewNodeToTree:c}=t;if(p()){let{lastEvent:e}=u(r.atom);(0,o.useEffect)(()=>{console.log("craftEvent: ",e)},[e])}else(0,o.useEffect)(()=>{let e=i.action,t=i.nodeId,o=i.value,u=i.param;switch(e){case"delete-node":var p;if(!["JsxElement","JsxSelfClosingElement"].includes(i.deletedNodeType))return;l.setOptions(e=>e.skipTopic=!0),null===(p=i.nodesToDelete)||void 0===p||p.forEach(e=>l.delete(e)),n(JSON.parse(s.serialize()));break;case"delete-data":if(!u)return;try{l.setOptions(e=>e.skipTopic=!0),l.setProp(t,e=>(delete e[u],e)),n(JSON.parse(s.serialize()))}catch(e){console.error("error deleting data. ",e)}break;case"edit-data":if(!u)return;try{let e=i.kind,d=i.param;l.setOptions(e=>e.skipTopic=!0),["PropertyAccessExpression","Identifier"].includes(e)?l.setProp(t,e=>{let t=(0,a.eO)(r.ui,o);return e[d]=t}):l.setProp(t,e=>e[u]=o),l.setCustom(t,e=>e[u]="JsxText");let c=null==i?void 0:i.deleteKey;c&&l.setProp(t,e=>(delete e[c],e)),n(JSON.parse(s.serialize()))}catch(e){console.error("error editing data. ",e)}break;case"add-data":let h=JSON.parse(s.serialize());if(!h[t])return;try{h[t]={...h[t],props:{...h[t].props,[u]:o}},l.setOptions(e=>e.skipTopic=!0),l.setProp(t,e=>e[u]=o),n(h)}catch(e){console.error("error adding data. ",e)}break;case"add-node":let x=i.type,f=i.childrenPos,g=i.nodeName,m=i.parent;if("JsxElement"==x){let e={displayName:g,props:{},custom:{defaultImport:g,moduleSpecifier:'"'.concat(d).concat(g,'"'),_nodeType:"JsxElement"},hidden:!1,isCanvas:!0,parent:m,type:{resolvedName:g},nodes:[]},o=JSON.parse(s.serialize());if(!m||!o)return;try{let i=c(o,t,e,m,f);l.setOptions(e=>e.skipTopic=!0),l.deserialize(i),n(JSON.parse(s.serialize()))}catch(e){console.error("error adding node (JsxElement). ",e)}}else try{let e=i.data;if(!(null==e?void 0:e.isAncestorJsxElement))return;l.setOptions(e=>e.skipTopic=!0),l.setProp(m,t=>t[e.key]=e.value),n(JSON.parse(s.serialize()))}catch(e){console.error("error adding node (Not a JsxElement). ",e)}}},[i])}}}]);