"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8819],{78819:function(e,i,t){t.d(i,{Z:function(){return eb}});var o=t(52322),n=t(41585),a=t(57909),r=t(32627),l=t(25184);let d=l.Schema.object({name:l.z.string().hint("ESP32, AT-MEGA2560  ARMv7, Protofy, ...").static().id(),sdks:l.z.array(l.z.string()).hint("esphome, platformio, wled, javascript, ...").hidden(),config:l.z.record(l.z.string(),l.z.any()).optional().onCreate("getConfig").onUpdate("getConfig")}),s=l.AutoModel.createDerived("DeviceCoreModel",d);var c=t(78822),u=t(3828),m=t(22958),v=t(7211),p=t(33943),g=t(6364);let f=l.Schema.object({id:l.z.string().generate((0,g.Z)()).id(),name:l.z.string().hint("MicroPython, Platformio...").static(),config:l.z.record(l.z.string().optional(),l.z.any()).generate({})}),h=l.AutoModel.createDerived("DeviceSdkModel",f);var b=t(2784);let x={name:r.V,sdk:a.S};var y=t(66132);let j=l.Schema.object({name:l.z.string().hint("ESP32S3, CHUWI, Arduino UNO...").static().id().search(),core:l.z.string().hidden().search(),icon:l.z.string().optional(),image:l.z.string().optional(),ports:l.z.array(l.z.record(l.z.string(),l.z.any())),config:l.z.record(l.z.string(),l.z.any())});class w extends l.ProtoModel{static getApiOptions(){return{name:"deviceboards",prefix:"/api/core/v1/"}}create(e){return super.create(e)}read(e){return super.read(e)}update(e,i){return super.update(e,i)}list(e,i,t,o){return super.list(e,i,t,o)}delete(e){return super.delete(e)}getJsArray(){return JSON.stringify([null,null,...this.data.ports.map(e=>{if("IO"===e.type||"I"===e.type)return null})])}static _newInstance(e,i){return new w(e,i)}static load(e,i){return this._newInstance(e,i)}constructor(e,i){super(e,j,i,"DeviceBoardModel")}}let D={name:r.V,core:a.S};var z=t(831),C=t(39006);let S=l.Schema.object({name:l.z.string().hint("Protofy screen controller...").regex(/^[a-z0-9_]+$/,"Only lower case chars, numbers or _").static().id(),description:l.z.string().optional().label("Description").hint("Short summary of what this template is for"),board:w.linkTo(e=>e.name).hint("Select your board").static(),sdk:l.z.string().hidden(),subsystems:l.z.record(l.z.string(),l.z.any()).optional().hidden(),environment:l.z.string().optional().help("The environment where the definition was created").hidden().groupIndex("env"),config:l.z.record(l.z.string(),l.z.any()).optional().onCreate("getConfig").onUpdate("getConfig").hidden()}),A=l.AutoModel.createDerived("DeviceDefinitionModel",S);var I=t(14503),E=t(37288),P=t(78994),$=t(17518),k=t(36265),N=t(69517),T=t(93228),L=t(5632),U=t(70142),F=t(59328),O=t(26602),M=t(47401);let R=e=>{let{templateDialog:i,setTemplateDialog:t,resetTemplateDialog:n,submitTemplateDialog:a,boardOptions:r,actionLabel:l="Create template",boardFieldMode:d="select",lockedBoardName:s,title:c="Create template"}=e;return(0,o.jsx)(T.a,{open:i.open,setOpen:e=>{e||n()},title:c,description:"",hideAccept:!0,onOpenChange:e=>{e||n()},children:(0,o.jsxs)(E.FA,{gap:"$3",p:"$3",w:400,maxWidth:"100%",children:[(0,o.jsxs)(E.FA,{gap:"$1",children:[(0,o.jsx)($.x,{fontSize:"$3",fontWeight:"600",color:"$gray11",children:"Template name"}),(0,o.jsx)(O.II,{placeholder:"Template name",value:i.templateName,onChangeText:e=>t(i=>({...i,templateName:e,warning:void 0,overwriteConfirmed:!1})),disabled:i.submitting})]}),(0,o.jsxs)(E.FA,{gap:"$1",children:[(0,o.jsx)($.x,{fontSize:"$3",fontWeight:"600",color:"$gray11",children:"Description"}),(0,o.jsx)(O.II,{placeholder:"What is this template for?",value:i.description,onChangeText:e=>t(i=>({...i,description:e})),disabled:i.submitting})]}),"hidden"!==d&&(0,o.jsxs)(E.FA,{gap:"$1",children:[(0,o.jsx)($.x,{fontSize:"$3",fontWeight:"600",color:"$gray11",children:"Board"}),"select"===d?(0,o.jsx)(F.E,{f:1,elements:r,value:i.boardName,setValue:e=>t(i=>({...i,boardName:e})),placeholder:"Select a board"}):(0,o.jsx)(O.II,{value:null!=s?s:i.boardName,disabled:!0})]}),i.warning?(0,o.jsx)($.x,{color:"$yellow10",fontSize:"$3",children:i.warning}):null,i.error?(0,o.jsx)($.x,{color:"$red9",fontSize:"$3",children:i.error}):null,i.submitting&&(0,o.jsx)($.x,{color:"$gray10",fontSize:"$3",children:"Loading..."}),(0,o.jsxs)(E.sL,{justifyContent:"center",gap:"$4",mt:"$4",children:[(0,o.jsx)(U.I,{children:(0,o.jsx)(M.zx,{disabled:i.submitting,onPress:n,children:"Cancel"})}),(0,o.jsx)(U.I,{children:(0,o.jsx)(M.zx,{disabled:i.submitting,onPress:a,children:l})})]})]})})};var V=t(71727),W=t(19940);let Z={name:r.V,board:y.b},_=()=>({open:!1,device:null,yaml:"",templateName:"",description:"",boardName:"",subsystems:[],error:void 0,warning:void 0,submitting:!1,overwriteConfirmed:!1});var B=t(40198),Y=t(70621),G=t(65503),J=t(7173),q=t(38017),H=t(43667),Q=t(3443),K=t(14855),X=t(7655),ee=t(80609),ei=t(89560),et=t(7244),eo=t(66797),en=t(74254),ea=t(42934),er=t(83302),el=t(56337),ed=t(5414);let es=e=>e.trim().toLowerCase().replace(/[^a-z0-9_]/g,"_"),ec=e=>Array.isArray(e)?e:e&&"object"==typeof e?Object.values(e):[],eu=e=>(e||[]).reduce((e,i)=>{let t="string"==typeof(null==i?void 0:i.name)&&i.name||"subsystem_".concat(Object.keys(e).length);return e[t]=i,e},{}),em=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{deviceDefinitions:i,refreshDefinitions:t}=e,[o,n]=(0,b.useState)({open:!1,device:null,yaml:"",templateName:"",description:"",boardName:"",subsystems:[],error:void 0,warning:void 0,submitting:!1,overwriteConfirmed:!1}),[a,r]=(0,b.useState)([]),d=async()=>{try{var e,i;let t=await l.API.get("/api/core/v1/deviceboards?all=1"),o=null!==(i=null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.items)&&void 0!==i?i:[];return r(o.map(e=>null==e?void 0:e.name).filter(Boolean)),o}catch(e){return console.error("Error fetching boards list:",e),[]}},s=async(e,t)=>{var o,n,a,d,s;let c,u;if(e.data.deviceDefinition){let t=(null==i?void 0:i.isLoaded)?i.data.items.find(i=>i.name===e.data.deviceDefinition):null,n=null==t?void 0:t.board;if(n&&(c="string"==typeof n?n:null==n?void 0:n.name),!c){let i=await l.API.get("/api/core/v1/devicedefinitions/".concat(e.data.deviceDefinition));!(null==i?void 0:i.isError)&&(null==i?void 0:null===(o=i.data)||void 0===o?void 0:o.board)&&(c="string"==typeof i.data.board?i.data.board:i.data.board.name)}}if(!c)try{let e=(0,ed.Qc)(t||""),i=(null==e?void 0:null===(n=e.esp32)||void 0===n?void 0:n.board)||(null==e?void 0:null===(a=e.esp8266)||void 0===a?void 0:a.board);"string"==typeof i&&(u=i)}catch(e){console.error("Error parsing YAML while resolving board:",e)}if(!c&&u)try{let e=await l.API.get("/api/core/v1/deviceboards?all=1"),i=null!==(s=null==e?void 0:null===(d=e.data)||void 0===d?void 0:d.items)&&void 0!==s?s:[];r(i.map(e=>null==e?void 0:e.name).filter(Boolean));let t=i.find(e=>{var i,t,o,n,a;let r=null!==(a=null==e?void 0:null===(i=e.config)||void 0===i?void 0:i["esphome-yaml"])&&void 0!==a?a:null==e?void 0:null===(t=e.config)||void 0===t?void 0:t.esphomeYaml;return((null==r?void 0:null===(o=r.esp32)||void 0===o?void 0:o.board)||(null==r?void 0:null===(n=r.esp8266)||void 0===n?void 0:n.board))===u});(null==t?void 0:t.name)&&(c=t.name)}catch(e){console.error("Error looking up device boards while resolving board:",e)}return!c&&u&&(c=u),c},c=async e=>{let i=e.getConfigFile();if(!i)return;let t=es("".concat(e.data.name,"_template"));n({open:!0,device:e,yaml:"",templateName:t,description:"",boardName:"",subsystems:[],error:void 0,warning:void 0,submitting:!0,overwriteConfirmed:!1});try{var o,a,r;await d();let t=ec(null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.subsystem);if(!t.length)try{let i=await l.API.get("/api/core/v1/devices/".concat(encodeURIComponent(e.data.name)));(null==i?void 0:i.isError)||(t=ec(null==i?void 0:null===(a=i.data)||void 0===a?void 0:a.subsystem))}catch(e){console.error("Error fetching device to resolve subsystems:",e)}let c=await l.API.get("/api/core/v1/files/"+i);if(null==c?void 0:c.isError){n(e=>({...e,error:"Could not read device YAML file.",submitting:!1}));return}let u=null!==(r=null==c?void 0:c.data)&&void 0!==r?r:"",m=await s(e,u);n(e=>({...e,yaml:u,boardName:null!=m?m:"",subsystems:t,description:"",error:void 0,warning:void 0,submitting:!1,overwriteConfirmed:!1}))}catch(e){console.error("Error preparing template dialog:",e),n(e=>({...e,error:"Unexpected error while reading the device config.",submitting:!1}))}},u=async()=>{let{device:e,yaml:i,templateName:a,description:r,boardName:d,subsystems:s,overwriteConfirmed:c}=o;if(!e||!i){n(e=>({...e,error:"Missing device data or YAML content."}));return}let u=es(a);if(!u){n(e=>({...e,error:"Template name must contain letters, numbers or underscores."}));return}if(!d){n(e=>({...e,error:"Board name is required to create the template."}));return}n(e=>({...e,submitting:!0,error:void 0}));try{let e=r.trim(),o=await l.API.get("/api/core/v1/deviceboards/".concat(encodeURIComponent(d)));if((null==o?void 0:o.isError)||!(null==o?void 0:o.data)){n(e=>({...e,error:"Could not load board data for the selected board.",submitting:!1}));return}let a=null;try{var m,v,p,g,f;let e=await l.API.get("/api/core/v1/devicedefinitions/".concat(encodeURIComponent(u))),i=null!==(f=null!==(g=null==e?void 0:e.status)&&void 0!==g?g:null==e?void 0:null===(v=e.error)||void 0===v?void 0:null===(m=v.response)||void 0===m?void 0:m.status)&&void 0!==f?f:null==e?void 0:null===(p=e.error)||void 0===p?void 0:p.result;!(null==e?void 0:e.isError)&&(null==e?void 0:e.data)?a=e.data:(null==e?void 0:e.isError)&&(404===i||"not found"===i)&&(a=null)}catch(e){console.error("Error checking existing template definition:",e)}if(a&&!c){n(e=>({...e,submitting:!1,error:void 0,warning:'A template with this name already exists. Press "Create template" again to overwrite it.',overwriteConfirmed:!0}));return}let h=eu(s),b={name:u,sdk:"esphome-yaml",board:o.data,...e?{description:e}:{},...Object.keys(h).length?{subsystems:h}:{}},x=a?await l.API.post("/api/core/v1/devicedefinitions/".concat(encodeURIComponent(u)),b):await l.API.post("/api/core/v1/devicedefinitions",b);if(null==x?void 0:x.isError){n(e=>{var i;return{...e,error:"Error creating template: ".concat(null!==(i=JSON.stringify(null==x?void 0:x.error))&&void 0!==i?i:"Unknown error"),submitting:!1}});return}let y=await l.API.post("/api/core/v1/files/".concat("data/deviceDefinitions/".concat(u,"/config.yaml")),{content:i});(null==y?void 0:y.isError)?n(e=>({...e,error:"Template created but failed to write YAML file.",submitting:!1})):n({open:!1,device:null,yaml:"",templateName:"",description:"",boardName:"",subsystems:[],error:void 0,warning:void 0,submitting:!1,overwriteConfirmed:!1}),await (null==t?void 0:t())}catch(e){console.error("Error creating template from YAML:",e),n(e=>({...e,error:"Unexpected error while creating the template.",submitting:!1}))}};return{templateDialog:o,setTemplateDialog:n,openCreateTemplateDialog:c,submitTemplateDialog:u,resetTemplateDialog:()=>{n({open:!1,device:null,yaml:"",templateName:"",description:"",boardName:"",subsystems:[],error:void 0,warning:void 0,submitting:!1,overwriteConfirmed:!1})},boardOptions:a}},ev={name:r.V,deviceDefinition:B.p},ep="/api/core/v1/devices",eg="/api/core/v1/deviceDefinitions?all=1";var ef=t(32878);let eh={name:r.V,sdk:a.S};var eb={"devices/**":{component:e=>{var i,t,n,a,r,d,s,c,g,f,h,x;let{pageState:y,initialItems:j,itemData:w,pageSession:D,extraData:z}=e,{replace:C,removeReplace:S,query:A}=(0,k.N)(y);Object.keys(K).forEach(e=>window[e]=K[e]);let[I,N]=(0,b.useState)(null!==(h=null==z?void 0:z.deviceDefinitions)&&void 0!==h?h:(0,l.getPendingResult)("pending"));(0,p.a)(e=>{l.API.get({url:eg},e)},N,null==z?void 0:z.deviceDefinitions);let O=(0,L.useRouter)(),{flashDevice:Z,uploadConfigFile:_,viewLogs:ed,ui:es}=(0,el.z)(),{templateDialog:ec,setTemplateDialog:eu,openCreateTemplateDialog:ef,submitTemplateDialog:eh,resetTemplateDialog:eb,boardOptions:ex}=em({deviceDefinitions:I,refreshDefinitions:()=>l.API.get({url:eg},N)}),ey=(0,V.lM)(),ej=(0,W.Tg)("devices.update"),ew=(0,W.Tg)("deviceDefinitions.update"),eD=(0,W.Tg)("deviceDefinitions.create"),ez=(0,W.Tg)("files.update"),[eC,eS]=(0,b.useState)(null),[eA,eI]=(0,b.useState)(!1),[eE,eP]=(0,b.useState)(!1),[e$,ek]=(0,b.useState)({open:!1,device:null});(0,b.useEffect)(()=>{let e=null==A?void 0:A.created,i=null==A?void 0:A.editTemplate;e&&"string"==typeof e&&l.API.get("".concat(ep,"/").concat(e)).then(e=>{!e.isError&&e.data&&(eS(J.O7.load(e.data)),i&&"string"==typeof i?(eI(!1),eP(!0)):eI(!0))})},[null==A?void 0:A.created,null==A?void 0:A.editTemplate]),(0,b.useEffect)(()=>{let e=null==A?void 0:A.editTemplate;e&&"string"==typeof e&&"undefined"!==e&&ey.openEditor(e)},[null==A?void 0:A.editTemplate]),(0,b.useEffect)(()=>{var e;if(ey.isOpen||!eE||!(null==eC?void 0:null===(e=eC.data)||void 0===e?void 0:e.deviceDefinition))return;let i=eC.data.deviceDefinition;i==="".concat(eC.data.name,"_template")&&(C("editTemplate",i),ey.openEditor(i))},[null==eC?void 0:null===(i=eC.data)||void 0===i?void 0:i.deviceDefinition,null==eC?void 0:null===(t=eC.data)||void 0===t?void 0:t.name,ey.isOpen,eE]);let eN=()=>{eI(!1),eS(null),C("created",void 0)},eT=[{text:"Edit subsystems",icon:ea.Y,action:e=>ek({open:!0,device:e}),isVisible:e=>ej},{text:"Edit template",icon:B.p,action:e=>ey.openDefinition(e.data.deviceDefinition),isVisible:e=>!!e.data.deviceDefinition&&ew},{text:"Edit config",icon:ei.z,action:e=>ey.openDevice(e.data.name),isVisible:e=>!e.data.deviceDefinition&&e.getConfigFile()&&ej},{text:"Upload definition file",icon:et.W,action:e=>{Z(e)},isVisible:e=>e.data.deviceDefinition&&ej},{text:"Edit config file",icon:ei.z,action:e=>{C("editFile",e.getConfigFile())},isVisible:e=>e.getConfigFile()&&ez},{text:"Upload config file",icon:et.W,action:async e=>{await _(e)},isVisible:e=>e.getConfigFile()&&ej},{text:"View logs",icon:en.t,action:async e=>{await ed(e)},isVisible:e=>e.getLogs()},{text:"Download firmware binary",icon:Y.J,action:async e=>{try{if(!e.data.data.lastCompile.success)return;let i=await fetch((0,er.x7)(e.data.name,e.data.data.lastCompile.sessionId));if(!i.ok)throw Error("Network response was not ok");let t=await i.blob(),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="".concat(e.data.name,".bin"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o)}catch(e){console.error("Error downloading firmware binary:",e)}},isVisible:e=>{var i,t,o;return null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:null===(i=t.lastCompile)||void 0===i?void 0:i.success}},{text:"Download firmware ELF",icon:Y.J,action:async e=>{try{if(!e.data.data.lastCompile.success)return;let i=await fetch((0,er.t$)(e.data.name,e.data.data.lastCompile.sessionId));if(!i.ok)throw Error("Network response was not ok");let t=await i.blob(),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="".concat(e.data.name,".elf"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o)}catch(e){console.error("Error downloading firmware ELF:",e)}},isVisible:e=>{var i,t,o;return null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:null===(i=t.lastCompile)||void 0===i?void 0:i.success}},{text:"Create template from ESPHome device",icon:B.p,action:async e=>{await ef(e)},isVisible:e=>{var i;return(null===(i=e.data)||void 0===i?void 0:i.platform)==="esphome"&&e.getConfigFile()&&eD}}];return(0,o.jsxs)(v.D,{title:"Devices",pageSession:D,children:[es,(0,o.jsx)(T.a,{open:eA,setOpen:eI,title:"Device Created",description:"",hideAccept:!0,onOpenChange:e=>{e||eN()},children:(0,o.jsxs)(E.FA,{padding:"$4",alignItems:"center",gap:"$4",children:[(0,o.jsx)(U.I,{children:(0,o.jsx)(G.f,{size:48,color:"var(--color9)"})}),(0,o.jsxs)($.x,{fontSize:"$6",fontWeight:"600",textAlign:"center",children:['Device "',null==eC?void 0:null===(n=eC.data)||void 0===n?void 0:n.name,'" has been created successfully!']}),(null==eC?void 0:null===(a=eC.data)||void 0===a?void 0:a.deviceDefinition)?(0,o.jsxs)($.x,{fontSize:"$4",color:"$gray11",textAlign:"center",children:["Template: ",eC.data.deviceDefinition]}):(0,o.jsx)($.x,{fontSize:"$4",color:"$gray11",textAlign:"center",children:"No template selected. You can configure it manually."}),(0,o.jsxs)(E.sL,{gap:"$4",marginTop:"$4",children:[(0,o.jsx)(M.zx,{onPress:eN,children:"Close"}),(null==eC?void 0:null===(r=eC.data)||void 0===r?void 0:r.deviceDefinition)&&(0,o.jsx)(U.I,{children:(0,o.jsx)(M.zx,{icon:et.W,onPress:()=>{eN(),Z(eC)},children:"Upload Definition"})}),!(null==eC?void 0:null===(d=eC.data)||void 0===d?void 0:d.deviceDefinition)&&(null==eC?void 0:eC.getConfigFile())&&(0,o.jsx)(U.I,{children:(0,o.jsx)(M.zx,{icon:et.W,onPress:async()=>{eN(),await _(eC)},children:"Upload Config"})})]})]})}),(0,o.jsx)(R,{templateDialog:ec,setTemplateDialog:eu,resetTemplateDialog:eb,submitTemplateDialog:eh,boardOptions:ex}),(0,o.jsx)(V.u,{...ey.editorProps,onClose:()=>{S("editTemplate"),ey.closeEditor(),eE&&eC&&(eI(!0),eP(!1))}}),(0,o.jsx)(m.V,{entityName:"devices",title:"",toolBarContent:(0,o.jsxs)(E.sL,{gap:"$6",children:[(0,o.jsx)(E.sL,{cursor:"pointer",hoverStyle:{opacity:.8},onPress:()=>O.push("/devices"),children:(0,o.jsx)(P.n,{children:(0,o.jsx)($.x,{fontSize:"$9",fontWeight:"600",color:"$color11",children:"Devices"})})}),(0,o.jsx)(E.sL,{cursor:"pointer",hoverStyle:{opacity:.8},onPress:()=>O.push("/deviceDefinitions"),children:(0,o.jsx)(P.n,{children:(0,o.jsx)($.x,{fontSize:"$9",fontWeight:"600",color:"$color8",children:"Templates"})})})]}),itemData:w,sourceUrl:ep,initialItems:j,name:"device",columns:u.Z.columns(u.Z.column("name",e=>e.name,"name"),u.Z.column("platform",e=>e.platform,"platform"),u.Z.column("device definition",e=>e.deviceDefinition,"deviceDefinition"),u.Z.column("config",e=>e.config,!1,e=>{let i=J.O7.load(e),t=!!i.data.deviceDefinition;return"esphome"==i.data.platform?(0,o.jsxs)(E.sL,{gap:"$2",flexWrap:"wrap",children:[(0,o.jsx)(q.w,{onPress:async()=>{if(!t){await _(i);return}Z(i)},children:"Upload"}),(0,o.jsx)(q.w,{onPress:()=>ey.openDevice(i.data.name),children:"Edit"})]}):(0,o.jsx)(o.Fragment,{})})),customFields:{deviceDefinition:{component:(e,i,t,n)=>{let a=I.isLoaded?I.data.items.map(e=>e.name):[];return(0,o.jsx)(F.E,{f:1,title:a.length?"Definitions":(0,o.jsx)(E.FA,{f:1,ai:"center",p:"$2",py:"$6",gap:"$4",children:(0,o.jsxs)(U.I,{children:[(0,o.jsx)($.x,{fos:14,fow:"600",children:"You don't have any definitions yet"}),(0,o.jsx)(M.zx,{icon:eo.W,onPress:()=>O.push("/deviceDefinitions"),children:"Go to definitions"})]})}),placeholder:"Select a definition",elements:a,value:i,setValue:e=>t(e)})}}},model:J.O7,pageState:y,icons:ev,dataTableGridProps:{disableItemSelection:!0,itemMinWidth:500,onSelectItem:e=>{},getBody:e=>(0,o.jsxs)(H.e,{title:e.name,separator:!1,children:[(0,o.jsx)(E.sL,{right:20,top:20,position:"absolute",children:(0,o.jsx)(Q.o,{type:"item",sourceUrl:ep,onDelete:async(e,i)=>{await l.API.get("".concat(e,"/").concat(i,"/delete"))},deleteable:()=>!0,element:J.O7.load(e),extraMenuActions:eT})}),(0,o.jsx)(E.FA,{f:1,children:(null==e?void 0:e.subsystem)?(0,o.jsx)(X.i,{subsystems:e.subsystem,deviceName:e.name}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(P.n,{mt:"20px",ml:"20px",size:20,children:"You need to upload the device"}),(0,o.jsx)(q.w,{mt:"20px",ml:"20px",width:100,onPress:()=>{Z(J.O7.load(e))},children:"Upload"})]})})]})},dataTableListProps:{disableRowIcon:!0,onEditItem:e=>{if("esphome"!=e.data.platform)return null;C("editFile",e.getConfigFile())}},extraMenuActions:eT}),(0,o.jsx)(ee.C,{open:e$.open,deviceName:null===(c=e$.device)||void 0===c?void 0:null===(s=c.data)||void 0===s?void 0:s.name,subsystems:null!==(x=null===(f=e$.device)||void 0===f?void 0:null===(g=f.data)||void 0===g?void 0:g.subsystem)&&void 0!==x?x:[],onClose:()=>ek({open:!1,device:null})})]})}},"deviceSdks/**":{component:e=>{let{pageState:i,initialItems:t,itemData:n,pageSession:a}=e;return(0,o.jsx)(v.D,{title:"Device Sdks",pageSession:a,children:(0,o.jsx)(m.V,{entityName:"devicesdks",itemData:n,rowIcon:ef.E,sourceUrl:"/api/core/v1/devicesdks",permissionResource:"deviceSdks",initialItems:t,numColumnsForm:1,name:"Sdk",onAdd:e=>e,onEdit:e=>e,columns:u.Z.columns(u.Z.column("id",e=>e.id,"id"),u.Z.column("name",e=>e.name,"name")),model:h,pageState:i,icons:eh,dataTableGridProps:{itemMinWidth:300,spacing:20}})})}},"deviceCores/**":{component:e=>{var i;let{pageState:t,initialItems:a,itemData:r,pageSession:d,extraData:g}=e,[f,y]=(0,b.useState)(null!==(i=null==g?void 0:g.sdks)&&void 0!==i?i:(0,l.getPendingResult)("pending"));return(0,p.a)(e=>{l.API.get({url:"/api/core/v1/devicesdks?all=1"},e)},y,null==g?void 0:g.cores),(0,o.jsx)(v.D,{title:"Device Cores",pageSession:d,children:(0,o.jsx)(m.V,{itemData:r,rowIcon:n.x,sourceUrl:"/api/core/v1/devicecores",permissionResource:"deviceCores",initialItems:a,numColumnsForm:1,entityName:"devicecores",name:"core",onAdd:e=>e,onEdit:e=>e,columns:u.Z.columns(u.Z.column("name",e=>e.name,"name"),u.Z.column("sdk",e=>e.sdk,"sdk",e=>{var i;return(0,o.jsx)("div",{style:{gap:"5px",display:"flex",flexDirection:"row"},children:null===(i=e.sdks)||void 0===i?void 0:i.map(e=>(0,o.jsx)(c.A,{text:e,color:"$gray5"}))})})),extraFieldsForms:{sdks:l.z.array(l.z.union([l.z.literal(""),l.z.literal("")])).generateOptions(()=>f.isLoaded?f.data.items.map(e=>h.load(e).getData()).map(e=>e.name):[]).after("name").display()},model:s,pageState:t,icons:x,dataTableGridProps:{itemMinWidth:300,spacing:20}})})}},"deviceBoards/**":{component:e=>{var i;let{pageState:t,initialItems:n,itemData:a,pageSession:r,extraData:d}=e,[g,f]=(0,b.useState)(null!==(i=null==d?void 0:d.cores)&&void 0!==i?i:(0,l.getPendingResult)("pending"));return(0,p.a)(e=>{l.API.get({url:"/api/core/v1/devicecores?all=1"},e)},f,null==d?void 0:d.cores),(0,o.jsx)(v.D,{title:"Device Boards",pageSession:r,children:(0,o.jsx)(m.V,{entityName:"deviceboards",itemData:a,rowIcon:y.b,sourceUrl:"/api/core/v1/deviceboards",permissionResource:"deviceBoards",initialItems:n,numColumnsForm:1,name:"board",onAdd:e=>e,onEdit:e=>e,columns:u.Z.columns(u.Z.column("name",e=>e.name,"name"),u.Z.column("core",e=>e.core,"core",e=>(0,o.jsx)(c.A,{text:e.core,color:"$gray5"})),u.Z.column("ports",e=>e.ports,"ports",e=>(0,o.jsx)(c.A,{text:Object.keys(e.ports).length+"",color:"$gray5"}))),extraFieldsForms:{core:l.z.union(g.isLoaded?g.data.items.map(e=>l.z.literal(s.load(e).getId())):[]).after("name")},model:w,pageState:t,icons:D,dataTableGridProps:{itemMinWidth:300,spacing:20}})})}},"deviceDefinitions/**":{component:e=>{var i,t;let{workspace:n,pageState:a,initialItems:r,itemData:d,pageSession:g,extraData:f}=e,[h,x]=(0,b.useState)(null!==(i=null==f?void 0:f.cores)&&void 0!==i?i:(0,l.getPendingResult)("pending")),[y,j]=(0,b.useState)(!1),D=(0,L.useRouter)(),S=(0,I.Py)(),U=(0,V.lM)(),F=(0,W.Tg)("deviceDefinitions.create");(0,p.a)(e=>{l.API.get({url:"/api/core/v1/devicecores?all=1"},e)},x,null==f?void 0:f.cores);let O=h.isLoaded?h.data.items.map(e=>s.load(e).getData()):[],{replace:M}=(0,k.N)(a),B=e=>{var i;return e?e instanceof A?e:A.load(null!==(i=null==e?void 0:e.data)&&void 0!==i?i:e):e},[Y,G]=(0,b.useState)(null!==(t=null==f?void 0:f.boards)&&void 0!==t?t:(0,l.getPendingResult)("pending"));(0,p.a)(e=>{l.API.get({url:"/api/core/v1/deviceboards"},e)},G,null==f?void 0:f.boards);let J=Y.isLoaded?Y.data.items.map(e=>w.load(e).getData()):[],[q,H]=(0,b.useState)(_()),[Q,K]=(0,b.useState)(null),X=e=>{let i=J.find(i=>i.name===e);if(!i)return console.error("Board not found"),null;let t=["mydevice",e];return i.ports.forEach(()=>{t.push(null)}),{components:JSON.stringify(t)+";"}},ee=()=>{H(_()),K(null)},ei=e=>{var i,t,o;let n=B(e);if(!n)return;let a=n.getData(),r=(null==a?void 0:a.name)?"".concat(a.name,"_copy"):"";K(n),H({..._(),open:!0,templateName:r,description:null!==(t=null==a?void 0:a.description)&&void 0!==t?t:"",boardName:"string"==typeof(null==a?void 0:a.board)?a.board:null!==(o=null==a?void 0:null===(i=a.board)||void 0===i?void 0:i.name)&&void 0!==o?o:""})},et=async()=>{if(!Q)return;let e=q.templateName.trim();if(!e){H(e=>({...e,error:"Name is required"}));return}H(e=>({...e,submitting:!0,error:void 0}));try{var i,t,o,n;let a=await l.API.get("/api/core/v1/devicedefinitions/".concat(encodeURIComponent(Q.getId())));if(a.isError||!a.data)throw Error(null!==(t=null===(i=a.error)||void 0===i?void 0:i.message)&&void 0!==t?t:"Unable to load definition");let r={...a.data,name:e,description:q.description},d=await l.API.post("/api/core/v1/devicedefinitions",r);if(d.isError)throw Error(null!==(n=null===(o=d.error)||void 0===o?void 0:o.message)&&void 0!==n?n:"Unable to duplicate template");S.show("Definition duplicated",{message:e}),ee()}catch(e){H(i=>{var t;return{...i,submitting:!1,error:null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Unable to duplicate template"}})}},eo=[{text:"Duplicate template",icon:C.C,action:e=>ei(e),isVisible:()=>F}];return(0,o.jsxs)(v.D,{title:"Device Definitions",workspace:n,pageSession:g,children:[(0,o.jsx)(m.V,{entityName:"device definitions",itemData:d,sourceUrl:"/api/core/v1/devicedefinitions",permissionResource:"deviceDefinitions",initialItems:r,onSelectItem:e=>{var i;let t=B(e);(null==t?void 0:null===(i=t.data)||void 0===i?void 0:i.name)&&U.openTemplate(t.data.name)},onAdd:e=>{let i=X(e.board.name);return i&&(e.config={components:i.components}),setTimeout(()=>{U.openTemplate(e.name)},500),e},numColumnsForm:1,name:"Definition",onEdit:e=>(console.log("DATA (onEdit): ",e),e),columns:u.Z.columns(u.Z.column("",()=>"",!1,e=>(0,o.jsx)(N.z,{mt:"$2",onPress:()=>M("item",e.name),Icon:z.O}),!0,"50px"),u.Z.column("name",e=>e.name,"name"),u.Z.column("board",e=>e.board,"board",e=>(0,o.jsx)(c.A,{text:e.board.name,color:"$gray5"})),u.Z.column("sdk",e=>e.sdk,"sdk",e=>(0,o.jsx)(c.A,{text:e.sdk,color:"$gray5"}))),extraFieldsForms:{sdk:l.z.union([l.z.any(),l.z.any()]).dependsOn("board").generateOptions(e=>e.board?O.find(i=>i.name===e.board.core).sdks:[]).after("board")},model:A,pageState:a,icons:Z,title:"",toolBarContent:(0,o.jsxs)(E.sL,{gap:"$6",children:[(0,o.jsx)(E.sL,{cursor:"pointer",hoverStyle:{opacity:.8},onPress:()=>D.push("/devices"),children:(0,o.jsx)(P.n,{children:(0,o.jsx)($.x,{fontSize:"$9",fontWeight:"600",color:"$color8",children:"Devices"})})}),(0,o.jsx)(E.sL,{cursor:"pointer",hoverStyle:{opacity:.8},onPress:()=>D.push("/deviceDefinitions"),children:(0,o.jsx)(P.n,{children:(0,o.jsx)($.x,{fontSize:"$9",fontWeight:"600",color:"$color11",children:"Templates"})})})]}),dataTableGridProps:{itemMinWidth:300,spacing:20},extraMenuActions:eo}),(0,o.jsx)(V.u,{...U.editorProps}),(0,o.jsx)(T.a,{p:"$2",pt:"$5",pl:"$5",setOpen:j,open:y,hideAccept:!0,description:"",children:(0,o.jsx)(E.FA,{f:1,jc:"center",ai:"center",children:(0,o.jsx)(E.sL,{mr:"$5",children:(0,o.jsx)($.x,{fontWeight:"600",fontSize:34,color:"$color9",children:"Upload your device definition file"})})})}),(0,o.jsx)(R,{templateDialog:q,setTemplateDialog:H,resetTemplateDialog:ee,submitTemplateDialog:et,boardOptions:q.boardName?[q.boardName]:[],boardFieldMode:"readonly",lockedBoardName:q.boardName,actionLabel:"Duplicate template",title:"Duplicate template"})]})}}}}}]);