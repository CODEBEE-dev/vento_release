"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6876],{76876:function(e,t,o){o.r(t),o.d(t,{MapView:function(){return f}});var a=o(52322),l=o(37288),i=o(14444),n=o(78994),r=o(22522),s=o(41473),d=o(2784),c=o(17871),p=o(16399),u=o(67045),m=o(43850),h=o(34406);let g={width:"100%",height:"100%"},x=e=>{let{items:t,layerToggle:o=!0,model:x,...j}=e,{resolvedTheme:_}=(0,p.P)(),{tint:v}=(0,u.d5)(),[P,I]=(0,d.useState)(!1),{isLoaded:y,loadError:E}=(0,c.Db)({googleMapsApiKey:h.env.NEXT_PUBLIC_GOOGLE_MAPS_TOKEN||"",libraries:["places"]}),M=(0,d.useMemo)(()=>t.data.items.map(e=>({modelItem:x.load(e)})).map(e=>({...e,location:e.modelItem.getLocation()})).filter(e=>e.location),[t.data.items]),f=M.filter(e=>{var t;return(null===(t=e.location.options)||void 0===t?void 0:t.mode)!=="geo"}).map((e,t)=>(0,a.jsx)(c.Jx,{position:{lat:parseFloat(e.location.lat),lng:parseFloat(e.location.lon)}},t)),b=(0,d.useMemo)(()=>M.filter(e=>{var t;return(null===(t=e.location.options)||void 0===t?void 0:t.mode)==="geo"}).map(e=>{let{lat:t,lon:o,options:l={}}=e.location,i=l.width||100,n=l.height||100,r=function(e,t,o,a){let{dLat:l,dLon:i}={dLat:a/2/6378137*(180/Math.PI),dLon:o/2/6378137*(180/Math.PI)/Math.cos(e*Math.PI/180)};return[{lat:e-l,lng:t-i},{lat:e-l,lng:t+i},{lat:e+l,lng:t+i},{lat:e+l,lng:t-i},{lat:e-l,lng:t-i}]}(parseFloat(t),parseFloat(o),i,n);return(0,a.jsx)(c.mg,{paths:r,options:{fillColor:"#00aaff",fillOpacity:.5,strokeColor:"#0088dd",strokeOpacity:1,strokeWeight:1}},e.modelItem.getId())}),[M]);return E?(0,a.jsx)(l.FA,{f:1,ai:"center",jc:"center",space:"$4",children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(s.u,{size:"$7"}),(0,a.jsx)(i.H2,{mt:"$6",children:"Google Maps failed to load"}),(0,a.jsx)(n.n,{ta:"center",mt:"$6",size:"$7",children:"Please check your API key or internet connection."})]})}):(0,a.jsxs)(r.Kq,{f:1,...j,children:[o&&(0,a.jsx)(l.FA,{pos:"absolute",t:10,l:10,zi:10,children:(0,a.jsx)("button",{onClick:()=>I(!P),children:P?"\uD83D\uDDFA️":"\uD83D\uDEF0️"})}),y?(0,a.jsxs)(c.b6,{mapContainerStyle:g,center:{lat:41.3875,lng:2.1688},zoom:16,mapTypeId:P?"hybrid":"roadmap",options:{tilt:0,heading:0,mapTypeControl:!1},children:[f,b]}):(0,a.jsx)(l.FA,{f:1,ai:"center",jc:"center",space:"$4",children:(0,a.jsx)(m.Z,{children:(0,a.jsx)(n.n,{children:"Loading Google Maps..."})})})]})};var j=o(17518),_=o(2715),v=o(38917),P=o(25184),I=o(70142),y=o(34406);let E=e=>{let{items:t,layerToggle:c=!0,model:h,sourceUrl:g,extraFields:x,icons:E,customFields:M,onDelete:f,deleteable:b,extraMenuActions:O,...L}=e,{resolvedTheme:A}=(0,p.P)(),{tint:T}=(0,u.d5)(),C=(0,d.useRef)(null),[F,N]=(0,d.useState)(null),[S,k]=(0,d.useState)(!1),[D,K]=(0,d.useState)({latitude:41.3875,longitude:2.1688,zoom:16}),B=(0,d.useMemo)(()=>t.data.items.map(e=>({modelItem:h.load(e)})).map(e=>({...e,location:e.modelItem.getLocation()})).filter(e=>e.location),[t.data.items]),U=(0,d.useMemo)(()=>B.filter(e=>{var t;return(null===(t=e.location.options)||void 0===t?void 0:t.mode)!=="geo"}).map((e,t)=>(0,a.jsx)(_.Jx,{longitude:parseFloat(e.location.lon),latitude:parseFloat(e.location.lat),anchor:"center",onClick:t=>{t.originalEvent.stopPropagation(),N(e)},children:(0,a.jsx)("div",{style:{width:20,height:20,borderRadius:"50%",backgroundColor:"var(--".concat(T,"10)"),border:"2px solid var(--".concat(T,"8)"),boxShadow:"0 0 4px var(--".concat(T,"6)"),cursor:"pointer",...e.location.style}})},t)),[B,T]),X=(0,d.useMemo)(()=>({type:"FeatureCollection",features:B.filter(e=>{var t;return(null===(t=e.location.options)||void 0===t?void 0:t.mode)==="geo"}).map(e=>{let{lat:t,lon:o,options:a={}}=e.location,l=a.width||100,i=a.height||100;return{type:"Feature",geometry:{type:"Polygon",coordinates:[function(e,t,o,a){let{dLat:l,dLon:i}={dLat:a/2/6378137*(180/Math.PI),dLon:o/2/6378137*(180/Math.PI)/Math.cos(e*Math.PI/180)};return[[t-i,e-l],[t+i,e-l],[t+i,e+l],[t-i,e+l],[t-i,e-l]]}(parseFloat(t),parseFloat(o),l,i)]},properties:{id:e.modelItem.getId()}}})}),[B]),w=(0,d.useCallback)(()=>{var e;let t=C.current;if(!t||!t.isStyleLoaded())return;try{t.getLayer("geo-areas-layer")&&t.removeLayer("geo-areas-layer"),t.getSource("geo-areas")&&t.removeSource("geo-areas")}catch(e){}t.addSource("geo-areas",{type:"geojson",data:X});let o=null===(e=t.getStyle().layers)||void 0===e?void 0:e.find(e=>"symbol"===e.type);t.addLayer({id:"geo-areas-layer",type:"fill",source:"geo-areas",paint:{"fill-color":"#00aaff","fill-opacity":.5,"fill-outline-color":"#0088dd"}},null==o?void 0:o.id)},[X]);return(0,a.jsxs)(r.Kq,{f:1,...L,children:[c&&(0,a.jsx)(l.FA,{pos:"absolute",t:10,l:10,zi:10,children:(0,a.jsx)("button",{onClick:()=>k(e=>!e),children:S?"\uD83D\uDDFA️":"\uD83D\uDEF0️"})}),y.env.NEXT_PUBLIC_MAPBOX_TOKEN&&"PUT_HERE_YOUR_API_KEY"!==y.env.NEXT_PUBLIC_MAPBOX_TOKEN?(0,a.jsxs)(_.D5,{ref:e=>{e&&e.getMap&&(C.current=e.getMap())},onLoad:()=>w(),onMove:e=>{let t=e.viewState;K({latitude:t.latitude,longitude:t.longitude,zoom:t.zoom})},mapboxAccessToken:y.env.NEXT_PUBLIC_MAPBOX_TOKEN,mapLib:o.e(2538).then(o.t.bind(o,30517,23)),initialViewState:D,mapStyle:S?"mapbox://styles/mapbox/satellite-streets-v12":"dark"===A?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11",children:[(0,a.jsx)(_.$j,{position:"top-right"}),(0,a.jsx)(_.ot,{position:"top-right"}),(0,a.jsx)(_.Pv,{position:"top-right"}),(0,a.jsx)(I.I,{children:U}),F&&(0,a.jsx)(_.GI,{anchor:"top",longitude:+F.location.lon,latitude:+F.location.lat,onClose:()=>N(null),closeButton:!1,style:{minWidth:320},children:(0,a.jsx)(l.sL,{f:1,ai:"center",children:(0,a.jsx)(v.EditableObject,{initialData:(0,P.getPendingResult)("loaded",F.modelItem.read()),name:F.modelItem.getId(),spinnerSize:15,loadingText:(0,a.jsx)(l.FA,{ai:"center",children:"Loading..."}),objectId:F.modelItem.getId(),sourceUrl:"".concat(g,"/").concat(F.modelItem.getId()),mode:"preview",model:h,extraFields:x,icons:E,customFields:M,columnWidth:290,onDelete:f,deleteable:b,extraMenuActions:O,onSave:()=>{}})})})]},"map-".concat(S,"-").concat(A)):(0,a.jsx)(l.FA,{f:1,ai:"center",jc:"center",space:"$4",children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(s.u,{size:"$7"}),(0,a.jsxs)(i.H2,{mt:"$6",children:[(0,a.jsx)(j.x,{children:"Missing "}),(0,a.jsx)(I.I,{children:(0,a.jsx)(j.x,{color:"var(--color10)",children:"API Key"})})]}),(0,a.jsx)(n.n,{ta:"center",mt:"$6",size:"$7",children:"Map rendering is unavailable without a Mapbox access token."})]})})]})};var M=o(34406);let f=e=>{let{preferred:t="google",...o}=e,l=!!M.env.NEXT_PUBLIC_GOOGLE_MAPS_TOKEN&&"PUT_HERE_YOUR_API_KEY"!==M.env.NEXT_PUBLIC_GOOGLE_MAPS_TOKEN,i=!!M.env.NEXT_PUBLIC_MAPBOX_TOKEN&&"PUT_HERE_YOUR_API_KEY"!==M.env.NEXT_PUBLIC_MAPBOX_TOKEN;return"google"===t&&l||l&&!i?(0,a.jsx)(x,{...o}):"mapbox"===t&&i||i&&!l?(0,a.jsx)(E,{...o}):(0,a.jsxs)("div",{style:{padding:32,textAlign:"center"},children:[(0,a.jsx)("h2",{children:"Missing Map API Key"}),(0,a.jsxs)("p",{children:["Please define either ",(0,a.jsx)("code",{children:"NEXT_PUBLIC_GOOGLE_MAPS_TOKEN"})," or ",(0,a.jsx)("code",{children:"NEXT_PUBLIC_MAPBOX_TOKEN"}),"."]})]})}}}]);