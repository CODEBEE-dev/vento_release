"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7303],{1184(e,n,s){s.d(n,{R:()=>c,x:()=>o});var r=s(4041);const t={},i=r.createContext(t);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:n},e.children)}},9921(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"architecture/monorepo","title":"Monorepo Structure","description":"Vento uses a monorepo architecture managed by Yarn workspaces. This enables code sharing between services while maintaining clear boundaries.","source":"@site/docs/architecture/monorepo.md","sourceDirName":"architecture","slug":"/architecture/monorepo","permalink":"/docs/docs/architecture/monorepo","draft":false,"unlisted":false,"editUrl":"https://github.com/protofy-xyz/protofy/tree/main/apps/docs/docs/architecture/monorepo.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Board Execution","permalink":"/docs/docs/architecture/board-execution"},"next":{"title":"MQTT Broker","permalink":"/docs/docs/architecture/mqtt"}}');var t=s(1085),i=s(1184);const c={},o="Monorepo Structure",d={},a=[{value:"Directory Structure",id:"directory-structure",level:2},{value:"Apps",id:"apps",level:2},{value:"Service Configuration",id:"service-configuration",level:3},{value:"Packages",id:"packages",level:2},{value:"Importing Packages",id:"importing-packages",level:3},{value:"Extensions",id:"extensions",level:2},{value:"Data Directory",id:"data-directory",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"monorepo-structure",children:"Monorepo Structure"})}),"\n",(0,t.jsx)(n.p,{children:"Vento uses a monorepo architecture managed by Yarn workspaces. This enables code sharing between services while maintaining clear boundaries."}),"\n",(0,t.jsx)(n.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"vento/\n\u251c\u2500\u2500 apps/                    # Services and applications\n\u2502   \u251c\u2500\u2500 adminpanel/         # Next.js admin UI\n\u2502   \u251c\u2500\u2500 api/                # User automations server\n\u2502   \u251c\u2500\u2500 agent/              # Local Go agent launcher\n\u2502   \u251c\u2500\u2500 chat/               # Matrix chat wrapper\n\u2502   \u251c\u2500\u2500 cinny/              # Matrix web client\n\u2502   \u251c\u2500\u2500 core/               # Main Vento service\n\u2502   \u251c\u2500\u2500 dendrite/           # Matrix server\n\u2502   \u251c\u2500\u2500 launcher/           # Electron launcher UI\n\u2502   \u251c\u2500\u2500 llama/              # Local LLM server\n\u2502   \u251c\u2500\u2500 mcp/                # MCP protocol server\n\u2502   \u2514\u2500\u2500 clients/            # Device agents\n\u2502       \u251c\u2500\u2500 go/             # Go agent (Windows/Linux/macOS)\n\u2502       \u251c\u2500\u2500 expo/           # React Native (Android)\n\u2502       \u2514\u2500\u2500 python/         # Python agent (Raspberry Pi)\n\u251c\u2500\u2500 packages/               # Shared libraries\n\u2502   \u251c\u2500\u2500 app/               # App-level code, bundles\n\u2502   \u251c\u2500\u2500 config/            # Configuration schemas\n\u2502   \u251c\u2500\u2500 protobase/         # Core utilities, models\n\u2502   \u251c\u2500\u2500 protodevice/       # ESP32/device components\n\u2502   \u251c\u2500\u2500 protoflow/         # Visual flow editor\n\u2502   \u251c\u2500\u2500 protolib/          # UI component library\n\u2502   \u251c\u2500\u2500 protonode/         # Node.js utilities\n\u2502   \u2514\u2500\u2500 ui/                # Base UI primitives\n\u251c\u2500\u2500 extensions/            # Feature modules\n\u2502   \u251c\u2500\u2500 boards/           # Board system\n\u2502   \u251c\u2500\u2500 events/           # Event system\n\u2502   \u251c\u2500\u2500 objects/          # Data objects\n\u2502   \u251c\u2500\u2500 chatgpt/          # OpenAI integration\n\u2502   \u251c\u2500\u2500 llama/            # Local LLM integration\n\u2502   \u2514\u2500\u2500 ...               # Many more\n\u251c\u2500\u2500 data/                  # Runtime data\n\u2502   \u251c\u2500\u2500 boards/           # Board definitions\n\u2502   \u251c\u2500\u2500 automations/      # User APIs\n\u2502   \u251c\u2500\u2500 objects/          # Data schemas\n\u2502   \u251c\u2500\u2500 databases/        # SQLite files\n\u2502   \u251c\u2500\u2500 models/           # LLM model files\n\u2502   \u2514\u2500\u2500 settings/         # Configuration\n\u251c\u2500\u2500 bin/                   # Downloaded binaries\n\u251c\u2500\u2500 logs/                  # Service logs\n\u2514\u2500\u2500 scripts/              # Utility scripts\n"})}),"\n",(0,t.jsx)(n.h2,{id:"apps",children:"Apps"}),"\n",(0,t.jsxs)(n.p,{children:["Each app in ",(0,t.jsx)(n.code,{children:"apps/"})," is a standalone service with its own:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"package.json"})," - Dependencies"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"services.js"})," - Route definitions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"service.config.js"})," - Process manager config"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"services.js"})})," declares HTTP routes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const services = [{\n    name: \"myservice\",\n    disabled: false,\n    route: (req) => {\n        if (req.url.startsWith('/mypath/')) {\n            return 'http://localhost:3010'\n        }\n    }\n}]\nmodule.exports = services;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"service.config.js"})})," configures the process:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n    apps: [{\n        name: 'myservice',\n        script: 'src/index.ts',\n        interpreter: 'node',\n        interpreter_args: '--import tsx',\n        env: { NODE_ENV: 'production' }\n    }]\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"prepare-dev"})," script"]})," (optional) in ",(0,t.jsx)(n.code,{children:"package.json"})," runs during initialization:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "prepare-dev": "node prepare.js"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"The script can do anything needed for initialization - create directories, generate config, download files, etc."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"prepare-dev"})," phase runs automatically with ",(0,t.jsx)(n.code,{children:"yarn start"})," or ",(0,t.jsx)(n.code,{children:"yarn dev"}),". Use ",(0,t.jsx)(n.code,{children:"yarn start-fast"})," or ",(0,t.jsx)(n.code,{children:"yarn dev-fast"})," to skip this phase when initialization is not needed."]}),"\n",(0,t.jsx)(n.h2,{id:"packages",children:"Packages"}),"\n",(0,t.jsx)(n.p,{children:"Shared code organized as internal packages:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Package"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"protobase"})}),(0,t.jsx)(n.td,{children:"Core models, schemas, utilities"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"protonode"})}),(0,t.jsx)(n.td,{children:"Node.js helpers, API handler, MQTT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"protolib"})}),(0,t.jsx)(n.td,{children:"250+ React UI components"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"protoflow"})}),(0,t.jsx)(n.td,{children:"Visual flow editor"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"protodevice"})}),(0,t.jsx)(n.td,{children:"ESP32/IoT components"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ui"})}),(0,t.jsx)(n.td,{children:"Base Tamagui primitives"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"app"})}),(0,t.jsx)(n.td,{children:"App bundles, context aggregation"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"config"})}),(0,t.jsx)(n.td,{children:"Configuration schemas"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"importing-packages",children:"Importing Packages"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { ProtoModel, API, getLogger } from 'protobase'\nimport { handler, getServiceToken } from 'protonode'\nimport { DataView, AdminPage } from 'protolib/components'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,t.jsx)(n.p,{children:"Extensions add features modularly:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'extensions/myextension/\n\u251c\u2500\u2500 package.json           # Dependencies\n\u251c\u2500\u2500 coreApis.ts           # API routes for core\n\u251c\u2500\u2500 coreContext/\n\u2502   \u2514\u2500\u2500 index.ts          # context.myextension.* functions\n\u251c\u2500\u2500 adminPages.tsx        # Admin panel pages\n\u251c\u2500\u2500 networkOption.tsx     # "+ Add" menu option\n\u251c\u2500\u2500 cards/                # Card templates (JSON)\n\u2514\u2500\u2500 masks/                # Visual programming nodes\n'})}),"\n",(0,t.jsx)(n.p,{children:"Extensions are auto-discovered and loaded by the core service."}),"\n",(0,t.jsx)(n.h2,{id:"data-directory",children:"Data Directory"}),"\n",(0,t.jsxs)(n.p,{children:["User-generated content lives in ",(0,t.jsx)(n.code,{children:"data/"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Path"}),(0,t.jsx)(n.th,{children:"Content"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/boards/"})}),(0,t.jsx)(n.td,{children:"Board definitions (.json, .js files)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/automations/"})}),(0,t.jsx)(n.td,{children:"User API definitions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/objects/"})}),(0,t.jsx)(n.td,{children:"Data model schemas"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/databases/"})}),(0,t.jsx)(n.td,{children:"SQLite database files"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/models/"})}),(0,t.jsx)(n.td,{children:"LLM model files (.gguf)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/keys/"})}),(0,t.jsx)(n.td,{children:"API keys and secrets"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/settings/"})}),(0,t.jsx)(n.td,{children:"System configuration"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"data/pages/"})}),(0,t.jsx)(n.td,{children:"Static frontend builds"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);