"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6417],{1184(e,n,t){t.d(n,{R:()=>r,x:()=>c});var a=t(4041);const s={},o=a.createContext(s);function r(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:n},e.children)}},1674(e,n,t){t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"boards/context","title":"Context Functions","description":"Card code cannot use require or import directly. Instead, capabilities are accessed through context.* functions injected by extensions.","source":"@site/docs/boards/context.md","sourceDirName":"boards","slug":"/boards/context","permalink":"/docs/docs/boards/context","draft":false,"unlisted":false,"editUrl":"https://github.com/protofy-xyz/protofy/tree/main/apps/docs/docs/boards/context.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Cards","permalink":"/docs/docs/boards/cards"},"next":{"title":"Boards Overview","permalink":"/docs/docs/boards/overview"}}');var s=t(1085),o=t(1184);const r={},c="Context Functions",i={},l=[{value:"How Context Works",id:"how-context-works",level:2},{value:"Available Functions",id:"available-functions",level:2},{value:"AI",id:"ai",level:3},{value:"Events",id:"events",level:3},{value:"State Management",id:"state-management",level:3},{value:"Keys &amp; Secrets",id:"keys--secrets",level:3},{value:"Scheduling",id:"scheduling",level:3},{value:"Global State",id:"global-state",level:3},{value:"Flow Utilities",id:"flow-utilities",level:3},{value:"Context Function Pattern",id:"context-function-pattern",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"context-functions",children:"Context Functions"})}),"\n",(0,s.jsxs)(n.p,{children:["Card code cannot use ",(0,s.jsx)(n.code,{children:"require"})," or ",(0,s.jsx)(n.code,{children:"import"})," directly. Instead, capabilities are accessed through ",(0,s.jsx)(n.code,{children:"context.*"})," functions injected by extensions."]}),"\n",(0,s.jsx)(n.h2,{id:"how-context-works",children:"How Context Works"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Extensions export functions in ",(0,s.jsx)(n.code,{children:"extensions/{name}/coreContext/index.ts"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"packages/app/bundles/coreContext.ts"})," aggregates all exports"]}),"\n",(0,s.jsxs)(n.li,{children:["Context is passed to card execution as ",(0,s.jsx)(n.code,{children:"context.{extension}.{function}"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"available-functions",children:"Available Functions"}),"\n",(0,s.jsx)(n.h3,{id:"ai",children:"AI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// OpenAI GPT\nconst response = await context.chatgpt.prompt({\n    message: 'Hello!',\n    model: 'gpt-4o-mini',\n    conversation: [] // optional history\n})\n\n// Local LLM (llama.cpp)\nconst response = await context.llama.prompt({\n    message: 'Hello!',\n    model: 'gemma-3-12b-it-Q4_1'\n})\n\n// List local models\nconst models = await context.llama.llamaListModels()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"events",children:"Events"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Emit event\nawait context.events.emitEvent(\n    'orders/created',     // path\n    'api',                // from\n    'user123',           // user\n    { orderId: 'X' },    // payload\n    false                // ephemeral\n)\n\n// Subscribe to events\ncontext.events.onEvent(\n    context.mqtt,\n    context,\n    async (event) => {\n        console.log('Event:', event.payload)\n    },\n    'orders/#'  // path pattern\n)\n\n// Get last event\nconst last = await context.events.getLastEvent({\n    path: 'devices/sensor1/reading'\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"state-management",children:"State Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Set board variable\ncontext.boards.setVar('myKey', 'myValue')\n\n// Get board variable\nconst value = context.boards.getVar('myKey')\n\n// Check if variable exists\nconst exists = context.boards.hasVar('myKey')\n\n// Clear variable\ncontext.boards.clearVar('myKey')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"keys--secrets",children:"Keys & Secrets"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Get API key (falls back to env var)\nconst key = await context.keys.getKey({\n    key: 'OPENAI_API_KEY',\n    defaultValue: undefined\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"scheduling",children:"Scheduling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// One-time schedule\ncontext.automations.createSchedule(\n    '14:30',           // time (HH:mm)\n    () => { ... },     // callback\n    15,                // day\n    'march',           // month\n    2025               // year\n)\n\n// Periodic schedule (cron-like)\ncontext.automations.createPeriodicSchedule(\n    8,                 // hour\n    30,                // minute\n    () => { ... },     // callback\n    'monday,wednesday,friday'\n)\n\n// Advanced scheduling\nconst job = context.automations.scheduleJob({\n    name: 'backup-job',\n    hours: 2,\n    minutes: 0,\n    days: 'sunday',\n    callback: async () => { ... },\n    autoStart: true,\n    runOnInit: false\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"global-state",children:"Global State"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Set global state\ncontext.state.set({\n    group: 'sensors',\n    tag: 'temperature',\n    name: 'current',\n    value: 23.5\n})\n\n// Get global state\nconst temp = context.state.get({\n    group: 'sensors',\n    tag: 'temperature',\n    name: 'current'\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"flow-utilities",children:"Flow Utilities"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Switch/case\ncontext.flow2.switch(value, {\n    'case1': () => { ... },\n    'case2': () => { ... }\n})\n\n// Array operations\ncontext.flow2.forEach(array, (item) => { ... })\ncontext.flow2.filter(array, (item) => item.active)\ncontext.flow2.map(array, (item) => item.name)\n\n// JSON utilities\nconst obj = context.flow2.jsonParse(jsonString)\nconst str = context.flow2.toJson(object)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"context-function-pattern",children:"Context Function Pattern"}),"\n",(0,s.jsx)(n.p,{children:"All context functions follow this pattern:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const myFunction = async (options: {\n    requiredParam: string,\n    optionalParam?: number,\n    done?: (result) => void,\n    error?: (err) => void\n}) => {\n    const { requiredParam, optionalParam = 10, done = (r) => r, error = () => {} } = options\n    \n    try {\n        const result = await doSomething(requiredParam)\n        done(result)\n        return result\n    } catch (err) {\n        error(err)\n        throw err\n    }\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);