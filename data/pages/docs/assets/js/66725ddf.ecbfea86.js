"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8077],{1184(e,n,t){t.d(n,{R:()=>d,x:()=>c});var s=t(4041);const r={},i=s.createContext(r);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(i.Provider,{value:n},e.children)}},2767(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"event-system","title":"Event System","description":"Vento includes a powerful event system that enables decoupled communication between components. Events flow through MQTT and allow boards, APIs, and UI components to react to changes without knowing about each other.","source":"@site/docs/event-system.md","sourceDirName":".","slug":"/event-system","permalink":"/docs/docs/event-system","draft":false,"unlisted":false,"editUrl":"https://github.com/protofy-xyz/protofy/tree/main/apps/docs/docs/event-system.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Data Objects Overview","permalink":"/docs/docs/objects/overview"},"next":{"title":"Device Agents","permalink":"/docs/docs/category/device-agents"}}');var r=t(1085),i=t(1184);const d={sidebar_position:6},c="Event System",a={},o=[{value:"Concepts",id:"concepts",level:2},{value:"Event Schema",id:"event-schema",level:2},{value:"Backend Usage",id:"backend-usage",level:2},{value:"Emitting Events",id:"emitting-events",level:3},{value:"Subscribing to Events",id:"subscribing-to-events",level:3},{value:"Get Last Event",id:"get-last-event",level:3},{value:"Frontend Usage",id:"frontend-usage",level:2},{value:"useEventEffect",id:"useeventeffect",level:3},{value:"useEvent",id:"useevent",level:3},{value:"useLastEvent",id:"uselastevent",level:3},{value:"Common Event Patterns",id:"common-event-patterns",level:2},{value:"MQTT Topics",id:"mqtt-topics",level:2},{value:"Using Events in Cards",id:"using-events-in-cards",level:2},{value:"Event API Endpoints",id:"event-api-endpoints",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"event-system",children:"Event System"})}),"\n",(0,r.jsx)(n.p,{children:"Vento includes a powerful event system that enables decoupled communication between components. Events flow through MQTT and allow boards, APIs, and UI components to react to changes without knowing about each other."}),"\n",(0,r.jsx)(n.h2,{id:"concepts",children:"Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Path"}),": Hierarchical event type (e.g., ",(0,r.jsx)(n.code,{children:"devices/esp32/online"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"From"}),": Source identifier (e.g., ",(0,r.jsx)(n.code,{children:"core"}),", ",(0,r.jsx)(n.code,{children:"api"}),", ",(0,r.jsx)(n.code,{children:"device"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User"}),": User who triggered the event"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Payload"}),": Event-specific data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ephemeral"}),": If ",(0,r.jsx)(n.code,{children:"true"}),", event is not stored in database"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"event-schema",children:"Event Schema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"{\n    path: string,        // Hierarchical: 'devices/esp32/online'\n    from: string,        // Source: 'core', 'api', etc.\n    user: string,        // User ID or 'system'\n    payload: object,     // Event-specific data\n    ephemeral?: boolean, // If true, not stored in DB\n    created: string      // ISO timestamp\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"backend-usage",children:"Backend Usage"}),"\n",(0,r.jsx)(n.h3,{id:"emitting-events",children:"Emitting Events"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// In card code or automations\nawait context.events.emitEvent(\n    'orders/created',           // path\n    'api',                      // from\n    'user123',                  // user\n    { orderId: 'ORD-001' },    // payload\n    false                       // ephemeral (store in DB)\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"subscribing-to-events",children:"Subscribing to Events"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// In automations or extensions\ncontext.events.onEvent(\n    context.mqtt,               // MQTT client\n    context,                    // Context object\n    async (event) => {\n        console.log('Order created:', event.payload)\n    },\n    'orders/#',                 // path pattern (# = wildcard)\n    'api'                       // optional: filter by 'from'\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"get-last-event",children:"Get Last Event"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const lastEvent = await context.events.getLastEvent({\n    path: 'devices/sensor1/reading',\n    from: 'device',\n    user: 'system'\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"frontend-usage",children:"Frontend Usage"}),"\n",(0,r.jsx)(n.h3,{id:"useeventeffect",children:"useEventEffect"}),"\n",(0,r.jsx)(n.p,{children:"React to events with payload:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { useEventEffect } from '@extensions/events/hooks'\n\nfunction OrderNotifications() {\n    useEventEffect(\n        (payload, fullEvent) => {\n            console.log('New order:', payload)\n            showNotification(`Order ${payload.orderId} created`)\n        },\n        { path: 'orders/created', from: 'api' },\n        true  // also fetch initial/last event\n    )\n    \n    return <div>Listening for orders...</div>\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useevent",children:"useEvent"}),"\n",(0,r.jsx)(n.p,{children:"Get last event as state:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { useEvent } from '@extensions/events/hooks'\n\nfunction TemperatureDisplay() {\n    const lastEvent = useEvent(\n        { path: 'sensors/temperature' },\n        (msg) => console.log('Temperature:', msg.parsed.payload)\n    )\n    \n    return <div>Temperature: {lastEvent?.parsed?.payload?.value}\xb0C</div>\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"uselastevent",children:"useLastEvent"}),"\n",(0,r.jsx)(n.p,{children:"Simple last event value:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { useLastEvent } from '@extensions/events/hooks'\n\nfunction DeviceStatus() {\n    const event = useLastEvent({ path: 'devices/status' })\n    \n    return <div>Device: {event?.payload?.status}</div>\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-event-patterns",children:"Common Event Patterns"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Path Pattern"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"devices/{id}/online"})}),(0,r.jsx)(n.td,{children:"Device came online"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"devices/{id}/offline"})}),(0,r.jsx)(n.td,{children:"Device went offline"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boards/{name}/updated"})}),(0,r.jsx)(n.td,{children:"Board was modified"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"objects/{name}/create/#"})}),(0,r.jsx)(n.td,{children:"Object was created"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"objects/{name}/update/#"})}),(0,r.jsx)(n.td,{children:"Object was updated"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"objects/{name}/delete/#"})}),(0,r.jsx)(n.td,{children:"Object was deleted"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"services/{name}/start"})}),(0,r.jsx)(n.td,{children:"Service started"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"mqtt-topics",children:"MQTT Topics"}),"\n",(0,r.jsx)(n.p,{children:"Events are published to:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"notifications/event/create/{path}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Subscribe with wildcards:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"notifications/event/create/devices/#"})," - All device events"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"notifications/event/create/orders/+/created"})," - Order created events"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"using-events-in-cards",children:"Using Events in Cards"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"//@card/react\nfunction Widget(card) {\n    const [data, setData] = React.useState(null)\n    \n    useEventEffect(\n        (payload) => setData(payload),\n        { path: 'sensors/reading' },\n        true\n    )\n    \n    return (\n        <Tinted>\n            <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n                <YStack ai=\"center\" jc=\"center\">\n                    <Text>Sensor: {data?.value ?? 'N/A'}</Text>\n                </YStack>\n            </ProtoThemeProvider>\n        </Tinted>\n    )\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"event-api-endpoints",children:"Event API Endpoints"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/core/v1/events"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"List events (paginated)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/core/v1/events"})}),(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:"Create event"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/core/v1/events/{id}"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"Get specific event"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Query Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"filter[path]"})," - Filter by path prefix"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"filter[from]"})," - Filter by source"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"filter[user]"})," - Filter by user"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);