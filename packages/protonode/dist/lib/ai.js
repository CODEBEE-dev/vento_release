var d=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var w=(e,t)=>{for(var n in t)d(e,n,{get:t[n],enumerable:!0})},h=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of b(t))!j.call(e,a)&&a!==n&&d(e,a,{get:()=>t[a],enumerable:!(s=I(t,a))||s.enumerable});return e};var S=e=>h(d({},"__esModule",{value:!0}),e);var C={};w(C,{ai:()=>k,cleanCode:()=>v,processAgentResponse:()=>$,processResponse:()=>R});module.exports=S(C);var p=require("protobase"),A=async e=>(await p.API.post("/api/agents/v1/llm_agent/agent_input?token="+(0,p.getServiceToken)(),{message:e})).data,P=({prompt:e,done:t=async s=>s,error:n=s=>s})=>{let s=[{role:"system",content:[{type:"text",text:e}]}];return t(s),s},v=e=>{let t=e.replace(/^```[^\s]+/g,"").replace(/```/g,"").trim();return t.startsWith("javascript")&&(t=t.replace("javascript","").trim()),t},$=async({response:e,execute_action:t,done:n=async a=>a,error:s=a=>a})=>{if(!e||!t)return null;try{let a=JSON.parse(e.replace(/^```[\w]*\n?/,"").replace(/```$/,"").trim()),f=[],g=[];for(let o of a.actions||[]){if(!o||!o.name)continue;let i=o.params||{},r=await t(o.name,i);if(f.push({name:o.name,params:i,result:r}),r&&typeof r=="object"&&r.offered===!0&&r.approvalId){let l=r.boardId,u=r.action||o.name,c=r.approvalId,x=r.message,y;if(l&&u&&c){let m=`/api/core/v1/boards/${l}/actions/${u}/approvals/${c}`;y={accept:`${m}/accept`,reject:`${m}/reject`,status:`${m}/status`}}g.push({boardId:l,action:u,approvalId:c,id:c,message:x,params:i,urls:y})}}return await n({response:a.response??"",executedActions:f,approvals:g})}catch(a){return s(a)}},R=$,k={callModel:async e=>await A(e),cleanCode:e=>v(e),getSystemPrompt:e=>P(e)};0&&(module.exports={ai,cleanCode,processAgentResponse,processResponse});
