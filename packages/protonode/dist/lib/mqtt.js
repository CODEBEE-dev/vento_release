var a=Object.create;var s=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var h=(e,n)=>{for(var o in n)s(e,o,{get:n[o],enumerable:!0})},d=(e,n,o,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of m(n))!C.call(e,r)&&r!==o&&s(e,r,{get:()=>n[r],enumerable:!(c=g(n,r))||c.enumerable});return e};var l=(e,n,o)=>(o=e!=null?a(u(e)):{},d(n||!e||!e.__esModule?s(o,"default",{value:e,enumerable:!0}):o,e)),M=e=>d(s({},"__esModule",{value:!0}),e);var q={};h(q,{getMQTTClient:()=>Q});module.exports=M(q);var T=l(require("mqtt")),f=require("protobase"),i=(0,f.getLogger)(),t,Q=(e,n,o)=>{if(!t){let c=process.env.MQTT_URL??"mqtt://localhost:1883";t=T.connect(c,{username:e,clientId:e+"_"+Math.random().toString(16).substr(2,8),password:n}),t.hasConnected=!1,t.retries=0,i.debug({mqttServer:c,username:e},"Connecting to MQTT"),t.on("connect",function(){!t.hasConnected&&o&&o(t),t.hasConnected=!0,t.retries=0,i.debug("Connected to MQTT")}),t.on("reconnect",function(){(t.hasConnected||t.retries>10)&&i.debug("Trying to connect MQTT...")}),t.on("offline",function(){t.hasConnected&&i.debug("MQTT disconnected")}),t.on("error",function(r){t.hasConnected&&i.error({error:r},"MQTT Error")}),t=t}return t};0&&(module.exports={getMQTTClient});
