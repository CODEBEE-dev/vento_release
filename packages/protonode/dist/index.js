var vt=Object.create;var Ie=Object.defineProperty;var $t=Object.getOwnPropertyDescriptor;var Ct=Object.getOwnPropertyNames;var It=Object.getPrototypeOf,Dt=Object.prototype.hasOwnProperty;var jt=(e,t)=>{for(var a in t)Ie(e,a,{get:t[a],enumerable:!0})},He=(e,t,a,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ct(t))!Dt.call(e,o)&&o!==a&&Ie(e,o,{get:()=>t[o],enumerable:!(r=$t(t,o))||r.enumerable});return e};var J=(e,t,a)=>(a=e!=null?vt(It(e)):{},He(t||!e||!e.__esModule?Ie(a,"default",{value:e,enumerable:!0}):a,e)),St=e=>He(Ie({},"__esModule",{value:!0}),e);var yr={};jt(yr,{AutoAPI:()=>qt,AutoActions:()=>Gt,ImportType:()=>lt,ProtoDB:()=>Je,addElementToArrayLiteral:()=>ar,addFeature:()=>or,addImportToSourceFile:()=>tr,addObjectLiteralProperty:()=>nr,ai:()=>Ee,boardConnect:()=>fr,checkPassword:()=>G.checkPassword,cleanCode:()=>ot,closeDBS:()=>Ye,connectDB:()=>We,dbProvider:()=>je,extractChainCalls:()=>er,filterFilesByRegex:()=>Ot,genToken:()=>G.genToken,getApp:()=>Ut,getAuth:()=>qe,getDB:()=>Qe,getDBOptions:()=>Be,getDefinition:()=>me,getDefinitions:()=>Xt,getDeviceToken:()=>D.getDeviceToken,getImport:()=>dt,getMQTTClient:()=>cr,getObjectCardDefinitions:()=>Ue,getObjectCards:()=>Jt,getPropertyValueFromObjectLiteral:()=>rr,getRoot:()=>Me,getServiceToken:()=>D.getServiceToken,getSessionContext:()=>Mt,getSourceFile:()=>ut,handler:()=>A,hasFeature:()=>Ve,hash:()=>G.hash,listFilesRecursively:()=>Et,processAgentResponse:()=>it,processResponse:()=>Qt,registerDBProvider:()=>Tt,removeFeature:()=>ir,removeFileWithImports:()=>sr,removeImportFromSourceFile:()=>pt,removeObjectLiteralProperty:()=>ft,requireAdmin:()=>At,requireAuth:()=>_t,requirePermission:()=>Ft,resolveBoardParam:()=>bt,response:()=>Lt,toSourceFile:()=>Nt,validateSession:()=>Vt,verifyToken:()=>G.verifyToken});module.exports=St(yr);var G=require("protobase");var De,We=(e,t,a)=>De.initDB(e,t,a),Qe=(e,t,a,r)=>De.connect(e),Ye=async()=>De.closeDBS(),je={connectDB:We,getDB:Qe,closeDBS:Ye},Be=(e,t)=>({indexes:e.getIndexes(),groupIndexes:e.getGroupIndexes(),dbOptions:{batch:!1,batchLimit:100,batchTimeout:2e3,...t}});function Tt(e){De=e}var Se=J(require("fs")),Ze=J(require("path"));function Et(e){let t=[];function a(r){let o=Se.readdirSync(r);for(let d of o){let y=Ze.join(r,d);Se.statSync(y).isDirectory()?a(y):t.push(y)}}return a(e),t}function Ot(e,t){return e.filter(a=>{for(let r of t)if(!r.test(a))return!1;return!0})}var H=require("protobase");var Rt=(0,H.getLogger)(),qe=e=>{let t,a;try{a=JSON.parse(e.cookies.session)}catch{a=null}var r="";let o=e.headers?.authorization;if(o&&o.startsWith("Bearer ")?r=o.slice(7):(e.query.token||a&&a.token)&&(r=e.query.token?e.query.token:a.token,Array.isArray(r)&&(r=r[0])),r)try{t=(0,H.createSession)((0,G.verifyToken)(r))}catch(d){Rt.error({error:d},"Error reading token"),t=(0,H.createSession)()}else t=(0,H.createSession)();return{session:t,token:r}},A=e=>async(t,a,r)=>{try{let o=qe(t);await e(t,a,{...o.session,token:o.token},r)}catch(o){if(o instanceof H.ZodError){let d=o.flatten();a.status(400).send(d)}else o.toString()=="E_PERM"?a.status(403).send({error:o.toString()}):o.toString()=="E_AUTH"?a.status(401).send({error:o.toString()}):o.toString()=="File already exists"?a.status(409).send({error:o.toString()}):a.status(500).send({error:o.toString()})}},_t=()=>A(async(e,t,a,r)=>{if(!a||!a.loggedIn){t.status(401).send({error:"Unauthorized"});return}r()}),At=()=>A(async(e,t,a,r)=>{if(!a||!a.user.admin){t.status(401).send({error:"Unauthorized"});return}r()}),Ft=e=>A(async(t,a,r,o)=>{if(!r||!r.loggedIn){a.status(401).send({error:"Unauthorized"});return}if(!(0,H.checkPermission)(r,e)){a.status(403).send({error:"Forbidden",requiredPermission:e});return}o()});var Xe=require("protobase"),Bt=(0,Xe.getLogger)(),Lt=async(e,t,a=[],r="Error reading database")=>{e.then(o=>{t.send(o)}).catch(o=>{o.notFound?t.send([]):(t.status(500).send("Error reading database"),Bt.error({error:o},"Error reading database"))})};var Le=J(require("express")),Ne=J(require("cookie-parser")),et=J(require("cors")),tt=J(require("pino-http")),oe=require("protobase");var rt=J(require("express-list-endpoints")),V,Ut=(e=t=>{})=>{if(!V){let t=(0,oe.getLogger)(),a=(0,oe.getConfig)();V=(0,Le.default)(),e(V),V.set("json spaces",2),V.use((0,et.default)()),V.use((0,Ne.default)()),V.use(Le.default.json({limit:"50mb"})),V.use((0,tt.default)({customSuccessMessage:function(r,o){return`${r.method} ${r.originalUrl} - ${o.statusCode}`},serializers:{req:r=>process.env.NODE_ENV==="development"?{method:r.method,url:r.url}:r,res:r=>process.env.NODE_ENV==="development"?{code:r.statusCode}:r},...a.logger,useLevel:"trace"})),V.get(global.defaultRoute+"/endpoints",A(async(r,o,d,y)=>{(0,oe.hasPermission)(d,"admin/endpoints/list"),o.send((0,rt.default)(V))})),t.debug({route:global.defaultRoute},"Default route: "+global.defaultRoute)}return V};var at=J(require("jsonwebtoken")),nt=require("protobase"),Mt=async e=>({state:"resolved",group:e?(await nt.API.get("/api/core/v1/groups/"+e)).data:{}}),Vt=async e=>at.default.verify(e.token??"",process.env.TOKEN_SECRET??"");var Q=require("protobase");var D=require("protobase");var st=e=>{switch(e){case"number":return"number";case"boolean":return"boolean";case"array":case"object":case"record":return"json";case"string":case"date":case"relation":case"union":default:return"string"}},zt=(e,t)=>{let a={},r={};for(let[o,d]of Object.entries(e)){let y=d.modifiers?.some(f=>f.name==="id"),u=d.modifiers?.some(f=>f.name==="generate");if(d.modifiers?.some(f=>f.name==="hidden"))continue;let k=d.modifiers?.find(f=>f.name==="label")?.params?.[0]?.replace(/['"]/g,"")||o,$=d.modifiers?.find(f=>f.name==="hint")?.params?.[0]?.replace(/['"]/g,"")||"",p=st(d.type),m=$||`${k} (${d.type})${y?" - this will be used as the id":""}`;a[o]=m,r[o]={visible:!0,defaultValue:d.type==="boolean"?!1:d.type==="number"?0:"",type:p}}return{params:a,configParams:r}},Kt=e=>`const action = userParams.action;
delete userParams["action"];

if (action == "create") {
    return execute_action("/api/v1/actions/${e}/create", userParams);
} else if (action == "update") {
    return execute_action("/api/v1/actions/${e}/update", userParams);
} else if (action == "read") {
    return execute_action("/api/v1/actions/${e}/read", userParams);
} else if (action == "delete") {
  return execute_action("/api/v1/actions/${e}/delete", userParams);
} else if (action == "exists") {
  return execute_action("/api/v1/actions/${e}/exists", userParams);
} else if (action == "select") {
  if (!userParams.selectedItem) {
    return
  }

  return {
    selected: userParams.selectedItem.data, 
    items: await execute_action("/api/v1/actions/${e}/list", {})
  };
} else {
  return {
    selected: null, 
    items: await execute_action("/api/v1/actions/${e}/list", {})
  };
}`,Ue=({modelName:e,modelType:t,pluralName:a,object:r,html:o={},keys:d})=>{let y=a??e,u=(p,m)=>o[p]?o[p]:m,h={},i={},k={id:`id of the ${e} to update`,field:`field to update in the ${e}`,value:"new value for the field"},v={id:{visible:!0,defaultValue:"",type:"string"},field:{visible:!0,defaultValue:"",type:"string"},value:{visible:!0,defaultValue:"",type:"any"}};if(d&&Object.keys(d).length>0){let p=zt(d,e);h=p.params,i=p.configParams;let m=Object.keys(d).filter(f=>!d[f].modifiers?.some(T=>T.name==="hidden"));k={id:`id of the ${e} to update`,field:`field to update in the ${e}. Possible fields: ${m.join(", ")}`,value:"new value for the field"}}else if(t?.getObjectFieldsDefinition){let p=t.getObjectFieldsDefinition();h=Object.keys(p).filter(m=>p[m].autogenerate==!1).map(m=>({[m]:p[m].description+" ("+p[m].type+")"+(p[m].isId?" (this will be used as the id of the element)":"")})).reduce((m,f)=>({...m,...f}),{}),i=Object.keys(p).filter(m=>p[m].autogenerate==!1).reduce((m,f)=>(m[f]={visible:!0,defaultValue:p[f].type==="boolean"?!1:p[f].type==="number"?0:"",type:st(p[f].type)},m),{}),k={id:`id of the ${e} to update`,field:`field to update in the ${e}. Possible fields: ${Object.keys(p).join(", ")}`,value:"new value for the field"}}return[{group:"storages",tag:e,name:"exists",id:"storage_"+e+"_exists",templateName:"Check if a "+e+" exists in the storage",defaults:{html:u("exists"),width:2,height:8,icon:"file-check",displayResponse:!0,name:`exists ${e}`,type:"action",description:`Check if ${e} exists given an id. Returns true if it exists, false otherwise.`,params:{id:"id to look for"},rulesCode:`return execute_action("/api/v1/actions/${e}/exists", userParams)`}},{group:"storages",tag:e,name:"table",id:"storage_"+e+"_last_table",templateName:"Last "+e+" table",defaults:{width:3,height:8,name:"Table",icon:"table-properties",description:"Displays a table with the last "+y,type:"value",html:u("last_table",`
//data contains: data.value, data.icon and data.color
return card({
    content: cardTable(data.value), padding: '3px'
});
`),rulesCode:`return states.storages?.${e}.lastEntries`}},{group:"storages",tag:e,name:"read",id:"storage_"+e+"_read",templateName:"Read "+e+" from the storage",defaults:{html:u("read"),width:2,height:8,icon:"file-search",displayResponse:!0,name:`read ${e}`,type:"action",description:`Reads${e} given an id. Returns the content of the object if it exists, false otherwise.`,params:{id:`id of the ${e} to read`},rulesCode:`return execute_action("/api/v1/actions/${e}/read", userParams)`}},{group:"storages",tag:e,name:"create",id:"storage_"+e+"_create",templateName:"Create "+e+" in the storage",defaults:{html:u("create"),width:2,height:Math.max(8,6+Object.keys(h).length*2),icon:"file-plus",displayResponse:!0,name:`create ${e}`,type:"action",description:`Creates a ${e} given its content. Returns the created ${e}.`,params:h,configParams:i,rulesCode:`return execute_action("/api/v1/actions/${e}/create", userParams)`}},{group:"storages",tag:e,name:"delete",id:"storage_"+e+"_delete",templateName:"Delete "+e+" from the storage",defaults:{width:2,height:8,icon:"trash",displayResponse:!0,name:`delete ${e}`,type:"action",html:u("delete"),description:`Deletes ${e} by id. Returns true if it was deleted, false otherwise.`,params:{id:"id of the "+e+" to delete"},rulesCode:`return execute_action("/api/v1/actions/${e}/delete", userParams)`}},{group:"storages",tag:e,name:"update",id:"storage_"+e+"_update",templateName:"Updates "+e+" in the storage",defaults:{html:u("update"),width:2,height:12,icon:"file-pen-line",displayResponse:!0,name:`update ${e}`,type:"action",description:`Updates a ${e} by id, changing field with a given value. Returns the updated ${e} if it was updated, false otherwise.`,params:k,configParams:v,rulesCode:`return execute_action("/api/v1/actions/${e}/update", userParams)`}},{group:"storages",tag:e,name:"lastCreated",id:"storage_"+e+"_lastCreated",templateName:"Last created "+e,defaults:{width:2,height:8,html:u("lastCreated"),type:"value",icon:"rss",name:`lastCreated ${e}`,description:`Last Created ${e}`,rulesCode:`return states.storages?.${e}.lastCreated;`}},{group:"storages",tag:e,name:"lastUpdated",id:"storage_"+e+"_lastUpdated",templateName:"Last updated "+e,defaults:{html:u("lastUpdated"),type:"value",icon:"rss",name:`lastUpdated ${e}`,description:`Last updated ${e}`,rulesCode:`return states.storages?.${e}.lastUpdated;`}},{group:"storages",tag:e,name:"totalItems",id:"storage_"+e+"_totalitems",templateName:"Total "+y,defaults:{html:u("totalItems"),type:"value",icon:"boxes",name:`Total ${y}`,description:`Total ${y}`,rulesCode:`return states.storages?.${e}.total;`}},{group:"storages",tag:e,name:"list",id:"storage_"+e+"_manager",templateName:e+" storage manager",emitEvent:!0,defaults:{width:4,height:10,icon:"search",displayResponse:!0,method:"post",name:`${e} storage manager`,html:`//@card/react\r
\r
function Widget(card) {\r
  return (\r
      <Tinted>\r
        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\r
         <StorageView name="`+(r??e)+`" onItemsChange={() => execute_action(card.name, {})} onSelectItem={(item) => execute_action(card.name, {action: "select", selectedItem: JSON.stringify(item)})}/>\r
        </ProtoThemeProvider>\r
      </Tinted>\r
  );\r
}\r
`,type:"action",description:`Returns a list of ${e} objects. You can filter the results by passing itemsPerPage, page, search, orderBy and orderDirection parameters.`,params:{itemsPerPage:"number of items per page (optional)",page:"page number to retrieve (optional)",search:"search term to filter the results (optional)",orderBy:"field to order the results by (optional)",orderDirection:"direction to order the results by (asc or desc) (optional)",action:"action to perform in the storage: list, read, create, update, delete, exists",id:"id (required for actions: read, create, update, delete, exists)",selectedItem:"selected item on user click"},configParams:{selectedItem:{defaultValue:"",type:"json"}},presets:{create:{description:"creates/adds item to the storage",configParams:{action:{defaultValue:"create"}}},update:{description:"updates field of item of the storage",configParams:{action:{defaultValue:"update"}}},read:{description:"reads item of the storage",configParams:{action:{defaultValue:"read"}}},delete:{description:"deletes item of the storage",configParams:{action:{defaultValue:"delete"}}},list:{description:"list items of the storage",configParams:{action:{defaultValue:"list"}}},select:{configParams:{action:{defaultValue:"action"},selectedItem:{defaultValue:"",type:"json"}}},exists:{description:"checks if exists item on the storage",configParams:{action:{defaultValue:"exists"}}}},rulesCode:Kt(e)}},{group:"storages",tag:e,name:"search",id:"storage_"+e+"_search",templateName:e+" storage search",emitEvent:!0,defaults:{width:2,height:8,icon:"search",displayResponse:!0,method:"post",name:`Search ${e} in storage`,html:`//@card/react

function Widget(card) {
  const value = card.value;

  const content = <YStack f={1} ai="center" jc="center" width="100%">
      {card.icon && card.displayIcon !== false && (
          <Icon name={card.icon} size={48} color={card.color}/>
      )}
      {card.displayResponse !== false && (
          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? "N/A"} />
      )}
  </YStack>

  return (
      <Tinted>
        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>
          <ActionCard data={card}>
            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}
          </ActionCard>
        </ProtoThemeProvider>
      </Tinted>
  );
}
`,type:"action",description:`Search ${e} in the storage and returns a list of ${e} objects. You can use use querys in natural language for searching`,params:{search:"search term",ai_mode:"enables natural language search mode"},configParams:{search:{visible:!0,defaultValue:"",type:"string"},ai_mode:{visible:!0,defaultValue:"true",type:"boolean"}},rulesCode:`return execute_action("/api/v1/actions/${e}/list", {\r
    ...params,\r
    mode: params.ai_mode ? 'ai' : 'normal'\r
})`}}]},Jt=e=>{let t=Ue(e),a=(0,D.getServiceToken)();return t.map(r=>({...r,token:a}))},Gt=({modelName:e,modelType:t,apiUrl:a=void 0,prefix:r="/api/v1/",object:o=void 0,notificationsName:d=void 0,pluralName:y=void 0,html:u={}})=>async(h,i)=>{let k=y??e,v=a??`${r}${e}`,$=`${r}actions/${e}`,p=d??e,m=async()=>{try{let n=await Q.API.get(`${v}?token=${(0,D.getServiceToken)()}`);n.isLoaded&&n.data&&n.data.total&&(i.state.set({group:"storages",tag:e,name:"total",value:n.data.total}),i.state.set({group:"storages",tag:e,name:"lastEntries",value:n.data.items}))}catch(n){console.error("Error loading total for "+e,n)}return 0};setTimeout(()=>m(),1e3);let f=Ue({modelName:e,modelType:t,pluralName:k,object:o,html:u}),T=n=>f.find(l=>l.name===n);h.get($+"/exists",A(async(n,l,b)=>{let S=n.query.id;try{if((await Q.API.get(`${v}/${S}?token=${b.token}`)).isLoaded){l.json(!0);return}l.json(!1);return}catch{l.status(500).json(!1);return}})),await i.actions.add({group:"storages",name:"exists",url:$+"/exists",tag:e,description:`Check if ${e} exists given an id. Returns true if it exists, false otherwise.`,params:{id:"id to look for"},token:(0,D.getServiceToken)()});let j=T("exists");j&&await i.cards.add({...j,token:(0,D.getServiceToken)()});let ae=T("table");ae&&await i.cards.add({...ae,token:(0,D.getServiceToken)()});let Z=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),q=n=>typeof n=="string"&&n.length>1&&(n[0]==="{"&&n.at(-1)==="}"||n[0]==="["&&n.at(-1)==="]"),te=(n,l)=>{switch(l){case"number":return typeof n=="number"?n:Number(n);case"boolean":{let b;return typeof n=="boolean"?b=n:typeof n=="number"?b=n!==0:typeof n=="string"?b=n==="true"||n==="1"||n==="on"||n==="yes":b=!!n,b}case"record":{if(Z(n))return n;if(q(n))try{return JSON.parse(n)}catch{}return n}case"string":default:return typeof n=="string"?n:String(n)}},we=(n,l)=>{let b=l.getObjectFieldsDefinition?.()??{};for(let x of Object.keys(n)){let S=b[x]?.type;S&&(n[x]=te(n[x],S))}return n},Oe=(n,l)=>{let b=l.getObjectFieldsDefinition?.()??{};if(typeof n.field=="string"&&"value"in n){let x=b[n.field]?.type;x&&(n.value=te(n.value,x))}return n};h.get($+"/read",A(async(n,l,b)=>{let x=n.query;delete x._stackTrace;let S=x.id;try{let B=await Q.API.get(`${v}/${S}?token=${b.token}`);if(B.isLoaded){we(B.data,t),l.json(B.data);return}l.json(!1);return}catch{l.status(500).json(!1);return}})),await i.actions.add({group:"storages",name:"read",url:$+"/read",tag:e,description:`Read ${e} given an id. Returns an object with the data of the ${e} if it exists, false otherwise.`,params:{id:`id of the ${e} to read`},token:(0,D.getServiceToken)()});let de=T("read");de&&await i.cards.add({...de,token:(0,D.getServiceToken)()}),h.post($+"/create",A(async(n,l,b)=>{let x=n.body;delete x._stackTrace,we(x,t);try{let S=await Q.API.post(`${v}?token=${b.token}`,x);if(S.isLoaded){l.json(S.data);return}l.json(!1);return}catch{l.status(500).json(!1);return}}));let z=t.getObjectFieldsDefinition(),Re=Object.keys(z).filter(n=>z[n].autogenerate==!1).map(n=>({[n]:z[n].description+" ("+z[n].type+")"+(z[n].isId?" (this will be used as the id of the element)":"")})).reduce((n,l)=>({...n,...l}),{});await i.actions.add({group:"storages",name:"create",url:$+"/create",tag:e,description:`Creates new ${e} given an object with the data. Returns the id of the new ${e}.`,params:Re,token:(0,D.getServiceToken)(),method:"post"});let Pe=T("create");Pe&&await i.cards.add({...Pe,token:(0,D.getServiceToken)()}),i.events.onEvent(i.mqtt,i,async n=>{m(),i.state.set({group:"storages",tag:e,name:"lastDeleteddId",value:n?.payload?.id})},p+"/delete/#"),h.get($+"/delete",A(async(n,l,b)=>{let S=n.query.id;try{if((await Q.API.get(`${v}/${S}/delete?token=${b.token}`)).isLoaded){l.json(!0);return}l.json(!1);return}catch{l.status(500).json(!1);return}})),await i.actions.add({group:"storages",name:"delete",url:$+"/delete",tag:e,description:`Deletes ${e} given an id. Returns true if it was deleted, false otherwise.`,params:{id:"id of the "+e+" to delete"},token:(0,D.getServiceToken)()});let ue=T("delete");ue&&await i.cards.add({...ue,token:(0,D.getServiceToken)()}),h.get($+"/update",A(async(n,l,b)=>{let x=n.query;delete x._stackTrace,Oe(x,t);let S=x.id,B=x.field,se=x.value;try{let W=await Q.API.get(`${v}/${S}?token=${x.token?x.token:b.token}`);if(W.isLoaded){let K=W.data;K[B]=se;let X=await Q.API.post(`${v}/${S}?token=${x.token?x.token:b.token}`,K);if(X.isLoaded){l.json(X.data);return}}}catch{l.status(500).json(!1);return}}));let _e={id:`id of the ${e} to update`,field:`field to update in the ${e}. Possible fields: ${Object.keys(z).join(", ")}`,value:"new value for the field"};await i.actions.add({group:"storages",name:"update",url:$+"/update",tag:e,description:`Updates ${e} by id, changing field with a given value. Returns the updated ${e} if it was updated, false otherwise.`,params:_e,token:(0,D.getServiceToken)()});let le=T("update");le&&await i.cards.add({...le,token:(0,D.getServiceToken)()}),i.events.onEvent(i.mqtt,i,async n=>{m(),i.state.set({group:"storages",tag:e,name:"lastCreated",value:n?.payload?.data}),i.state.set({group:"storages",tag:e,name:"lastCreatedMetadata",value:n}),i.state.set({group:"storages",tag:e,name:"lastCreatedId",value:n?.payload?.id})},p+"/create/#");let pe=T("lastCreated");pe&&i.cards.add({...pe,token:(0,D.getServiceToken)()}),i.events.onEvent(i.mqtt,i,async n=>{i.state.set({group:"storages",tag:e,name:"lastUpdated",value:n?.payload?.data}),i.state.set({group:"storages",tag:e,name:"lastUpdatedMetadata",value:n}),i.state.set({group:"storages",tag:e,name:"lastUpdatedId",value:n?.payload?.id})},p+"/update/#");let fe=T("lastUpdated");fe&&i.cards.add({...fe,token:(0,D.getServiceToken)()});let ge=T("totalItems");ge&&i.cards.add({...ge,token:(0,D.getServiceToken)()}),h.get($+"/list",A(async(n,l,b)=>{let x=n.query,S=x.itemsPerPage,B=x.page,se=x.search,W=x.orderBy,K=x.orderDirection,X=x.mode||"normal",s=`${v}?token=${b.token}&${S?`itemsPerPage=${S}`:""}${B?`&page=${B}`:""}${se?`&search=${se}`:""}${W?`&orderBy=${W}`:""}${K?`&orderDirection=${K}`:""}${X?`&mode=${X}`:""}`;try{let g=await Q.API.get(s);if(g.isLoaded){l.json(g.data.items);return}l.json(!1);return}catch{l.status(500).json(!1);return}})),await i.actions.add({group:"storages",name:"list",url:$+"/list",tag:e,description:`Returns a list of ${e} objects. You can filter the results by passing itemsPerPage, page, search, orderBy and orderDirection parameters.`,params:{itemsPerPage:"number of items per page (optional)",page:"page number to retrieve (optional)",search:"search term to filter the results (optional)",orderBy:"field to order the results by (optional)",orderDirection:"direction to order the results by (asc or desc) (optional)"},token:(0,D.getServiceToken)()});let xe=T("list");xe&&await i.cards.add({...xe,token:(0,D.getServiceToken)()});let ne=T("search");ne&&await i.cards.add({...ne,token:(0,D.getServiceToken)()})};var U=require("protobase");var Te=require("protobase"),Ht=async e=>(await Te.API.post("/api/agents/v1/llm_agent/agent_input?token="+(0,Te.getServiceToken)(),{message:e})).data,Wt=({prompt:e,done:t=async r=>r,error:a=r=>r})=>{let r=[{role:"system",content:[{type:"text",text:e}]}];return t(r),r},ot=e=>{let t=e.replace(/^```[^\s]+/g,"").replace(/```/g,"").trim();return t.startsWith("javascript")&&(t=t.replace("javascript","").trim()),t},it=async({response:e,execute_action:t,done:a=async o=>o,error:r=o=>o})=>{if(!e||!t)return null;try{let o=JSON.parse(e.replace(/^```[\w]*\n?/,"").replace(/```$/,"").trim()),d=[],y=[];for(let u of o.actions||[]){if(!u||!u.name)continue;let h=u.params||{},i=await t(u.name,h);if(d.push({name:u.name,params:h,result:i}),i&&typeof i=="object"&&i.offered===!0&&i.approvalId){let k=i.boardId,v=i.action||u.name,$=i.approvalId,p=i.message,m;if(k&&v&&$){let f=`/api/core/v1/boards/${k}/actions/${v}/approvals/${$}`;m={accept:`${f}/accept`,reject:`${f}/reject`,status:`${f}/status`}}y.push({boardId:k,action:v,approvalId:$,id:$,message:p,params:h,urls:m})}}return await a({response:o.response??"",executedActions:d,approvals:y})}catch(o){return r(o)}},Qt=it,Ee={callModel:async e=>await Ht(e),cleanCode:e=>ot(e),getSystemPrompt:e=>Wt(e)};var ie=(0,U.getLogger)(),Yt=je.getDB,Zt=je.connectDB;function ye(e,t,a,r){if(r&&r[t])return e?.loggedIn?(0,U.checkPermission)(e,r[t])?{allowed:!0,status:200}:{allowed:!1,status:403}:{allowed:!1,status:401};if(a&&(a.includes(t)||a.includes("*"))){if(!e?.loggedIn)return{allowed:!1,status:401};if(!(0,U.isAdmin)(e))return{allowed:!1,status:403}}return{allowed:!0,status:200}}var qt=({modelName:e,modelType:t,initialData:a={},prefix:r="/api/v1/",dbName:o,transformers:d={},connectDB:y=Zt,getDB:u=Yt,notify:h,operations:i=["create","read","update","delete","list"],single:k,disableEvents:v,paginatedRead:$,requiresAdmin:p,permissions:m,extraData:f={},logLevel:T="info",itemsPerPage:j=25,allowUpsert:ae=!1,skipStorage:Z=async(n,l,b)=>!1,onBeforeList:q=async(n,l,b)=>n,onAfterList:te=async(n,l,b)=>n,onBeforeCreate:we=async(n,l,b)=>n,onAfterCreate:Oe=async(n,l,b)=>n,onBeforeRead:de=async(n,l,b)=>n,onAfterRead:z=async(n,l,b)=>n,onBeforeUpdate:Re=async(n,l,b)=>n,onAfterUpdate:Pe=async(n,l,b)=>n,onBeforeDelete:ue=async(n,l,b)=>n,onAfterDelete:_e=async(n,l,b)=>n,skipDatabaseIndexes:le,dbOptions:pe={},defaultOrderBy:fe=void 0,defaultOrderDirection:ge="asc",skipDatabaseInitialization:xe=!1,ephemeralEvents:ne=!1})=>async(n,l)=>{let b=o??e,x=t.getGroupIndexes(),S=(s,g,c)=>o&&typeof o=="function"?o(s,g,c):b,B=(s,g)=>{if(h)return h(s,g);l&&l.mqtt&&l.mqtt.publish(s.getNotificationsTopic(g),s.getNotificationsPayload())};xe||await y(S("init"),a,le?{}:Be(t,pe));let se=async(s,g,c)=>(x.forEach(C=>{s[C.name]!==void 0&&(s.filter===void 0&&(s.filter={}),s.filter[C.key]=s[C.name])}),await q(s,g,c)),W=s=>{let g=t.getSchemaLinks();if(g){for(let c of g)if(s[c.field]!==void 0){let C=c.linkToId(s[c.field]);s[c.field]=C}}return s},K=async s=>{let g=t.getSchemaLinks();if(g)for(let c of g){let C=s.map(w=>w[c.field]).filter(w=>w!==void 0);C=[...new Set(C)],s=await c.linkToReadIds(c,C,s)}return s},X=async(s,g,c)=>{let C=Number(s.query.page)||0,w=s.query.orderBy&&s.query.orderBy!=""?s.query.orderBy:fe,P=s.query.orderDirection&&s.query.orderDirection!=""?s.query.orderDirection:ge;return w&&(g=g.sort((I,_)=>I[w]>_[w]?P==="asc"?1:-1:I[w]<_[w]?P==="asc"?-1:1:0)),g=await K(g),{itemsPerPage:c,items:s.query.all?g:g.slice(C*c,(C+1)*c),total:g.length,page:s.query.all?0:C,pages:s.query.all?1:Math.ceil(g.length/c)}};!k&&i.includes("list")&&n.get(r+e,A(async(s,g,c)=>{let C=ye(c,"list",p,m);if(!C.allowed){g.status(C.status).send({error:C.status===401?"Unauthorized":"Forbidden"});return}let w=u(S("list",s),s,c,l);if(s.query.group){let O=[];if(w.hasCapability&&w.hasCapability("groupBySingle")&&(O=await w.getGroupIndexOptions(s.query.group,s.query.limit||100)),s.query.search){let L=s.query.search;O=O.filter(M=>M.toLowerCase().startsWith(L.toLowerCase()))}g.send(O);return}let P=[],E=s.query.search,I=t.getGroupIndexes().reduce((O,L)=>s.query[L.name]===void 0?O:O?(O[L.key]=s.query[L.name],O):{[L.key]:s.query[L.name]},null),_=s.query.filter;I&&(_?_={..._,...I}:_=I);let N=typeof f?.prelist=="function"?await f.prelist(c,s):f?.prelist??{},ee=s.query.mode,re,ke;if(E&&ee=="ai"){let O=await U.API.get(r+e+"?token="+(0,D.getServiceToken)());O=O?.data?.items||[],O=JSON.stringify(O),re=await l.autopilot.getPromptFromTemplate({sampleElements:O,templateName:"aiSearch",search:E,modelName:e,modelType:t.toString(),modelDefinition:JSON.stringify(t.getObjectFieldsDefinition()),aditionalDecriptions:t.getAdditionalDescriptions()});let L=await Ee.callModel(re);ke=Ee.cleanCode(L.choices[0].message.content)}let Ge=async(O,L)=>{let M=t.unserialize(O,c),Ce=typeof f?.list=="function"?await f.list(c,M,s):f?.list??{};return await M.listTransformed(E,d,c,{...N,...Ce},L?void 0:await se(s.query,c,s),ke)},ve=Math.max(Number(s.query.itemsPerPage)||(j??25),1),$e=Object.keys(_||{});if(!E&&(!_||(!s.query.orderBy||s.query.orderBy==t.getIdField())&&$e.length==1&&w.hasCapability&&w.hasCapability("groupBySingle")&&await w.hasGroupIndexes($e))&&!le&&w.hasCapability&&w.hasCapability("pagination")){let O=await w.getIndexedKeys(),L=_?{key:$e[0],value:_[$e[0]]}:null,M=parseInt(await w.count(L),10),Ce=Number(s.query.page)||0,Ae=s.query.orderBy?s.query.orderBy:fe??t.getIdField(),Pt=s.query.orderDirection||ge;if(O.length&&O.includes(Ae)){let Fe=await Promise.all((await w.getPageItems(M,Ae,Ce,ve,Pt,L)).map(async kt=>await Ge(kt,!0)));Fe=await K(Fe);let xt={itemsPerPage:ve,items:Fe,total:M,page:s.query.all?0:Ce,pages:s.query.all?1:Math.ceil(M/ve)};g.send(await te(xt,c,s));return}}for await(let[O,L]of w.iterator()){let M=await Ge(L);M&&P.push(M)}g.send(await te(await X(s,P,ve),c,s))})),(i.includes("create")||i.includes("read"))&&n.post(r+e,A(async(s,g,c)=>{let C=s.query.action=="read_multiple"?"read":"create",w=ye(c,C,p,m);if(!w.allowed){g.status(w.status).send({error:w.status===401?"Unauthorized":"Forbidden"});return}if(s.query.action=="read_multiple"){let I=s.body;if(!I||!I.length){g.status(400).send({error:"No ids provided"});return}let _=u(S("read",s),s,c,l),N=[];for(let ee of I)try{let re=t.unserialize(await _.get(ee),c),ke=typeof f?.read=="function"?await f.read(c,re,s):f?.read??{};N.push(await z(await re.readTransformed(d,ke),c,s))}catch(re){ie.error({error:re},"Error reading item: "+ee)}g.send(N);return}else if(!i.includes("create")){g.status(404).send({error:"Not found"});return}let P=await t.load(await we(s.body,c,s),c).createTransformed(d);if(!(Z?await Z(P.read(),c,s):!1)){let I=S("create",s,P);I||g.status(404).send({error:"Not found"}),I instanceof Array||(I=[I]);for(let _ of I){let N=u(_,s,c,l);try{if(ae)throw new Error("Upsert enabled, inserting new document");await N.get(P.getId()),g.status(409).send({error:"Already exists"});return}catch{await N.put(P.getId(),JSON.stringify(W(P.serialize(!0))),{...pe,action:"create",entityId:t.getIdField()})}}}B(P,"create"),v||(0,U.generateEvent)({path:e+"/create/"+P.getId(),from:"vento",user:c.user.id,payload:{id:P.getId(),data:P.read()},ephemeral:ne??!1},(0,D.getServiceToken)()),ie[T??"info"]({id:P.getId()},e+" created: "+P.getId()),g.send(await Oe(await P.readTransformed(d),c,s))})),i.includes("read")&&n.get(r+e+"/:key",A(async(s,g,c)=>{let C=ye(c,"read",p,m);if(!C.allowed){g.status(C.status).send({error:C.status===401?"Unauthorized":"Forbidden"});return}let w=u(S("read",s),s,c,l);try{if($){let P=[],E=s.query.search;for await(let[I,_]of w.get(s.params.key))if(I!="initialized"){let ee=await $.model.unserialize(await de(_,c,s),c).listTransformed(E,d);ee&&P.push({...ee,_key:I})}g.send(await X(s,await z(P,c,s),Math.max(Number(s.query.itemsPerPage)||(j??25),1)))}else{let P=t.unserialize(await de(await w.get(s.params.key),c,s),c),E=typeof f?.read=="function"?await f.read(c,P,s):f?.read??{},I=(await K([await P.readTransformed(d,E)]))[0];g.send(await z(I,c,s))}}catch(P){ie.error({error:P},"Error reading from database"),g.status(404).send({result:"not found"})}})),i.includes("update")&&n.post(r+e+"/:key",A(async(s,g,c)=>{let C=ye(c,"update",p,m);if(!C.allowed){g.status(C.status).send({error:C.status===401?"Unauthorized":"Forbidden"});return}let w=t.load(await Re(s.body,s,c),c),P=u(S("update",s,w),s,c,l),E=(await K([JSON.parse(await P.get(s.params.key))]))[0],I=await t.load(E,c).updateTransformed(w,d),_=s?.query?.patch==="true";await P.put(I.getId(),JSON.stringify({..._?E:{},...W(I.serialize(!0))})),B(I,"update"),v||(0,U.generateEvent)({path:e+"/update/"+I.getId(),from:"vento",user:c.user.id,payload:{id:I.getId(),data:I.read()},ephemeral:ne??!1},(0,D.getServiceToken)()),ie[T??"info"]({data:I.read()},e+" updated: "+I.getId()),g.send(await Pe(await I.readTransformed(d),c,s))})),i.includes("delete")&&n.get(r+e+"/:key/delete",A(async(s,g,c)=>{let C=ye(c,"delete",p,m);if(!C.allowed){g.status(C.status).send({error:C.status===401?"Unauthorized":"Forbidden"});return}let w=u(S("delete",s),s,c,l),P;try{P=await w.get(s.params.key)}catch{g.status(404).send({error:"Not found"});return}$?(await ue("{}",c,s),await w.del(s.params.key,P)):(ue(P,c,s),await w.del(s.params.key,P));try{let E=await t.unserialize(P,c);B(E,"delete"),v||(0,U.generateEvent)({path:e+"/delete/"+E.getId(),from:"vento",user:c.user.id,payload:{who:"-",id:E.getId(),data:E.read()},ephemeral:ne??!1},(0,D.getServiceToken)()),ie[T??"info"]({data:E.read()},e+" deleted: "+E.getId())}catch(E){ie.error({e:E},"Error during delete notification")}g.send(await _e({result:"deleted"},c,s))}))};var R=require("ts-morph"),he=J(require("path"));var Me=e=>process.env.FILES_ROOT??"../../";var ct=require("protobase"),Y=(0,ct.getLogger)(),dt=(e,t)=>{let a=e.getImportDeclarations();for(let r of a){let o=r.getNamedImports();for(let y of o)if(y.getName()===t)return r.getModuleSpecifierValue();let d=r.getDefaultImport();if(d&&d.getText()===t)return r.getModuleSpecifierValue()}},Xt=(e,t,a=1)=>e.getDescendantsOfKind(R.SyntaxKind.CallExpression).filter(d=>{let y=d.getArguments(),u=d.getExpression();return u.getKind()===R.SyntaxKind.Identifier&&u.getText()==="Protofy"&&y.length&&y[0].getText()==t}).map(d=>d.getArguments()[a]),me=(e,t,a=1)=>{let o=e.getDescendantsOfKind(R.SyntaxKind.CallExpression).find(d=>{let y=d.getArguments(),u=d.getExpression();return u.getKind()===R.SyntaxKind.Identifier&&u.getText()==="Protofy"&&y.length&&y[0].getText()==t});return o?o.getArguments()[a]:void 0},ut=e=>new R.Project().addSourceFileAtPath(e),Nt=e=>new R.Project({useInMemoryFileSystem:!0}).createSourceFile("_temp1.tsx",e,{overwrite:!0}),er=e=>{let t=[],a=e;for(;a&&a.getKind()===R.SyntaxKind.CallExpression;){let r={name:a.getExpression().getLastChild().getText(),params:a.getArguments().map(o=>o.getText())};t.unshift(r),a=a.getExpression().getFirstChildIfKind(R.SyntaxKind.CallExpression)}return t},lt=(a=>(a[a.DEFAULT=0]="DEFAULT",a[a.NAMED=1]="NAMED",a))(lt||{}),tr=(e,t,a,r)=>{if(dt(e,t)){Y.warn(`"${t}" is already imported`);return}switch(a){case 0:e.addImportDeclaration({defaultImport:t,moduleSpecifier:r});break;case 1:e.addImportDeclaration({namedImports:[t],moduleSpecifier:r});break}},pt=(e,t)=>{let a=e.getImportDeclarations();for(let r of a)if(r.getModuleSpecifierValue()===t){r.remove();break}},rr=(e,t)=>{try{let a=e.getProperty(t);if(!a||a.getKind()!==R.SyntaxKind.PropertyAssignment)throw"Property doesn't exist";let r=a.asKindOrThrow(R.SyntaxKind.PropertyAssignment);if(!r||!r.getInitializer)throw"Property doesn't exist";let o=r.getInitializer();if(!o)throw"Property doesn't exist";return o}catch{console.log("Error retrieving property. Doesn't exist")}},ar=(e,t)=>{try{if(!e||e.getKind()!==R.SyntaxKind.ArrayLiteralExpression)throw"Element is not an array";e.addElement(t)}catch{console.log("Error adding element to array literal")}},nr=(e,t,a)=>{if(e.getProperty(y=>y instanceof R.PropertyAssignment&&(y.getNameNode().getKind()===R.SyntaxKind.Identifier&&y.getName()===t||y.getNameNode().getKind()===R.SyntaxKind.ComputedPropertyName&&y.getNameNode().getText()===`["${t}"]`))){Y.warn(`Object already has key: "${t}".`);return}let d=/^[a-zA-Z_$][a-zA-Z\d_$]*$/.test(t)?t:`["${t}"]`;e.addPropertyAssignment({name:d,initializer:a})},ft=(e,t)=>{let a=e.getProperty(r=>r instanceof R.PropertyAssignment&&(r.getNameNode().getKind()===R.SyntaxKind.Identifier&&r.getName()===t||r.getNameNode().getKind()===R.SyntaxKind.ComputedPropertyName&&r.getNameNode().getText()===`["${t}"]`));a?a.remove():Y.warn(`Key "${t}" does not exist on the object.`)},sr=async(e,t,a,r,o,d)=>{let y=t.name,u="./"+he.basename(y),h=ut(he.join(e,r)),i=me(h,a);if(!i)throw"No link definition schema marker found for file: "+u;ft(i,y),pt(h,u),h.saveSync();let k=Me(o)+"packages/app/"+a.replace(/"/g,"")+"/"+he.basename(t.name)+".ts";try{await d.unlink(k)}catch(v){Y.error({error:v,filePath:k},"Error deleting file")}},Ve=(e,t)=>{let a=me(e,'"features"');return a?a.getProperty(t)!==void 0:(Y.info("Cannot check for feature due to missing features marker"),!1)},or=async(e,t,a)=>{if(Ve(e,t)){Y.info({feature:t},"Feature already exists, not adding");return}Y.debug("Marker found, writing object"),me(e,'"features"').addPropertyAssignment({name:t,initializer:a}),await e.save()},ir=async(e,t)=>{if(!Ve(e,t)){Y.error({feature:t},"Feature not found, cannot remove");return}Y.debug("Marker found, removing object property"),me(e,'"features"').getProperty(t).remove(),await e.save()};var gt=J(require("mqtt")),yt=require("protobase"),be=(0,yt.getLogger)(),F,cr=(e,t,a)=>{if(!F){let r=process.env.MQTT_URL??"mqtt://localhost:1883";F=gt.connect(r,{username:e,clientId:e+"_"+Math.random().toString(16).substr(2,8),password:t}),F.hasConnected=!1,F.retries=0,be.debug({mqttServer:r,username:e},"Connecting to MQTT"),F.on("connect",function(){!F.hasConnected&&a&&a(F),F.hasConnected=!0,F.retries=0,be.debug("Connected to MQTT")}),F.on("reconnect",function(){(F.hasConnected||F.retries>10)&&be.debug("Trying to connect MQTT...")}),F.on("offline",function(){F.hasConnected&&be.debug("MQTT disconnected")}),F.on("error",function(o){F.hasConnected&&be.error({error:o},"MQTT Error")}),F=F}return F};var dr=require("protobase"),ze=require("protonode"),Ke=dr.API;function ht(e){return e.replace(/\?\./g,".").replace(/\[(["']?)(.*?)\1\]/g,".$2").split(".").filter(Boolean)}function mt(e,t,a){return ht(t).reduce((r,o)=>r?.[o],e)??a}var ur=(e,t,a)=>{switch(t){case"string":return String(e);case"number":return Number(e);case"boolean":return e==="true"||e===!0;case"json":try{return JSON.parse(e)}catch{return{}}case"array":try{return JSON.parse(e)}catch{return[]}case"card":return e;case"text":return e;case"state":return JSON.stringify(mt(a,e));default:return e}},lr=e=>typeof e!="string"?!1:e.startsWith("board.")||e.startsWith("board?.")||e.startsWith("board[")||e.startsWith("board?.["),pr=e=>ht(e)[1],bt=async({states:e,boardId:t,defaultValue:a,value:r,type:o,contextId:d=void 0,getContextState:y=void 0})=>{let u=!1;(r==null||r==="")&&(r=a);let h=e?.boards?.[t]??{};if(d&&y){let k=h;h=new Proxy({},{get(v,$){let p=String($),m=y(d,p);return m!==void 0?m:k[p]},has(v,$){let p=String($);return y(d,p)!==void 0?!0:p in k}})}let i={board:h};if(lr(r)){let k=pr(r);d&&y&&y(d,k)!==void 0||e?.boards?.[t]&&e.boards[t][k]!==void 0?(r=mt(i,r),u=!0):r=void 0}return r=ur(r,o,i),r};function fr(e){let t={},a=null,r=ze.getServiceToken(),o={},d=({name:u,key:h=void 0,changed:i,inmediate:k=!1})=>{!u&&h&&(console.warn("onChange called with key but no name, using key as name. key is a deprected parameter, please use name instead."),u=h),o[u]||(o[u]=[]),o[u].push(i),k&&i(t.states[u])};async function y({name:u,board:h=void 0,params:i={},done:k=$=>{},error:v=$=>{}}){let $=h||t.boardId;if(console.log("Executing action boardConnect: ",u,"on board:",$,"params:",i),h&&h!==t.boardId){let f=`/api/core/v1/boards/${encodeURIComponent(h)}/actions/${encodeURIComponent(u)}`,T=ze.getServiceToken();try{let j=await Ke.post(f+"?token="+T,i);if(j.isError){console.error("Error executing action on board "+h+": ",j.error),v(j.error);return}return k(j.data),j.data}catch(j){console.error("Error executing action on board "+h+": ",j),v(j);return}}let p=t.actions[u];if(!p){v("Action not found: "+u),console.error("Action not found: ",u);return}let m=p.url;if(console.log("Action: ",p),p.receiveBoard&&(i.board=t.boardId),p.configParams)for(let f in p.configParams)p.configParams&&p.configParams[f]&&(i[f]=await bt({states:t.states,boardId:t.boardId,defaultValue:p.configParams[f].defaultValue,value:i[f],type:p.configParams[f]?.type}));if(p.method==="post"){let{token:f,...T}=i;p.token&&(f=p.token);let j=await Ke.post(m+"?token="+(f||ze.getServiceToken()),T);if(j.isError){console.error("Error executing action: ",j.error),v(j.error);return}return k(j.data),j.data}else{let T=function(ae){return Object.entries(ae).filter(([,Z])=>Z!==void 0).map(([Z,q])=>{let te=q!==null&&typeof q=="object"?JSON.stringify(q):String(q??"");return`${encodeURIComponent(Z)}=${encodeURIComponent(te)}`}).join("&")}(i),j=await Ke.get(m+"?token="+r+"&"+T);if(j.isError){console.error("Error executing action: ",j.error),v(j.error);return}return k(j.data),j.data}}process.on("message",u=>{if(u.type==="init"){let h=u.boardContext||{};t=u.context,a=console.log.bind(console,"Board log ["+t.boardId+"]: ");try{e({context:h,...t,board:{onChange:d,execute_action:y,log:a,id:t.boardId}})}catch(i){console.error("Error running board ["+t.boardId+"]:",i)}process.send&&process.send({type:"init_confirmed"})}else if(u.type==="update"){let h=u.chunk,i=u.key,k=u.value;i?(t[h][i]=k,h=="states"&&o[i]&&o[i].forEach(v=>v(t.states[i]))):t[h]=k}})}var wt=require("protobase"),gr=(0,wt.getLogger)(),ce={},Je=class{constructor(t,a,r){this.location=t,this.options=a,this.config=r??{},this.capabilities=[],r&&r.context&&r.name&&(r.context[r.name]=this)}get status(){return"open"}on(t,a){t=="open"&&a()}hasCapability(t){return this.capabilities.includes(t)}async close(){}async exists(t){try{return!!this.get(t)}catch{return!1}}static getInstance(t,a,r){throw"Error: derived classes of ProtoDB should implement getInstance"}static connect(t,a,r){return t in ce||(ce[t]=this.getInstance(t,a,r),process.on("SIGINT",async()=>{gr.info("Closing database and terminating process..."),await ce[t].close(),process.exit(0)})),ce[t]}static async closeDBS(){let t=Object.keys(ce);for(let a of t)await ce[a].close()}static async initDB(t,a={},r){throw new Error("Static method initDB must be implemented")}};0&&(module.exports={AutoAPI,AutoActions,ImportType,ProtoDB,addElementToArrayLiteral,addFeature,addImportToSourceFile,addObjectLiteralProperty,ai,boardConnect,checkPassword,cleanCode,closeDBS,connectDB,dbProvider,extractChainCalls,filterFilesByRegex,genToken,getApp,getAuth,getDB,getDBOptions,getDefinition,getDefinitions,getDeviceToken,getImport,getMQTTClient,getObjectCardDefinitions,getObjectCards,getPropertyValueFromObjectLiteral,getRoot,getServiceToken,getSessionContext,getSourceFile,handler,hasFeature,hash,listFilesRecursively,processAgentResponse,processResponse,registerDBProvider,removeFeature,removeFileWithImports,removeImportFromSourceFile,removeObjectLiteralProperty,requireAdmin,requireAuth,requirePermission,resolveBoardParam,response,toSourceFile,validateSession,verifyToken});
